{
  "name": "ç™¾åº¦é¦–é¡µé«˜çº§ç‚¹å‡»æµ‹è¯•",
  "description": "ä½¿ç”¨AdvancedClickNodeåœ¨ç™¾åº¦é¦–é¡µæµ‹è¯•å¤šç§ç‚¹å‡»æ–¹æ³•",
  "version": "1.0.0",
  "preflows": [],
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "å¼€å§‹", "next": ["init_browser"] },
    {
      "id": "init_browser",
      "type": "BrowserInitNode",
      "name": "åˆå§‹åŒ–æµè§ˆå™¨",
      "config": {
        "headless": false,
        "viewport": { "width": 1920, "height": 1080 },
        "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
        "timeout": 30000
      },
      "next": ["navigate_baidu"]
    },
    {
      "id": "navigate_baidu",
      "type": "NavigationNode",
      "name": "å¯¼èˆªåˆ°ç™¾åº¦é¦–é¡µ",
      "config": {
        "url": "https://www.baidu.com",
        "waitUntil": "domcontentloaded",
        "timeout": 30000
      },
      "next": ["wait_baidu"]
    },
    {
      "id": "wait_baidu",
      "type": "WaitNode",
      "name": "ç­‰å¾…ç™¾åº¦é¦–é¡µåŠ è½½",
      "config": { "minMs": 2000, "maxMs": 3000 },
      "next": ["find_search_elements"]
    },
    {
      "id": "find_search_elements",
      "type": "JavaScriptExecutionNode",
      "name": "æŸ¥æ‰¾æœç´¢æ¡†å’Œæœç´¢æŒ‰é’®",
      "config": {
        "script": "console.log('ğŸ” å¼€å§‹æŸ¥æ‰¾ç™¾åº¦æœç´¢å…ƒç´ ...');\n\n// æŸ¥æ‰¾æœç´¢æ¡†\nconst searchBox = document.querySelector('#kw');\nconst searchButton = document.querySelector('#su');\n\n// æŸ¥æ‰¾å…¶ä»–å¯ç‚¹å‡»çš„å…ƒç´ \nconst newsLink = document.querySelector('a[href*=\"news.baidu.com\"]');\nconst mapLink = document.querySelector('a[href*=\"map.baidu.com\"]');\nconst moreLink = document.querySelector('a[href*=\"www.baidu.com/more\"]');\nconst loginButton = document.querySelector('a[name*=\"login\"]');\nconst settingsButton = document.querySelector('#s-usersetting-top');\n\nconst elements = {\n  searchBox: {\n    selector: '#kw',\n    element: searchBox,\n    text: searchBox ? searchBox.placeholder || 'æœç´¢æ¡†' : null,\n    visible: searchBox ? searchBox.offsetParent !== null : false\n  },\n  searchButton: {\n    selector: '#su',\n    element: searchButton,\n    text: searchButton ? searchButton.value || 'æœç´¢æŒ‰é’®' : null,\n    visible: searchButton ? searchButton.offsetParent !== null : false\n  },\n  newsLink: {\n    selector: 'a[href*=\"news.baidu.com\"]',\n    element: newsLink,\n    text: newsLink ? newsLink.textContent.trim() : null,\n    visible: newsLink ? newsLink.offsetParent !== null : false\n  },\n  mapLink: {\n    selector: 'a[href*=\"map.baidu.com\"]',\n    element: mapLink,\n    text: mapLink ? mapLink.textContent.trim() : null,\n    visible: mapLink ? mapLink.offsetParent !== null : false\n  },\n  moreLink: {\n    selector: 'a[href*=\"www.baidu.com/more\"]',\n    element: moreLink,\n    text: moreLink ? moreLink.textContent.trim() : null,\n    visible: moreLink ? moreLink.offsetParent !== null : false\n  },\n  loginButton: {\n    selector: 'a[name*=\"login\"]',\n    element: loginButton,\n    text: loginButton ? loginButton.textContent.trim() : null,\n    visible: loginButton ? loginButton.offsetParent !== null : false\n  },\n  settingsButton: {\n    selector: '#s-usersetting-top',\n    element: settingsButton,\n    text: settingsButton ? settingsButton.textContent.trim() : null,\n    visible: settingsButton ? settingsButton.offsetParent !== null : false\n  }\n};\n\n// æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯è§çš„å…ƒç´ ä½œä¸ºæµ‹è¯•ç›®æ ‡\nlet targetElement = null;\nlet targetName = null;\n\nfor (const [name, info] of Object.entries(elements)) {\n  if (info.visible && info.element) {\n    targetElement = info;\n    targetName = name;\n    console.log(`âœ… æ‰¾åˆ°ç›®æ ‡å…ƒç´ : ${name} (${info.selector})`);\n    console.log(`å…ƒç´ æ–‡æœ¬: ${info.text}`);\n    \n    // é«˜äº®æ˜¾ç¤ºæ‰¾åˆ°çš„å…ƒç´ \n    const originalStyle = info.element.style.cssText;\n    info.element.style.border = '3px solid red';\n    info.element.style.backgroundColor = 'yellow';\n    info.element.style.boxShadow = '0 0 10px rgba(255,0,0,0.5)';\n    \n    setTimeout(() => {\n      info.element.style.cssText = originalStyle;\n    }, 2000);\n    \n    break;\n  }\n}\n\nif (!targetElement) {\n  console.error('âŒ æœªæ‰¾åˆ°ä»»ä½•å¯è§çš„å…ƒç´ ');\n  return {\n    success: false,\n    error: 'æœªæ‰¾åˆ°ä»»ä½•å¯è§çš„å¯ç‚¹å‡»å…ƒç´ ',\n    elements: elements,\n    timestamp: new Date().toISOString()\n  };\n}\n\nconsole.log('ğŸ¯ æˆåŠŸæ‰¾åˆ°æµ‹è¯•ç›®æ ‡');\n\nreturn {\n  success: true,\n  action: 'elements_found',\n  targetElement: targetElement,\n  targetName: targetName,\n  selector: targetElement.selector,\n  allElements: elements,\n  pageUrl: window.location.href,\n  pageTitle: document.title,\n  timestamp: new Date().toISOString()\n};",
        "saveScreenshots": true
      },
      "next": ["test_click_methods"]
    },
    {
      "id": "test_click_methods",
      "type": "AdvancedClickNode",
      "name": "æµ‹è¯•å¤šç§ç‚¹å‡»æ–¹æ³•",
      "config": {
        "selector": "{{previous.selector}}",
        "strategy": "auto",
        "clickMethods": [
          "playwright_click",
          "javascript_click",
          "mouse_coordinates",
          "double_click",
          "right_click"
        ],
        "maxRetries": 1,
        "retryDelay": 500,
        "waitAfter": 2000,
        "timeout": 8000,
        "verifyVisibility": true,
        "scrollIntoView": true,
        "highlight": true,
        "highlightDuration": 1500,
        "verifyNavigation": false,
        "fallbackToNavigation": false,
        "saveDebugInfo": true,
        "takeScreenshots": true,
        "logLevel": "info",
        "testMode": true
      },
      "next": ["verify_click_result"]
    },
    {
      "id": "verify_click_result",
      "type": "JavaScriptExecutionNode",
      "name": "éªŒè¯ç‚¹å‡»ç»“æœ",
      "config": {
        "script": "console.log('ğŸ” éªŒè¯ç‚¹å‡»ç»“æœ...');\n\n// ä»ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ç»“æœä¸­è·å–é€‰æ‹©å™¨ä¿¡æ¯\nconst targetSelector = results?.selector || 'a[href*=\"news.baidu.com\"]';\nconst originalPageUrl = results?.pageUrl || 'https://www.baidu.com/';\n\nconst currentUrl = window.location.href;\nconst currentTitle = document.title;\n\n// æ£€æŸ¥é¡µé¢æ˜¯å¦æœ‰å˜åŒ–\nconst urlChanged = currentUrl !== originalPageUrl;\n\n// æ£€æŸ¥æ˜¯å¦æœ‰å¼¹çª—æˆ–æ–°å…ƒç´ å‡ºç°\nconst modalPresent = !!document.querySelector('.modal, .popup, .dialog, [role*=\"dialog\"]');\n\n// æ£€æŸ¥ç›®æ ‡å…ƒç´ æ˜¯å¦ä»ç„¶å¯è§\nconst targetElement = document.querySelector(targetSelector);\nconst targetStillVisible = targetElement ? targetElement.offsetParent !== null : false;\n\nconsole.log(`å½“å‰URL: ${currentUrl}`);\nconsole.log(`åŸå§‹URL: ${originalPageUrl}`);\nconsole.log(`URLæ˜¯å¦æ”¹å˜: ${urlChanged}`);\nconsole.log(`æ˜¯å¦æœ‰å¼¹çª—: ${modalPresent}`);\nconsole.log(`ç›®æ ‡å…ƒç´ ä»å¯è§: ${targetStillVisible}`);\nconsole.log(`ç›®æ ‡é€‰æ‹©å™¨: ${targetSelector}`);\n\n// è¯„ä¼°ç‚¹å‡»æ•ˆæœ\nlet clickEffect = 'unknown';\nif (urlChanged) {\n  clickEffect = 'navigation';\n} else if (modalPresent) {\n  clickEffect = 'modal_opened';\n} else if (!targetStillVisible) {\n  clickEffect = 'element_hidden';\n} else {\n  clickEffect = 'clicked_no_effect';\n}\n\nconst verificationResult = {\n  success: true,\n  action: 'click_verified',\n  clickEffect: clickEffect,\n  \n  currentUrl: currentUrl,\n  currentTitle: currentTitle,\n  originalUrl: originalPageUrl,\n  \n  urlChanged: urlChanged,\n  modalPresent: modalPresent,\n  targetStillVisible: targetStillVisible,\n  targetSelector: targetSelector,\n  \n  verificationDetails: {\n    elementCount: document.querySelectorAll('*').length,\n    visibleElements: document.querySelectorAll(':not([style*=\"display: none\"])').length,\n    clickableElements: document.querySelectorAll('a, button, input[type=\"button\"], input[type=\"submit\"]').length\n  },\n  \n  timestamp: new Date().toISOString()\n};\n\nconsole.log(`ç‚¹å‡»æ•ˆæœ: ${clickEffect}`);\nconsole.log('éªŒè¯å®Œæˆ:', verificationResult);\n\nreturn verificationResult;",
        "saveScreenshots": true
      },
      "next": ["save_results"]
    },
    {
      "id": "save_results",
      "type": "ResultSaverNode",
      "name": "ä¿å­˜æµ‹è¯•ç»“æœ",
      "config": {
        "outputDir": "workflows/records",
        "filenameTemplate": "baidu-advanced-click-test-{timestamp}.json",
        "includeMetadata": true,
        "mergeData": true
      },
      "next": ["end"]
    },
    {
      "id": "end",
      "type": "EndNode",
      "name": "ç»“æŸ",
      "config": { "cleanup": true, "saveLogs": true }
    }
  ],
  "globalConfig": {
    "logLevel": "info",
    "screenshotOnError": true,
    "autoCleanup": true,
    "parallelExecution": false,
    "timeout": 180000
  }
}