{
  "name": "Alibaba.com Login Preflow",
  "description": "预加载阿里巴巴国际站 Cookie 并验证登录；失败则人工登录等待",
  "version": "1.0.0",
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "开始", "next": ["browser_init"] },
    { "id": "browser_init", "type": "BrowserInitNode", "name": "浏览器初始化", "config": { "engine": "camoufox", "headless": false, "viewport": { "width": 1280, "height": 900 }, "userDataDirTemplate": "~/.webauto/profiles/{sessionId}-alibaba", "strictAutomationMitigation": true }, "next": ["wait_after_init"] },
    { "id": "wait_after_init", "type": "WaitNode", "name": "初始化等待", "config": { "minMs": 600, "maxMs": 1600 }, "next": ["load_cookies"] },
    { "id": "load_cookies", "type": "CookieLoaderNode", "name": "加载Cookie", "config": { "cookiePath": "~/.webauto/cookies/alibaba.com.json" }, "next": ["pre_nav_wait"], "error": ["navigate_home"] },
    { "id": "pre_nav_wait", "type": "WaitNode", "name": "加载后等待", "config": { "minMs": 800, "maxMs": 2000 }, "next": ["navigate_home"] },
    { "id": "navigate_home", "type": "NavigationNode", "name": "导航主页", "config": { "url": "https://www.alibaba.com/", "waitUntil": "domcontentloaded", "timeout": 30000 }, "next": ["antibot"] },
    { "id": "antibot", "type": "AntiBotMitigationNode", "name": "轻量反风控", "config": { "mouseMoves": 3, "scroll": true }, "next": ["dismiss_modals"] },
    { "id": "dismiss_modals", "type": "ModalDismissNode", "name": "关闭模态", "config": { "maxAttempts": 5, "retryDelay": 500 }, "next": ["verify_login"] },
    { "id": "verify_login", "type": "LoginVerificationNode", "name": "验证登录", "config": { "loginSelectors": ["a[aria-label*='My Alibaba']", "a[href*='myalibaba']", "img[class*='avatar']", "[class*='avatar'] img"], "successText": ["My Alibaba","Orders","Messages","Sign Out","我的阿里巴巴","订单","消息","退出"], "cookieNames": ["cookie2","_tb_token_","cna","ali_ab","x5sec"], "requireVisible": false, "maxRetries": 60, "retryDelay": 10000 }, "next": ["save_cookies"], "error": ["manual_wait"] },
    { "id": "save_cookies", "type": "CookieSaverNode", "name": "保存Cookie", "config": { "cookiePath": "~/.webauto/cookies/alibaba.com.json" }, "next": ["handshake_success"] },
    { "id": "manual_wait", "type": "LoginVerificationNode", "name": "人工登录等待", "config": { "loginSelectors": ["a[aria-label*='My Alibaba']", "a[href*='myalibaba']", "img[class*='avatar']", "[class*='avatar'] img"], "requireVisible": false, "maxRetries": 60, "retryDelay": 10000 }, "next": ["handshake_success"], "error": ["handshake_failed"] },
    { "id": "handshake_success", "type": "ResultSaverNode", "name": "握手成功记录", "config": { "outputDir": "workflows/records", "filenameTemplate": "preflow-alibaba-login-success-{timestamp}.json", "includeMetadata": true }, "next": ["signal_success"] },
    { "id": "signal_success", "type": "HandshakeSignalNode", "name": "写入成功信号", "config": { "status": "success" }, "next": ["behavior_log"] },
    { "id": "behavior_log", "type": "BehaviorLogNode", "name": "行为日志", "config": {}, "next": ["export_context"] },
    { "id": "export_context", "type": "ContextExportNode", "name": "导出上下文", "config": {}, "next": ["end"] },
    { "id": "handshake_failed", "type": "ResultSaverNode", "name": "握手失败记录", "config": { "outputDir": "workflows/records", "filenameTemplate": "preflow-alibaba-login-failed-{timestamp}.json", "includeMetadata": true }, "next": ["signal_failed"] },
    { "id": "signal_failed", "type": "HandshakeSignalNode", "name": "写入失败信号", "config": { "status": "failed" }, "next": ["behavior_log_failed"] },
    { "id": "behavior_log_failed", "type": "BehaviorLogNode", "name": "行为日志(失败)", "config": {}, "next": ["halt"] },
    { "id": "halt", "type": "HaltNode", "name": "停止", "config": { "message": "alibaba 登录失败" } },
    { "id": "end", "type": "EndNode", "name": "结束", "config": { "cleanup": false, "saveLogs": true } }
  ],
  "globalConfig": { "logLevel": "info", "screenshotOnError": true, "autoCleanup": true, "parallelExecution": false, "timeout": 660000 }
}
