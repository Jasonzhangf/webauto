{
  "name": "1688稳定预登录流程",
  "description": "使用Camoufox浏览器进行1688预登录，注入完整cookie集合",
  "version": "1.0.0",
  "enabled": true,
  "nodes": [
    {
      "id": "camoufox_ensure",
      "type": "CamoufoxEnsureNode",
      "config": {
        "forceDownload": false,
        "version": "latest"
      }
    },
    {
      "id": "browser_init",
      "type": "BrowserInitNode",
      "config": {
        "headless": false,
        "browserType": "firefox",
        "executablePath": "/Users/fanzhang/Library/Caches/camoufox/Camoufox.app/Contents/MacOS/camoufox",
        "viewport": {
          "width": 1920,
          "height": 1080
        },
        "launchArgs": [
          "--disable-blink-features=AutomationControlled",
          "--disable-web-security",
          "--no-first-run",
          "--disable-default-apps",
          "--disable-sync",
          "--metrics-recording-only",
          "--no-sandbox",
          "--disable-setuid-sandbox",
          "--disable-features=TranslateUI",
          "--disable-features=Translate",
          "--lang=zh-CN",
          "--accept-lang=zh-CN,zh"
        ],
        "extraHTTPHeaders": {
          "Accept-Language": "zh-CN,zh;q=0.9",
          "DNT": "1",
          "Upgrade-Insecure-Requests": "1"
        },
        "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:125.0) Gecko/20100101 Firefox/125.0",
        "ignoreDefaultArgs": ["--enable-blink-features=AutomationControlled"],
        "locale": "zh-CN",
        "timezoneId": "Asia/Shanghai"
      }
    },
    {
      "id": "cookie_injection",
      "type": "CookieInjectionNode",
      "config": {
        "cookieFile": "~/.webauto/cookies/1688-domestic.json",
        "validateBeforeInjection": true,
        "fallbackToLatestBackup": true,
        "requiredCookies": [
          "__cn_logon__",
          "__cn_logon_id__",
          "last_mid",
          "_csrf_token"
        ],
        "injectionStrategy": "domain-filtered",
        "targetDomains": [
          ".1688.com",
          ".taobao.com",
          ".tmall.com",
          ".tmall.hk",
          ".fliggy.com",
          ".mmstat.com"
        ]
      }
    },
    {
      "id": "homepage_access",
      "type": "NavigateNode",
      "config": {
        "url": "https://www.1688.com/",
        "waitUntil": "domcontentloaded",
        "timeout": 30000,
        "retryCount": 2,
        "retryDelay": 2000
      }
    },
    {
      "id": "login_verification",
      "type": "LoginVerificationNode",
      "config": {
        "verificationMethods": [
          "cookie_check",
          "element_check",
          "url_check"
        ],
        "requiredElements": [
          ".member-nick",
          ".user-info",
          ".head-user"
        ],
        "requiredCookies": [
          "__cn_logon__=true"
        ],
        "validUrls": [
          "www.1688.com",
          "1688.com"
        ],
        "invalidUrls": [
          "login.1688.com",
          "signin.htm"
        ],
        "maxWaitTime": 10000,
        "checkInterval": 1000
      }
    },
    {
      "id": "session_validation",
      "type": "SessionValidationNode",
      "config": {
        "validateUserSession": true,
        "checkAntiBot": true,
        "verifyCSRFToken": true,
        "testAPIAccess": [
          "https://work.1688.com/home/buyer.htm",
          "https://hz.1688.com/offer/search.htm"
        ],
        "validationTimeout": 5000
      }
    },
    {
      "id": "finalization",
      "type": "SessionFinalizeNode",
      "config": {
        "preserveSession": true,
        "attachMode": true",
        "autoSaveCookies": false,
        "keepBrowserOpen": true,
        "finalDelay": 2000
      }
    }
  ],
  "edges": [
    {
      "from": "camoufox_ensure",
      "to": "browser_init",
      "condition": "success"
    },
    {
      "from": "browser_init",
      "to": "cookie_injection",
      "condition": "success"
    },
    {
      "from": "cookie_injection",
      "to": "homepage_access",
      "condition": "success"
    },
    {
      "from": "homepage_access",
      "to": "login_verification",
      "condition": "success"
    },
    {
      "from": "login_verification",
      "to": "session_validation",
      "condition": "verified"
    },
    {
      "from": "session_validation",
      "to": "finalization",
      "condition": "success"
    }
  ],
  "errorHandling": {
    "retryPolicy": {
      "maxRetries": 3,
      "retryDelay": 5000,
      "exponentialBackoff": true
    },
    "fallbackActions": {
      "cookie_injection_failed": "try_latest_backup",
      "login_verification_failed": "manual_login_prompt",
      "browser_init_failed": "restart_browser"
    }
  },
  "metadata": {
    "createdAt": "2025-10-16T06:15:00.000Z",
    "updatedAt": "2025-10-16T06:15:00.000Z",
    "author": "system",
    "tags": ["1688", "preflow", "camoufox", "stable"],
    "category": "login",
    "estimatedDuration": "30-60 seconds",
    "dependencies": {
      "camoufox": ">=0.4.0",
      "playwright": ">=1.40.0"
    }
  }
}