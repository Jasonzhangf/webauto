{
  "name": "Weibo Prelogin Staging Auto",
  "globalConfig": { "logLevel": "info", "timeout": 600000 },
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "开始", "next": ["browser"] },
    { "id": "browser", "type": "BrowserInitNode", "name": "启动浏览器", "config": { "headless": false, "viewport": { "width": 1440, "height": 900 } }, "next": ["injectIndex"] },
    { "id": "injectIndex", "type": "InjectContainerIndexNode", "name": "注入容器索引(staging)", "config": { "site": "weibo.com", "tier": "staging" }, "next": ["cookies"] },
    { "id": "cookies", "type": "CookieLoaderNode", "name": "加载Cookie", "config": { "cookiePath": "~/.webauto/cookies/weibo.com-latest.json" }, "next": ["nav"], "error": ["navManual"] },
    { "id": "nav", "type": "NavigationNode", "name": "访问微博首页", "config": { "url": "https://weibo.com", "waitUntil": "domcontentloaded", "timeout": 30000 }, "next": ["containerCheck"] },
    { "id": "navManual", "type": "NavigationNode", "name": "访问微博首页(手动登录)", "config": { "url": "https://weibo.com", "waitUntil": "domcontentloaded", "timeout": 30000 }, "next": ["wait15"] },
    { "id": "wait15", "type": "WaitNode", "name": "等待人工登录(15s)", "config": { "minMs": 15000, "maxMs": 15000 }, "next": ["anchorCheck"] },
    { "id": "anchorCheck", "type": "AnchorPointNode", "name": "锚点检测(用户已登录标记)", "config": { "hostFilter": "weibo.com", "selectors": [".gn_name",".WB_name","[data-e2e=\"user-name\"]"], "requireVisible": true, "maxWaitMs": 1000, "pollIntervalMs": 500 }, "next": ["verifyLoop"], "error": ["wait15"] },
    { "id": "verifyLoop", "type": "LoginVerificationNode", "name": "登录验证循环", "config": { "loginSelectors": [".gn_name",".WB_name","[data-e2e=\"user-name\"]"], "cookieNames": ["SUB","SUE","SUP"], "maxRetries": 1, "retryDelay": 1000, "postLoginWaitMs": 1000, "autoSaveCookies": true, "hostFilter": "weibo.com", "cookieSavePath": "~/.webauto/cookies/weibo.com-latest.json" }, "next": ["end"], "error": ["wait15"] },
    {
      "id": "containerCheck",
      "type": "JavaScriptExecutionNode",
      "name": "基于容器的登录信号检查",
      "config": {
        "timeout": 20000,
        "script": "(function(){ const present = !!document.querySelector('.gn_name') || !!document.querySelector('.WB_name'); return { success: true, isLikelyLoggedIn: present, ts: new Date().toISOString() }; })()"
      },
      "next": ["verifyLogin"]
    },
    {
      "id": "verifyLogin",
      "type": "LoginVerificationNode",
      "name": "登录验证（容器+Cookie双保险）",
      "config": {
        "loginSelectors": [".gn_name",".WB_name","[data-e2e=\"user-name\"]"],
        "cookieNames": ["SUB","SUE","SUP"],
        "maxRetries": 2,
        "retryDelay": 2000,
        "postLoginWaitMs": 1000,
        "autoSaveCookies": true,
        "hostFilter": "weibo.com",
        "cookieSavePath": "~/.webauto/cookies/weibo.com-latest.json"
      },
      "next": ["end"]
    },
    { "id": "end", "type": "EndNode", "name": "结束", "config": { "cleanup": false } }
  ]
}
