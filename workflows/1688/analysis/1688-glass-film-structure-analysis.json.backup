{
  "name": "1688é’¢åŒ–è†œé¡µé¢ç»“æ„åˆ†æ",
  "description": "åˆ†æ1688é’¢åŒ–è†œæœç´¢ç»“æœé¡µé¢çš„HTMLç»“æ„ï¼Œæ‰¾åˆ°æ­£ç¡®çš„é€‰æ‹©å™¨",
  "version": "1.0.0",
  "preflows": ["1688-login-preflow"],
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "å¼€å§‹", "next": ["attach"] },
    {
      "id": "attach",
      "type": "AttachSessionNode",
      "name": "ä¼šè¯æ¥åŠ›",
      "config": {},
      "next": ["navigate_search"]
    },
    {
      "id": "navigate_search",
      "type": "NavigationNode",
      "name": "å¯¼èˆªåˆ°é’¢åŒ–è†œæœç´¢é¡µ",
      "config": {
        "url": "https://s.1688.com/selloffer/offer_search.htm?keywords=%B8%D6%BB%AF%C4%A4",
        "waitUntil": "domcontentloaded",
        "timeout": 30000
      },
      "next": ["wait_search"]
    },
    {
      "id": "wait_search",
      "type": "WaitNode",
      "name": "ç­‰å¾…æœç´¢ç»“æœåŠ è½½",
      "config": { "minMs": 3000, "maxMs": 5000 },
      "next": ["analyze_structure"]
    },
    {
      "id": "analyze_structure",
      "type": "PageSnapshotNode",
      "name": "åˆ†æé¡µé¢ç»“æ„",
      "config": {
        "script": "console.log('ğŸ” å¼€å§‹åˆ†æ1688é’¢åŒ–è†œæœç´¢ç»“æœé¡µé¢ç»“æ„...');\n\n// 1. åˆ†æé¡µé¢åŸºæœ¬ä¿¡æ¯\nconst pageInfo = {\n  url: window.location.href,\n  title: document.title,\n  timestamp: new Date().toISOString()\n};\n\n// 2. å°è¯•å¤šç§é€‰æ‹©å™¨å¯»æ‰¾å•†å“é¡¹\nconst selectors = [\n  '.sm-offer-item',\n  '.offer-item', \n  '.sm-offer',\n  '[class*=offer]',\n  '.sm-offer-item-wrapper',\n  '.s-widget-offer',\n  '.offer-list-item',\n  '.sm-offer-card',\n  '[class*=product]',\n  '[class*=goods]'\n];\n\nconst selectorResults = {};\nlet bestSelector = null;\nlet maxItems = 0;\n\nselectors.forEach(selector => {\n  const items = document.querySelectorAll(selector);\n  selectorResults[selector] = items.length;\n  console.log(`é€‰æ‹©å™¨ ${selector}: æ‰¾åˆ° ${items.length} ä¸ªå…ƒç´ `);\n  \n  if (items.length > maxItems) {\n    maxItems = items.length;\n    bestSelector = selector;\n  }\n});\n\nconsole.log(`æœ€ä½³é€‰æ‹©å™¨: ${bestSelector} (${maxItems} ä¸ªå…ƒç´ )`);\n\n// 3. åˆ†ææœ€ä½³é€‰æ‹©å™¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ \nlet firstItemAnalysis = null;\nif (bestSelector && maxItems > 0) {\n  const firstItem = document.querySelector(bestSelector);\n  \n  if (firstItem) {\n    // æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½çš„é“¾æ¥\n    const allLinks = firstItem.querySelectorAll('a');\n    const links1688 = Array.from(allLinks).filter(link => link.href && link.href.includes('1688.com'));\n    \n    // æŸ¥æ‰¾æ ‡é¢˜\n    const titleSelectors = ['h4', 'h3', 'h2', '[class*=title]', '[class*=name]', 'a[title]', '.title', '.name'];\n    let title = null;\n    \n    for (const titleSel of titleSelectors) {\n      const titleEl = firstItem.querySelector(titleSel);\n      if (titleEl) {\n        title = titleEl.textContent.trim() || titleEl.title || titleEl.getAttribute('alt');\n        if (title) break;\n      }\n    }\n    \n    // æŸ¥æ‰¾å›¾ç‰‡\n    const images = firstItem.querySelectorAll('img');\n    const validImages = Array.from(images).filter(img => img.src && !img.src.includes('placeholder'));\n    \n    // æŸ¥æ‰¾ä»·æ ¼\n    const priceSelectors = ['[class*=price]', '[data-price]', '.price', '.yuan', '[class*=money]'];\n    let price = null;\n    \n    for (const priceSel of priceSelectors) {\n      const priceEl = firstItem.querySelector(priceSel);\n      if (priceEl) {\n        price = priceEl.textContent.trim();\n        if (price) break;\n      }\n    }\n    \n    firstItemAnalysis = {\n      html: firstItem.outerHTML.substring(0, 1000) + '...',\n      className: firstItem.className,\n      tagName: firstItem.tagName,\n      linkCount: allLinks.length,\n      validLinks: links1688.map(link => ({\n        href: link.href,\n        text: link.textContent.trim(),\n        title: link.title\n      })),\n      title: title,\n      imageCount: validImages.length,\n      firstImage: validImages.length > 0 ? validImages[0].src : null,\n      price: price\n    };\n  }\n}\n\n// 4. åˆ†æé¡µé¢æ•´ä½“ç»“æ„\nconst mainContainer = document.querySelector('.sm-offer-list, .offer-list, [class*=list], [class*=container], .sm-search-result');\nconst containerInfo = mainContainer ? {\n  exists: true,\n  className: mainContainer.className,\n  tagName: mainContainer.tagName,\n  childCount: mainContainer.children.length\n} : { exists: false };\n\n// 5. åˆ†æåˆ†é¡µ\nconst pagination = document.querySelector('.ui-pagination, .pagination, [class*=page]');\nconst paginationInfo = pagination ? {\n  exists: true,\n  className: pagination.className,\n  html: pagination.outerHTML.substring(0, 500) + '...'\n} : { exists: false };\n\n// 6. åˆ†æå¯èƒ½çš„ç‚¹å‡»å…ƒç´ \nconst clickableElements = document.querySelectorAll('a[href*=\"1688.com\"], [onclick*=\"1688.com\"], [class*=clickable]');\nconst clickAnalysis = {\n  totalClickable: clickableElements.length,\n  uniqueHrefs: [...new Set(Array.from(clickableElements).map(el => el.href))].length,\n  sampleLinks: Array.from(clickableElements).slice(0, 5).map(el => ({\n    href: el.href,\n    text: el.textContent.trim().substring(0, 50),\n    className: el.className\n  }))\n};\n\nconst analysisResult = {\n  pageInfo,\n  selectorResults,\n  bestSelector,\n  maxItems,\n  firstItemAnalysis,\n  containerInfo,\n  paginationInfo,\n  clickAnalysis,\n  success: true,\n  timestamp: new Date().toISOString()\n};\n\nconsole.log('é¡µé¢ç»“æ„åˆ†æå®Œæˆ');\nconsole.log('æ‰¾åˆ°çš„å•†å“å…ƒç´ æ•°é‡:', maxItems);\nconsole.log('æœ€ä½³é€‰æ‹©å™¨:', bestSelector);\n\nif (firstItemAnalysis && firstItemAnalysis.validLinks.length > 0) {\n  console.log('ç¬¬ä¸€æ¡æœ‰æ•ˆé“¾æ¥:', firstItemAnalysis.validLinks[0].href);\n  console.log('ç¬¬ä¸€æ¡æ ‡é¢˜:', firstItemAnalysis.title);\n}\n\nreturn analysisResult;",
        "saveScreenshots": true
      },
      "next": ["save_results"]
    },
    {
      "id": "save_results",
      "type": "ResultSaverNode",
      "name": "ä¿å­˜åˆ†æç»“æœ",
      "config": {
        "outputDir": "workflows/records",
        "filenameTemplate": "1688-glass-film-structure-analysis-{timestamp}.json",
        "includeMetadata": true,
        "mergeData": true
      },
      "next": ["end"]
    },
    {
      "id": "end",
      "type": "EndNode",
      "name": "ç»“æŸ",
      "config": { "cleanup": false, "saveLogs": true }
    }
  ],
  "globalConfig": {
    "logLevel": "info",
    "screenshotOnError": true,
    "autoCleanup": false,
    "parallelExecution": false,
    "timeout": 180000
  }
}