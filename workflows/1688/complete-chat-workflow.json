{
  "name": "1688完整聊天工作流",
  "description": "搜索关键字，找到第二个旺旺，打开聊天框，输入你好并发送，然后关闭tab",
  "version": "1.0.0",
  "anchor": {
    "hostFilter": "1688.com",
    "selectors": [
      ".userAvatarLogo img",
      ".username",
      ".user-info",
      ".header-user",
      ".login-user",
      "[data-spm-anchor-id*='user']",
      ".member-nickname",
      ".s-login-info",
      ".ui-header",
      ".head-user-info",
      ".login-info",
      ".header-avatar",
      ".user-name",
      ".avatar",
      "img[alt*='用户']",
      "img[alt*='头像']",
      ".header",
      ".top-header",
      ".ui-header-wrapper"
    ],
    "requireVisible": false,
    "maxWaitMs": 10000,
    "pollIntervalMs": 1000,
    "highlight": true,
    "persistHighlight": true,
    "highlightLabel": "ANCHOR",
    "highlightColor": "#007AFF"
  },
  "nodes": [
    {
      "id": "start",
      "type": "StartNode",
      "next": ["gbk_encode_search"]
    },
    {
      "id": "gbk_encode_search",
      "type": "GBKURLBuilderNode",
      "config": {
        "baseUrl": "https://s.1688.com/selloffer/offer_search.htm",
        "paramName": "keywords",
        "keywordText": "冲锋衣"
      },
      "next": ["navigate_search_results"]
    },
    {
      "id": "navigate_search_results",
      "type": "NavigationNode",
      "config": {
        "url": "{targetUrl}",
        "waitUntil": "networkidle",
        "timeout": 15000
      },
      "next": ["wait_search_results"]
    },
    {
      "id": "wait_search_results",
      "type": "WaitNode",
      "config": {
        "duration": 3000
      },
      "next": ["search_results_anchor"]
    },
    {
      "id": "search_results_anchor",
      "type": "AnchorPointNode",
      "config": {
        "hostFilter": "1688.com",
        "selectors": [".sm-offer-card", ".offer-card", ".product-card"],
        "requireVisible": true,
        "maxWaitMs": 15000,
        "pollIntervalMs": 1000,
        "highlight": true,
        "persistHighlight": true,
        "highlightLabel": "SEARCH_RESULTS",
        "highlightColor": "#007AFF"
      },
      "next": ["find_second_wangwang"]
    },
    {
      "id": "find_second_wangwang",
      "type": "JavaScriptExecutionNode",
      "config": {
        "script": "const cards = document.querySelectorAll('.sm-offer-card, .offer-card, .product-card'); if (cards.length >= 2) { const secondCard = cards[1]; const wwLink = secondCard.querySelector('a[href*=\"air.1688.com\"], .ww-link, .wangwang-link'); if (wwLink) { window.__secondWangwangLink = wwLink.href; window.__secondWangwangElement = wwLink; console.log('找到第二个旺旺链接:', wwLink.href); return { found: true, href: wwLink.href }; } } return { found: false };"
      },
      "next": ["check_wangwang_found"]
    },
    {
      "id": "check_wangwang_found",
      "type": "JavaScriptExecutionNode",
      "config": {
        "script": "if (!window.__secondWangwangFound) { const result = { found: false }; const cards = document.querySelectorAll('.sm-offer-card, .offer-card, .product-card'); if (cards.length >= 2) { const secondCard = cards[1]; const wwLink = secondCard.querySelector('a[href*=\"air.1688.com\"], .ww-link, .wangwang-link'); if (wwLink) { window.__secondWangwangFound = true; window.__secondWangwangLink = wwLink.href; window.__secondWangwangElement = wwLink; result.found = true; result.href = wwLink.href; console.log('找到第二个旺旺链接:', wwLink.href); } } return result; }"
      },
      "next": ["click_second_wangwang"]
    },
    {
      "id": "click_second_wangwang",
      "type": "JavaScriptExecutionNode",
      "config": {
        "script": "(async () => { if (window.__secondWangwangElement) { window.__secondWangwangElement.scrollIntoView({ behavior: 'smooth', block: 'center' }); await new Promise(resolve => setTimeout(resolve, 1000)); window.__secondWangwangElement.click(); return { clicked: true }; } return { clicked: false }; })()"
      },
      "next": ["wait_chat_page"]
    },
    {
      "id": "wait_chat_page",
      "type": "WaitNode",
      "config": {
        "duration": 3000
      },
      "next": ["chat_page_anchor"]
    },
    {
      "id": "chat_page_anchor",
      "type": "AnchorPointNode",
      "config": {
        "hostFilter": "air.1688.com",
        "selectors": [".im-chat-input", ".chat-input", "textarea", "[contenteditable=true]", ".ww-editor", ".message-input", ".edit-area"],
        "requireVisible": true,
        "maxWaitMs": 15000,
        "pollIntervalMs": 1000,
        "highlight": true,
        "persistHighlight": true,
        "highlightLabel": "CHAT_INPUT",
        "highlightColor": "#007AFF"
      },
      "next": ["compose_message"]
    },
    {
      "id": "compose_message",
      "type": "ChatComposeNode",
      "config": {
        "hostFilter": "air.1688.com",
        "message": "你好",
        "highlight": true,
        "highlightMs": 5000,
        "sendHighlightColor": "#34c759",
        "sendHighlightLabel": "SEND",
        "persistSendHighlight": false,
        "send": true,
        "stabilizeMs": 1000
      },
      "next": ["wait_message_sent"]
    },
    {
      "id": "wait_message_sent",
      "type": "WaitNode",
      "config": {
        "duration": 2000
      },
      "next": ["close_tab"]
    },
    {
      "id": "close_tab",
      "type": "JavaScriptExecutionNode",
      "config": {
        "script": "window.close();"
      },
      "next": ["end"]
    },
    {
      "id": "end",
      "type": "EndNode",
      "config": {
        "cleanupHighlights": true,
        "persistSession": false
      }
    }
  ]
}