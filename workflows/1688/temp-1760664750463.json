{
  "name": "1688é€šç”¨æœç´¢å·¥ä½œæµæ¨¡æ¿",
  "description": "æ”¯æŒä»»æ„å•†å“æœç´¢ã€è‡ªå®šä¹‰é“¾æ¥æ•°é‡å’Œç¬¬ä¸€æ­¥æ‰“å¼€çš„é€šç”¨1688æœç´¢å·¥ä½œæµ",
  "version": "1.0.0",
  "parameters": {
    "keyword": {
      "type": "string",
      "required": true,
      "description": "æœç´¢å…³é”®è¯ï¼Œæ”¯æŒä¸­æ–‡"
    },
    "maxResults": {
      "type": "number",
      "default": 20,
      "description": "æœ€å¤§ç»“æœæ•°é‡ï¼Œé»˜è®¤20æ¡"
    },
    "openFirstLink": {
      "type": "boolean",
      "default": true,
      "description": "æ˜¯å¦æ‰“å¼€ç¬¬ä¸€æ¡é“¾æ¥"
    },
    "searchCategory": {
      "type": "string",
      "default": "selloffer",
      "description": "æœç´¢ç±»åˆ«ï¼šselloffer(ä¾›åº”) / company(å…¬å¸) / product(äº§å“)"
    }
  },
  "preflows": [
    "1688-login-preflow"
  ],
  "nodes": [
    {
      "id": "start",
      "type": "StartNode",
      "name": "å¼€å§‹",
      "next": [
        "attach"
      ]
    },
    {
      "id": "attach",
      "type": "AttachSessionNode",
      "name": "ä¼šè¯æ¥åŠ›",
      "config": {},
      "next": [
        "prepare_search"
      ]
    },
    {
      "id": "prepare_search",
      "type": "PageSnapshotNode",
      "name": "å‡†å¤‡æœç´¢å‚æ•°",
      "config": {
        "script": "console.log('ğŸ” å‡†å¤‡1688æœç´¢å‚æ•°...'); const params = { keyword: 'é’¢åŒ–è†œ', maxResults: 3, openFirstLink: true, searchCategory: 'selloffer' }; console.log('æœç´¢å‚æ•°:', params); // å°†å…³é”®è¯è½¬æ¢ä¸ºGBKç¼–ç  function toGBK(str) { const buffer = Buffer.from(str, 'utf8'); let gbkStr = ''; const gbkCodeMap = { 'é’¢': '%B8%DC', 'åŒ–': '%BB%AF', 'è†œ': '%C4%AB', 'æœ': '%B7%FE', 'è£…': '%D7%B0', 'æ‰‹': '%CA%D6', 'æœº': '%BB%FA', 'ç”µ': '%B5%E7', 'è„‘': '%C4%D4', 'é‹': '%D0%AC', 'å­': '%D7%D3', 'è¡£': '%D2%C2', 'æœ': '%B7%FE', 'è£¤': '%BF%E3', 'ç«¥': '%CD%AF', 'è£…': '%D7%B0' }; let result = str; for (const [utfChar, gbkCode] of Object.entries(gbkCodeMap)) { if (result.includes(utfChar)) { result = result.replace(new RegExp(utfChar, 'g'), gbkCode); } } // å¯¹äºæœªæ‰¾åˆ°GBKç¼–ç çš„å­—ç¬¦ï¼Œä½¿ç”¨ç®€å•è¿‘ä¼¼ const simpleMap = { 'a': '%61', 'b': '%62', 'c': '%63', 'd': '%64', 'e': '%65', 'f': '%66', 'g': '%67', 'h': '%68', 'i': '%69', 'j': '%6A', 'k': '%6B', 'l': '%6C', 'm': '%6D', 'n': '%6E', 'o': '%6F', 'p': '%70', 'q': '%71', 'r': '%72', 's': '%73', 't': '%74', 'u': '%75', 'v': '%76', 'w': '%77', 'x': '%78', 'y': '%79', 'z': '%7A', '0': '%30', '1': '%31', '2': '%32', '3': '%33', '4': '%34', '5': '%35', '6': '%36', '7': '%37', '8': '%38', '9': '%39' }; for (const char of result) { if (!gbkCodeMap[char] && !simpleMap[char] && /[a-zA-Z0-9]/.test(char)) { result = result.replace(char, '%' + char.charCodeAt(0).toString(16).toUpperCase()); } } return result; } const gbkKeyword = toGBK(params.keyword); const searchUrl = `https://s.1688.com/${params.searchCategory}/offer_search.htm?keywords=${gbkKeyword}`; console.log('ğŸ”— æ„å»ºçš„æœç´¢URL:', searchUrl); return { success: true, searchUrl: searchUrl, params: params, gbkKeyword: gbkKeyword };",
        "saveScreenshots": false
      },
      "next": [
        "navigate_search"
      ]
    },
    {
      "id": "navigate_search",
      "type": "NavigationNode",
      "name": "å¯¼èˆªåˆ°æœç´¢ç»“æœé¡µ",
      "config": {
        "url": "{{previous.searchUrl}}",
        "waitUntil": "domcontentloaded",
        "timeout": 30000
      },
      "next": [
        "wait_search"
      ]
    },
    {
      "id": "wait_search",
      "type": "WaitNode",
      "name": "ç­‰å¾…æœç´¢ç»“æœåŠ è½½",
      "config": {
        "minMs": 3000,
        "maxMs": 5000
      },
      "next": [
        "extract_results"
      ]
    },
    {
      "id": "extract_results",
      "type": "PageSnapshotNode",
      "name": "æå–æœç´¢ç»“æœå’Œé“¾æ¥",
      "config": {
        "script": "console.log('ğŸ“Š æå–1688æœç´¢ç»“æœ...'); const merchants = []; const maxResults = {{previous.params.maxResults}}; const offerItems = document.querySelectorAll('.sm-offer-item, .offer-item, .sm-offer, [class*=offer]'); console.log('æ‰¾åˆ° ' + offerItems.length + ' ä¸ªå•†å“é¡¹'); const extractedItems = []; for (let i = 0; i < Math.min(offerItems.length, maxResults); i++) { const item = offerItems[i]; const title = item.querySelector('h4, [class*=title], a[title]'); const link = item.querySelector('a[href*=\"1688.com\"]'); const price = item.querySelector('[class*=price], [data-price]'); const image = item.querySelector('img[src]'); const contactButton = item.querySelector('[class*=contact], [class*=chat], [class*=im], [class*=æ—ºæ—º], .sm-im, .s-im'); const merchantName = item.querySelector('[class*=company], [class*=name], [class*=shop]'); const merchantLink = link ? link.href : null; const contactLink = contactButton ? contactButton.href || contactButton.getAttribute('data-href') || contactButton.getAttribute('onclick') : null; // æå–merchantId const merchantId = merchantLink ? (merchantLink.includes('member_id=') ? merchantLink.match(/member_id=(\\d+)/)?.[1] : merchantLink.match(/\\/(\\d+)\\.htm/)?.[1]) : null; const merchantData = { index: i, title: title ? title.textContent.trim() : '', merchantName: merchantName ? merchantName.textContent.trim() : '', price: price ? price.textContent.trim() : '', merchantLink: merchantLink, merchantId: merchantId, contactLink: contactLink, contactButton: contactButton ? { className: contactButton.className, text: contactButton.textContent, href: contactButton.href } : null, image: image ? image.src : null, isNew: true }; merchants.push(merchantData); extractedItems.push({ merchantId: merchantId, title: merchantData.title, merchantName: merchantData.merchantName, link: merchantLink }); } const pagination = document.querySelector('.ui-pagination, .pagination'); let paginationInfo = null; if (pagination) { const currentPage = pagination.querySelector('.ui-page-active, .active, .current'); const nextButton = pagination.querySelector('.ui-page-next, .next, [class*=next]:not(.disabled)'); paginationInfo = { hasPagination: true, currentPage: currentPage ? currentPage.textContent.trim() : '1', hasNextPage: !!nextButton && !nextButton.classList.contains('disabled') }; } else { paginationInfo = { hasPagination: false }; } console.log('âœ… æå–å®Œæˆï¼ŒæˆåŠŸæå– ' + merchants.length + ' ä¸ªå•†å®¶ä¿¡æ¯'); return { success: true, merchants: merchants, extractedItems: extractedItems, totalFound: offerItems.length, paginationInfo: paginationInfo, currentUrl: window.location.href, pageTitle: document.title, timestamp: new Date().toISOString(), params: {{previous.params}} };",
        "saveScreenshots": true
      },
      "next": [
        "process_results"
      ]
    },
    {
      "id": "process_results",
      "type": "ConditionalNode",
      "name": "å¤„ç†æœç´¢ç»“æœ",
      "config": {
        "condition": "{{previous.merchants.length > 0}}",
        "trueNext": [
          "check_open_first"
        ],
        "falseNext": [
          "no_results"
        ]
      }
    },
    {
      "id": "check_open_first",
      "type": "ConditionalNode",
      "name": "æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰“å¼€ç¬¬ä¸€æ¡é“¾æ¥",
      "config": {
        "condition": "{{previous.params.openFirstLink}}",
        "trueNext": [
          "open_first_link"
        ],
        "falseNext": [
          "save_results"
        ]
      }
    },
    {
      "id": "open_first_link",
      "type": "NavigationNode",
      "name": "æ‰“å¼€ç¬¬ä¸€æ¡å•†å®¶é“¾æ¥",
      "config": {
        "url": "{{previous.merchants[0].merchantLink}}",
        "waitUntil": "domcontentloaded",
        "timeout": 30000
      },
      "next": [
        "wait_first_page"
      ]
    },
    {
      "id": "wait_first_page",
      "type": "WaitNode",
      "name": "ç­‰å¾…ç¬¬ä¸€æ¡é¡µé¢åŠ è½½",
      "config": {
        "minMs": 2000,
        "maxMs": 3000
      },
      "next": [
        "analyze_first_page"
      ]
    },
    {
      "id": "analyze_first_page",
      "type": "PageSnapshotNode",
      "name": "åˆ†æç¬¬ä¸€æ¡å•†å®¶é¡µé¢",
      "config": {
        "script": "console.log('ğŸ” åˆ†æç¬¬ä¸€æ¡å•†å®¶é¡µé¢...'); const pageInfo = { url: window.location.href, title: document.title, timestamp: new Date().toISOString() }; // æ£€æŸ¥æ˜¯å¦æˆåŠŸæ‰“å¼€å•†å®¶é¡µé¢ const isMerchantPage = window.location.href.includes('1688.com') && (window.location.href.includes('/offer/') || window.location.href.includes('/company/') || window.location.href.includes('member_id=')); // å°è¯•æå–é¡µé¢å…³é”®ä¿¡æ¯ const merchantInfo = {}; const companyTitle = document.querySelector('[class*=company], [class*=title], h1'); const contactInfo = document.querySelector('[class*=contact], [class*=phone], [class*=tel]'); const productImages = document.querySelectorAll('img[src*=\"1688\"]'); merchantInfo.companyName = companyTitle ? companyTitle.textContent.trim() : ''; merchantInfo.hasContact = !!contactInfo; merchantInfo.imageCount = productImages.length; console.log('ğŸ“‹ å•†å®¶é¡µé¢ä¿¡æ¯:', { isMerchantPage, url: pageInfo.url, title: pageInfo.title, merchantInfo }); return { success: true, pageInfo: pageInfo, merchantInfo: merchantInfo, isMerchantPage: isMerchantPage, searchResults: {{previous.merchants}} };",
        "saveScreenshots": true
      },
      "next": [
        "save_results"
      ]
    },
    {
      "id": "no_results",
      "type": "LogNode",
      "name": "æ— æœç´¢ç»“æœ",
      "config": {
        "level": "warn",
        "message": "âš ï¸ æœªæ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœ"
      },
      "next": [
        "end"
      ]
    },
    {
      "id": "save_results",
      "type": "ResultSaverNode",
      "name": "ä¿å­˜å®Œæ•´ç»“æœ",
      "config": {
        "outputDir": "workflows/records",
        "filenameTemplate": "1688-universal-search-é’¢åŒ–è†œ-{timestamp}.json",
        "includeMetadata": true,
        "mergeData": true
      },
      "next": [
        "summary"
      ]
    },
    {
      "id": "summary",
      "type": "LogNode",
      "name": "è¾“å‡ºæ‰§è¡Œæ‘˜è¦",
      "config": {
        "level": "info",
        "message": "ğŸ¯ 1688é€šç”¨æœç´¢å®Œæˆ\\nğŸ“ æœç´¢å…³é”®è¯: é’¢åŒ–è†œ\\nğŸ“Š æå–ç»“æœ: {extract_results.merchants.length} æ¡\\nğŸ”— é¦–æ¡é“¾æ¥: {extract_results.merchants[0]?.merchantLink || 'æ— '}\\nâ° å®Œæˆæ—¶é—´: {extract_results.timestamp}"
      },
      "next": [
        "end"
      ]
    },
    {
      "id": "end",
      "type": "EndNode",
      "name": "ç»“æŸ",
      "config": {
        "cleanup": false,
        "saveLogs": true
      }
    }
  ],
  "globalConfig": {
    "logLevel": "info",
    "screenshotOnError": true,
    "autoCleanup": false,
    "parallelExecution": false,
    "timeout": 180000
  }
}