{
  "name": "1688 首页内搜索（容器化）",
  "version": "1.0.0",
  "variables": { "keyword": "钢化膜" },
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "开始", "next": ["attach"] },
    { "id": "attach", "type": "AttachSessionNode", "name": "会话接力", "config": {}, "next": ["anchor_home_root"] },

    { "id": "anchor_home_root", "type": "ContainerAnchorNode", "name": "首页根容器", "config": { "containerName": "home", "outScopeVar": "homeScope", "highlight": true, "label": "HOME", "durationMs": 1500 }, "next": ["anchor_search_area"] },
    { "id": "anchor_search_area", "type": "ContainerAnchorNode", "name": "定位搜索区域", "config": { "containerName": "home.search", "scopeVar": "homeScope", "outScopeVar": "searchScope", "highlight": true, "label": "SEARCH AREA", "durationMs": 1200 }, "next": ["anchor_input"] },
    { "id": "anchor_input", "type": "ContainerAnchorNode", "name": "定位搜索输入", "config": { "containerName": "home.search.searchbox", "scopeVar": "searchScope", "outScopeVar": "homeInput", "highlight": true, "label": "INPUT", "durationMs": 1500 }, "next": ["type_keyword"] },
    { "id": "type_keyword", "type": "ContainerActionNode", "name": "输入关键字(容器op)", "config": { "containerName": "home.search.searchbox", "scopeVar": "searchScope", "action": "type", "textVar": "keyword", "clear": true }, "next": ["prevent_new_tab"] },
    { "id": "prevent_new_tab", "type": "JavaScriptExecutionNode", "name": "强制同页提交(禁止新标签)", "config": { "script": "(function(){ try{ var box=document.querySelector('.ali-search-box')||document; // override window.open to same-tab\n  if (!window.__wa_override_open){ window.__wa_override_open=true; window.open = function(url){ try{ location.assign(url); }catch{} return null; }; }\n  // force links/buttons to target=_self\n  Array.from(box.querySelectorAll('a,button')).forEach(el=>{ try{ el.setAttribute('target','_self'); el.removeAttribute('rel'); }catch{} });\n  // ensure form target self\n  var inp=document.querySelector('.ali-search-keywords input#alisearch-input, .ali-search-keywords input[name\\u003d\"keywords\"], #alisearch-input, input[name\\u003d\"keywords\"], input#alisearch-keywords');\n  if (inp){ var form=inp.closest('form'); if (form) try{ form.setAttribute('target','_self'); }catch{} }\n  return { success:true }; }catch(e){ return { success:false, error:String(e) }; } })();", "timeout": 4000 }, "next": ["anchor_btn"] },
    { "id": "press_enter_js", "type": "JavaScriptExecutionNode", "name": "回车提交(兜底)", "config": { "script": "(function(){ try{ var sel=\"{homeInput}\"; var el=document.querySelector(sel); if(!el) return { success:false, error:'input not found' }; el.focus(); el.dispatchEvent(new KeyboardEvent('keydown',{key:'Enter',code:'Enter',which:13,keyCode:13,bubbles:true})); return { success:true }; }catch(e){ return { success:false, error:String(e) }; } })();", "timeout": 5000 }, "next": ["anchor_btn"] },
    { "id": "anchor_btn", "type": "ContainerAnchorNode", "name": "定位搜索按钮", "config": { "containerName": "home.search.searchbutton", "scopeVar": "searchScope", "outScopeVar": "homeBtn", "highlight": true, "label": "SEARCH", "durationMs": 1200 }, "next": ["click_btn"] },
    { "id": "click_btn", "type": "ContainerActionNode", "name": "点击搜索按钮", "config": { "containerName": "home.search.searchbutton", "scopeVar": "searchScope", "action": "click" }, "next": ["wait_nav"] },

    { "id": "wait_nav", "type": "WaitNode", "name": "等待跳转", "config": { "minMs": 1500, "maxMs": 3000 }, "next": ["attach_search"] },
    { "id": "attach_search", "type": "AttachHostPageNode", "name": "附着搜索结果", "config": { "urlPattern": "s\\.1688\\.com/.*", "bringToFront": true, "waitUntil": "load", "timeout": 30000 }, "next": ["end"] },
    { "id": "end", "type": "EndNode", "name": "结束", "config": { "cleanup": false, "saveLogs": true } }
  ],
  "globalConfig": { "timeout": 600000, "logLevel": "info" }
}
