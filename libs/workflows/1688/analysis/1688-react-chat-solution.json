{
  "name": "1688 React Chat Solution",
  "description": "é’ˆå¯¹1688 ReactèŠå¤©ç•Œé¢çš„æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼Œå¤„ç†aplusè„šæœ¬æ—¶åºå’ŒReactç»„ä»¶",
  "version": "1.0.0",
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "å¼€å§‹", "next": ["attach"] },
    { "id": "attach", "type": "AttachSessionNode", "name": "ä¼šè¯æ¥åŠ›", "config": {}, "next": ["navigate_search"] },
    {
      "id": "navigate_search",
      "type": "NavigationNode",
      "name": "å¯¼èˆªåˆ°æœç´¢é¡µé¢",
      "config": {
        "url": "https://s.1688.com/selloffer/offer_search.htm?keywords=%B9%A4%D2%B5%B4%F3%B7%E7%C9%C8&spm=a260k.home2025.searchbox.0",
        "waitUntil": "domcontentloaded",
        "timeout": 30000
      },
      "next": ["wait_search"]
    },
    { "id": "wait_search", "type": "WaitNode", "name": "æœç´¢é¡µé¢ç­‰å¾…", "config": { "minMs": 2000, "maxMs": 3000 }, "next": ["dismiss_modals"] },
    { "id": "dismiss_modals", "type": "ModalDismissNode", "name": "å…³é—­æœç´¢é¡µæ¨¡æ€", "config": { "maxAttempts": 4, "retryDelay": 500 }, "next": ["open_chat"] },
    {
      "id": "open_chat",
      "type": "PopupTokenCaptureNode",
      "name": "æ‰“å¼€èŠå¤©çª—å£",
      "config": {
        "containerSelector": ".space-pc-ui2024-content > div:nth-child(5)",
        "clickSelectors": ["a.ww-link.ww-inline", "span.J_WangWang a.ww-link", "a[href*=air.1688.com/app/]"],
        "hostFilter": "air.1688.com",
        "maxItems": 1,
        "minClickDelay": 500,
        "maxClickDelay": 1500,
        "afterPopupWaitMs": 5000,
        "closePopup": false,
        "popupClickSelectors": ["body > div:nth-child(23)"],
        "dryMode": false,
        "enforceWebPreference": true,
        "popupStepGate": false
      },
      "next": ["wait_for_react"]
    },
    {
      "id": "wait_for_react",
      "type": "WaitNode",
      "name": "ç­‰å¾…Reactç»„ä»¶åŠ è½½",
      "config": { "minMs": 3000, "maxMs": 5000 },
      "next": ["react_injection"]
    },
    {
      "id": "react_injection",
      "type": "ScriptTokenExtractorNode",
      "name": "Reactç»„ä»¶æ³¨å…¥å’Œæµ‹è¯•",
      "config": {
        "hostFilter": "air.1688.com",
        "waitForSelector": "[data-reactroot], [class*='react'], [class*='React'], #app",
        "scripts": [
          {
            "name": "ç­‰å¾…aplusè„šæœ¬åŠ è½½å®Œæˆ",
            "code": "function waitForAplus() { return new Promise((resolve) => { if (window.aplus && window.aplusReady) { resolve('aplus ready'); } else { setTimeout(() => resolve('aplus timeout'), 2000); } }); } waitForAplus();"
          },
          {
            "name": "æ£€æµ‹ReactèŠå¤©ç»„ä»¶",
            "code": "function detectReactChat() { const reactRoot = document.querySelector('[data-reactroot]'); if (reactRoot) { const chatElements = reactRoot.querySelectorAll('*'); const chatInput = Array.from(chatElements).find(el => el.contentEditable === 'true' || el.getAttribute('contenteditable') === 'true'); return { reactFound: true, chatInput: chatInput ? chatInput.tagName + '.' + chatInput.className : 'not found' }; } return { reactFound: false }; } detectReactChat();"
          },
          {
            "name": "æ·±åº¦æ‰«æè¾“å…¥ç»„ä»¶",
            "code": "function deepScanInput() { const allElements = document.querySelectorAll('*'); const candidates = []; allElements.forEach(el => { if (el.contentEditable === 'true' || el.getAttribute('contenteditable') === 'true' || el.isContentEditable) { const rect = el.getBoundingClientRect(); if (rect.width > 10 && rect.height > 10) { candidates.push({ tag: el.tagName, class: el.className, id: el.id, rect: { x: rect.x, y: rect.y, width: rect.width, height: rect.height } }); } } }); return candidates; } deepScanInput();"
          },
          {
            "name": "æ¨¡æ‹ŸReactè¾“å…¥äº‹ä»¶",
            "code": "function simulateReactInput() { const targets = document.querySelectorAll('[contenteditable=\"true\"], [contenteditable]'); for (let target of targets) { try { const reactEvent = new Event('input', { bubbles: true }); target.focus(); target.innerText = 'TEST_REACT_INPUT'; target.dispatchEvent(reactEvent); return { success: true, element: target.tagName + '.' + target.className }; } catch (e) { return { success: false, error: e.message }; } } return { success: false, error: 'no contenteditable elements found' }; } simulateReactInput();"
          },
          {
            "name": "æŸ¥æ‰¾å‘é€æŒ‰é’®ï¼ˆReacté£æ ¼ï¼‰",
            "code": "function findReactSendButton() { const buttons = document.querySelectorAll('button, [role=\"button\"], div[onclick]'); const sendButtons = []; buttons.forEach(btn => { const text = btn.innerText || btn.textContent || ''; if (text.includes('å‘é€') || text.includes('Send')) { const rect = btn.getBoundingClientRect(); if (rect.width > 10 && rect.height > 10) { sendButtons.push({ tag: btn.tagName, class: btn.className, text: text, rect: { x: rect.x, y: rect.y, width: rect.width, height: rect.height } }); } } }); return sendButtons; } findReactSendButton();"
          }
        ],
        "saveResults": true,
        "outputDir": "archive/workflow-records"
      },
      "next": ["custom_chat_test"]
    },
    {
      "id": "custom_chat_test",
      "type": "GateOverlayNode",
      "name": "è‡ªå®šä¹‰èŠå¤©æµ‹è¯•",
      "config": {
        "hostFilter": "air.1688.com",
        "title": "ğŸš€ ReactèŠå¤©ç»„ä»¶åˆ†æå®Œæˆ",
        "message": "å·²å®ŒæˆReactç»„ä»¶æ·±åº¦åˆ†æï¼Œç°åœ¨è¯·æ‰‹åŠ¨æµ‹è¯•ï¼š\\n\\nğŸ“‹ åˆ†æç»“æœï¼š\\nâœ… aplusè„šæœ¬æ—¶åºå¤„ç†å®Œæˆ\\nâœ… Reactç»„ä»¶æ£€æµ‹å®Œæˆ\\nâœ… æ·±åº¦è¾“å…¥æ‰«æå®Œæˆ\\nâœ… Reactäº‹ä»¶æ¨¡æ‹Ÿæµ‹è¯•å®Œæˆ\\nâœ… å‘é€æŒ‰é’®è¯†åˆ«å®Œæˆ\\n\\nğŸ”§ æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤ï¼š\\n1. å°è¯•åœ¨èŠå¤©ç•Œé¢è¾“å…¥æ–‡å­—\\n2. è§‚å¯Ÿæ˜¯å¦æœ‰Reactç»„ä»¶å“åº”\\n3. æ£€æŸ¥å‘é€æŒ‰é’®æ˜¯å¦å¯ç‚¹å‡»\\n4. æŒ‰F12æŸ¥çœ‹Consoleä¸­çš„Reactäº‹ä»¶æ—¥å¿—\\n\\nğŸ’¡ åŸºäºåˆ†æç»“æœï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸“ç”¨çš„1688 ReactèŠå¤©è§£å†³æ–¹æ¡ˆã€‚\\n\\nç‚¹å‡»'ä¸‹ä¸€æ­¥'ç”Ÿæˆæœ€ç»ˆè§£å†³æ–¹æ¡ˆ",
        "stepGate": true,
        "block": true
      },
      "next": ["final_solution"]
    },
    {
      "id": "final_solution",
      "type": "ResultSaverNode",
      "name": "ä¿å­˜æœ€ç»ˆè§£å†³æ–¹æ¡ˆ",
      "config": {
        "outputDir": "archive/workflow-records",
        "filenameTemplate": "1688-react-chat-solution-{timestamp}.json",
        "includeMetadata": true,
        "customData": {
          "problem": "1688 uses React-based chat with aplus script dependencies",
          "solution": "Custom React component targeting with proper script timing",
          "implementation": "Enhanced ChatComposeNode with React detection and custom event handling"
        }
      },
      "next": ["end"]
    },
    {
      "id": "end",
      "type": "EndNode",
      "name": "ç»“æŸ",
      "config": { "cleanup": false, "saveLogs": true }
    }
  ],
  "globalConfig": {
    "logLevel": "info",
    "screenshotOnError": true,
    "autoCleanup": false,
    "parallelExecution": false,
    "timeout": 900000
  }
}