{
  "name": "1688 Advanced Chat Probe",
  "description": "æ·±åº¦æ¢æµ‹1688èŠå¤©ç•Œé¢çš„Shadow DOMã€iframeå’Œè‡ªå®šä¹‰ç»„ä»¶",
  "version": "1.0.0",
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "å¼€å§‹", "next": ["attach"] },
    { "id": "attach", "type": "AttachSessionNode", "name": "ä¼šè¯æ¥åŠ›", "config": {}, "next": ["navigate_search"] },
    {
      "id": "navigate_search",
      "type": "NavigationNode",
      "name": "å¯¼èˆªåˆ°æœç´¢é¡µé¢",
      "config": {
        "url": "https://s.1688.com/selloffer/offer_search.htm?keywords=%B9%A4%D2%B5%B4%F3%B7%E7%C9%C8&spm=a260k.home2025.searchbox.0",
        "waitUntil": "domcontentloaded",
        "timeout": 30000
      },
      "next": ["wait_search"]
    },
    { "id": "wait_search", "type": "WaitNode", "name": "æœç´¢é¡µé¢ç­‰å¾…", "config": { "minMs": 2000, "maxMs": 3000 }, "next": ["dismiss_modals"] },
    { "id": "dismiss_modals", "type": "ModalDismissNode", "name": "å…³é—­æœç´¢é¡µæ¨¡æ€", "config": { "maxAttempts": 4, "retryDelay": 500 }, "next": ["open_chat"] },
    {
      "id": "open_chat",
      "type": "PopupTokenCaptureNode",
      "name": "æ‰“å¼€èŠå¤©çª—å£",
      "config": {
        "containerSelector": ".space-pc-ui2024-content > div:nth-child(5)",
        "clickSelectors": ["a.ww-link.ww-inline", "span.J_WangWang a.ww-link", "a[href*=air.1688.com/app/]"],
        "hostFilter": "air.1688.com",
        "maxItems": 1,
        "minClickDelay": 500,
        "maxClickDelay": 1500,
        "afterPopupWaitMs": 3000,
        "closePopup": false,
        "popupClickSelectors": ["body > div:nth-child(23)"],
        "dryMode": false,
        "enforceWebPreference": true,
        "popupStepGate": false
      },
      "next": ["deep_probe"]
    },
    {
      "id": "deep_probe",
      "type": "SelectorProbeNode",
      "name": "æ·±åº¦DOMæ¢æµ‹",
      "config": {
        "targetPopup": true,
        "probes": [
          {
            "name": "Shadow DOMæ¢æµ‹",
            "selectors": ["*"],
            "action": "shadow-dom-scan",
            "description": "æ‰«ææ‰€æœ‰å…ƒç´ çš„Shadow DOM"
          },
          {
            "name": "iframeæ¢æµ‹",
            "selectors": ["iframe"],
            "action": "iframe-content-scan",
            "description": "æ‰«æiframeå†…å®¹"
          },
          {
            "name": "è‡ªå®šä¹‰ç»„ä»¶æ¢æµ‹",
            "selectors": ["[class*='chat']", "[class*='im']", "[class*='message']", "[class*='compose']", "[class*='editor']"],
            "action": "component-scan",
            "description": "æ‰«æèŠå¤©ç›¸å…³ç»„ä»¶"
          },
          {
            "name": "React/Vueç»„ä»¶æ¢æµ‹",
            "selectors": ["[data-reactroot]", "[data-v-]", "[class*='vue-']"],
            "action": "framework-scan",
            "description": "æ‰«ææ¡†æ¶ç”Ÿæˆçš„ç»„ä»¶"
          }
        ],
        "saveScreenshots": true,
        "saveHtml": true,
        "outputDir": "archive/workflow-records"
      },
      "next": ["js_probe"]
    },
    {
      "id": "js_probe",
      "type": "GateOverlayNode",
      "name": "JavaScriptæ·±åº¦æ¢æµ‹",
      "config": {
        "hostFilter": "air.1688.com",
        "title": "ğŸ”¬ JavaScriptæ·±åº¦æ¢æµ‹",
        "message": "è¯·è¿è¡Œä»¥ä¸‹JavaScriptä»£ç è¿›è¡Œæ·±åº¦æ¢æµ‹ï¼š\n\n1ï¸âƒ£ Shadow DOMæ¢æµ‹ï¼š\n// æŸ¥æ‰¾æ‰€æœ‰åŒ…å«Shadow DOMçš„å…ƒç´ \ndocument.querySelectorAll('*').forEach(el => {\n  if (el.shadowRoot) {\n    console.log('Shadow DOMå…ƒç´ :', el);\n    console.log('Shadowå†…å®¹:', el.shadowRoot.innerHTML);\n  }\n});\n\n2ï¸âƒ£ iframeå†…å®¹æ¢æµ‹ï¼š\n// æŸ¥çœ‹æ‰€æœ‰iframeå†…å®¹\ndocument.querySelectorAll('iframe').forEach((frame, index) => {\n  try {\n    const doc = frame.contentDocument || frame.contentWindow.document;\n    console.log(`iframe ${index}å†…å®¹:`, doc.body.innerHTML);\n  } catch(e) {\n    console.log(`iframe ${index}è·¨åŸŸ:`, e.message);\n  }\n});\n\n3ï¸âƒ£ æ·±åº¦å…ƒç´ æ‰«æï¼š\n// æ‰«ææ‰€æœ‰å¯èƒ½çš„å¯ç¼–è¾‘å…ƒç´ \nfunction scanEditableElements(root = document) {\n  const elements = [];\n  const walker = document.createTreeWalker(\n    root,\n    NodeFilter.SHOW_ELEMENT,\n    {\n      acceptNode: (node) => {\n        const tag = node.tagName.toLowerCase();\n        const editable = node.contentEditable === 'true' || \n                       node.isContentEditable ||\n                       node.getAttribute('contenteditable') === 'true';\n        const hasInputAttrs = node.hasAttribute('data-input') ||\n                           node.hasAttribute('role') && node.getAttribute('role') === 'textbox';\n        \n        if (editable || hasInputAttrs || \n            tag.includes('input') || \n            tag.includes('textarea') ||\n            node.onclick || node.oninput || node.onchange) {\n          elements.push(node);\n          // é«˜äº®æ˜¾ç¤º\n          node.style.border = '2px solid red';\n          node.style.backgroundColor = 'rgba(255,0,0,0.1)';\n        }\n        return NodeFilter.FILTER_SKIP;\n      }\n    }\n  );\n  \n  let node;\n  while (node = walker.nextNode()) {\n    // å·²åœ¨acceptNodeä¸­å¤„ç†\n  }\n  \n  return elements;\n}\n\nconst editableElements = scanEditableElements();\nconsole.log('å¯ç¼–è¾‘å…ƒç´ æ•°é‡:', editableElements.length);\neditableElements.forEach((el, i) => {\n  console.log(`å…ƒç´  ${i}:`, el.tagName, el.className, el.id);\n});\n\nè¿è¡Œå®Œæ¯•åç‚¹å‡»'ä¸‹ä¸€æ­¥'",
        "stepGate": true,
        "block": true
      },
      "next": ["manual_input_test"]
    },
    {
      "id": "manual_input_test",
      "type": "GateOverlayNode",
      "name": "æ‰‹åŠ¨è¾“å…¥æµ‹è¯•",
      "config": {
        "hostFilter": "air.1688.com",
        "title": "âœï¸ æ‰‹åŠ¨è¾“å…¥æµ‹è¯•",
        "message": "ç°åœ¨è¯·æ‰‹åŠ¨æµ‹è¯•è¾“å…¥åŠŸèƒ½ï¼š\n\nğŸ” å°è¯•ä»¥ä¸‹æ“ä½œï¼š\n1. ç‚¹å‡»èŠå¤©ç•Œé¢çš„ä»»ä½•åœ°æ–¹\n2. å°è¯•è¾“å…¥æ–‡å­—\n3. è§‚å¯Ÿå“ªé‡Œå‡ºç°å…‰æ ‡æˆ–è¾“å…¥æ¡†\n4. è®°å½•èƒ½è¾“å…¥æ–‡å­—çš„å…ƒç´ \n\nğŸ’¡ å¦‚æœæ‰¾ä¸åˆ°è¾“å…¥æ¡†ï¼Œå¯èƒ½éœ€è¦ï¼š\n- ç‚¹å‡»ç‰¹å®šåŒºåŸŸæ¿€æ´»è¾“å…¥æ¨¡å¼\n- ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½\n- æ£€æŸ¥æ˜¯å¦æœ‰éšè—çš„è¾“å…¥ç»„ä»¶\n\næµ‹è¯•å®Œæˆåç‚¹å‡»'ä¸‹ä¸€æ­¥'",
        "stepGate": true,
        "block": true
      },
      "next": ["find_send_button"]
    },
    {
      "id": "find_send_button",
      "type": "GateOverlayNode",
      "name": "æŸ¥æ‰¾å‘é€æŒ‰é’®",
      "config": {
        "hostFilter": "air.1688.com",
        "title": "ğŸ“¤ æŸ¥æ‰¾å‘é€æŒ‰é’®",
        "message": "è¯·æŸ¥æ‰¾å‘é€æŒ‰é’®ï¼š\n\nğŸ” è¿è¡Œä»¥ä¸‹ä»£ç æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½çš„å‘é€æŒ‰é’®ï¼š\n\n// æŸ¥æ‰¾æ‰€æœ‰æŒ‰é’®\ndocument.querySelectorAll('button, a, span, div, [role=\"button\"]').forEach(el => {\n  const text = (el.innerText || el.textContent || '').trim();\n  const rect = el.getBoundingClientRect();\n  \n  if (rect.width > 0 && rect.height > 0 && text.length < 50) {\n    // é«˜äº®æ‰€æœ‰æŒ‰é’®\n    el.style.border = '2px solid blue';\n    el.style.backgroundColor = 'rgba(0,0,255,0.1)';\n    console.log('æŒ‰é’®:', text, el.tagName, el.className);\n  }\n});\n\n// ç‰¹åˆ«æŸ¥æ‰¾å¯èƒ½çš„å‘é€æŒ‰é’®\n['å‘é€', 'Send', 'æäº¤', 'Submit', 'ç¡®å®š', 'OK'].forEach(sendText => {\n  document.querySelectorAll('*').forEach(el => {\n    const text = (el.innerText || el.textContent || '').trim();\n    if (text === sendText) {\n      el.style.border = '3px solid red';\n      el.style.backgroundColor = 'rgba(255,0,0,0.2)';\n      console.log('å¯èƒ½çš„å‘é€æŒ‰é’®:', el);\n    }\n  });\n});\n\næ£€æŸ¥å®Œæˆåç‚¹å‡»'ä¸‹ä¸€æ­¥'",
        "stepGate": true,
        "block": true
      },
      "next": ["save_results"]
    },
    {
      "id": "save_results",
      "type": "ResultSaverNode",
      "name": "ä¿å­˜æ¢æµ‹ç»“æœ",
      "config": {
        "outputDir": "archive/workflow-records",
        "filenameTemplate": "1688-advanced-chat-probe-{timestamp}.json",
        "includeMetadata": true
      },
      "next": ["end"]
    },
    {
      "id": "end",
      "type": "EndNode",
      "name": "ç»“æŸ",
      "config": { "cleanup": false, "saveLogs": true }
    }
  ],
  "globalConfig": {
    "logLevel": "info",
    "screenshotOnError": true,
    "autoCleanup": false,
    "parallelExecution": false,
    "timeout": 900000
  }
}