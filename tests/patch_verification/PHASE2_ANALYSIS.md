# Phase 2 æœç´¢æµç¨‹åˆ†ææŠ¥å‘Š

## å½“å‰ Phase 2 è„šæœ¬

**æ–‡ä»¶**: `scripts/xiaohongshu/tests/phase2-search-v3.mjs`

## æµç¨‹æ­¥éª¤

### 1ï¸âƒ£ è¿›å…¥å‰æ£€æŸ¥
- **ç›®çš„**: ç¡®è®¤å½“å‰åœ¨ä¸»é¡µ
- **æ–¹æ³•**: `detectPageState()` è·å–æ ¹å®¹å™¨ ID
- **é—®é¢˜**: ä»…æ£€æŸ¥æ ¹å®¹å™¨å­˜åœ¨ï¼Œæœªå¼ºåˆ¶éªŒè¯å¿…é¡»æ˜¯ä¸»é¡µ

### 2ï¸âƒ£ è¯·æ±‚ SearchGate è®¸å¯
- **ç›®çš„**: é˜²æ­¢é¢‘ç¹æœç´¢è§¦å‘é£æ§
- **æ–¹æ³•**: è°ƒç”¨ `http://127.0.0.1:7790/permit`
- **é—®é¢˜**: å¦‚æœ SearchGate æœªå¯åŠ¨ä¼šç›´æ¥å¤±è´¥é€€å‡º

### 3ï¸âƒ£ æ£€æŸ¥é£æ§çŠ¶æ€
- **ç›®çš„**: æ£€æµ‹æ˜¯å¦å‡ºç°éªŒè¯ç /ç™»å½•æ¡†
- **æ–¹æ³•**: åœ¨å®¹å™¨æ ‘ä¸­æŸ¥æ‰¾ `qrcode_guard` å®¹å™¨
- **é—®é¢˜**: å¦‚æœå·²é£æ§ï¼Œä¼šå°è¯•è¿”å›å‘ç°é¡µï¼Œä½†æ²¡æœ‰é‡è¯•æœºåˆ¶

### 4ï¸âƒ£ éªŒè¯æœç´¢æ¡†é”šç‚¹
- **ç›®çš„**: ç¡®è®¤æœç´¢æ¡†å¯è§
- **æ–¹æ³•**: é«˜äº® `xiaohongshu_home.search_input` å®¹å™¨
- **é—®é¢˜**: âœ… ä½¿ç”¨å®¹å™¨é«˜äº®ï¼Œç¬¦åˆè§„èŒƒ

### 5ï¸âƒ£ æ‰§è¡Œæœç´¢
- **ç›®çš„**: è¾“å…¥å…³é”®å­—å¹¶è§¦å‘æœç´¢
- **æ–¹æ³•**: è°ƒç”¨ `container:operation` çš„ `type` æ“ä½œï¼Œ`submit: true`
- **é—®é¢˜**: âœ… é€šè¿‡å®¹å™¨æ“ä½œï¼Œç¬¦åˆå®‰å…¨è§„èŒƒ

### 6ï¸âƒ£ ç­‰å¾…å¯¼èˆª
- **ç›®çš„**: ç­‰å¾…æœç´¢ç»“æœé¡µåŠ è½½
- **æ–¹æ³•**: å›ºå®šç­‰å¾… 3 ç§’
- **é—®é¢˜**: âš ï¸ ç¡¬ç¼–ç ç­‰å¾…æ—¶é—´ï¼Œå¯èƒ½è¿‡çŸ­æˆ–è¿‡é•¿

### 7ï¸âƒ£ é€€å‡ºåæ£€æŸ¥
- **ç›®çš„**: ç¡®è®¤å·²å¯¼èˆªåˆ°æœç´¢ç»“æœé¡µ
- **æ–¹æ³•**: æ£€æŸ¥æ ¹å®¹å™¨ ID æ˜¯å¦åŒ…å« 'search'
- **é—®é¢˜**: âš ï¸ ä»…æ£€æŸ¥æ ¹å®¹å™¨åç§°ï¼ŒæœªéªŒè¯å®é™…å†…å®¹

### 8ï¸âƒ£ éªŒè¯æœç´¢ç»“æœåˆ—è¡¨é”šç‚¹
- **ç›®çš„**: ç¡®è®¤æœç´¢ç»“æœåˆ—è¡¨å­˜åœ¨
- **æ–¹æ³•**: é«˜äº® `xiaohongshu_search.search_result_list` å®¹å™¨
- **é—®é¢˜**: âœ… ä½¿ç”¨å®¹å™¨å®šä½

### 9ï¸âƒ£ é‡‡é›†ç»“æœ
- **ç›®çš„**: è·å–æœç´¢ç»“æœåˆ—è¡¨
- **æ–¹æ³•**: è°ƒç”¨ `containers:inspect-container` è·å–å­å®¹å™¨
- **è¿”å›**: `note_id`, `title` ç­‰å­—æ®µ
- **å»é‡**: åŸºäº `note_id`
- **é—®é¢˜**: âš ï¸ æœªéªŒè¯æ¯ä¸ª note_id çš„æœ‰æ•ˆæ€§

## æ ¸å¿ƒé—®é¢˜æ±‡æ€»

### ğŸ”´ é«˜ä¼˜å…ˆçº§é—®é¢˜

1. **é“¾æ¥æœ‰æ•ˆæ€§æœªéªŒè¯**
   - å½“å‰åªé‡‡é›† `note_id`ï¼Œä½†æœªéªŒè¯è¿™äº› ID æ˜¯å¦å¯è®¿é—®
   - å¯èƒ½è¿”å›å¤±æ•ˆ/é£æ§çš„é“¾æ¥

2. **å¯¼èˆªç­‰å¾…ä¸å¯é **
   - å›ºå®šç­‰å¾… 3 ç§’å¯èƒ½ä¸å¤Ÿ
   - åº”è¯¥ç›‘å¬å®é™…é¡µé¢åŠ è½½å®Œæˆäº‹ä»¶

3. **SearchGate ä¾èµ–å¼ºåˆ¶**
   - å¦‚æœ SearchGate æœªå¯åŠ¨ç›´æ¥å¤±è´¥
   - åº”è¯¥æä¾›é™çº§æ–¹æ¡ˆæˆ–æ›´æ¸…æ™°çš„é”™è¯¯æç¤º

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§é—®é¢˜

4. **é£æ§æ¢å¤æœºåˆ¶ä¸å®Œå–„**
   - æ£€æµ‹åˆ°é£æ§åå°è¯•è¿”å›ï¼Œä½†åªå°è¯•ä¸€æ¬¡
   - åº”è¯¥æœ‰æ›´å®Œå–„çš„æ¢å¤ç­–ç•¥

5. **é‡‡é›†æ•°é‡éªŒè¯ä¸å……åˆ†**
   - åªæ£€æŸ¥æ˜¯å¦ >= 5 æ¡ï¼Œä½†ä¸éªŒè¯è´¨é‡
   - åº”è¯¥éªŒè¯æ¯æ¡æ˜¯å¦åŒ…å«å¿…éœ€å­—æ®µ

### ğŸŸ¢ ä½ä¼˜å…ˆçº§é—®é¢˜

6. **æ—¥å¿—è¾“å‡ºä¸å¤Ÿè¯¦ç»†**
   - ç¼ºå°‘æ—¶é—´æˆ³
   - ç¼ºå°‘æ¯æ­¥è€—æ—¶ç»Ÿè®¡

## å»ºè®®æ”¹è¿›æ–¹æ¡ˆ

### æ–¹æ¡ˆ A: æœ€å°æ”¹åŠ¨ï¼ˆå¿«é€Ÿä¿®å¤ï¼‰

1. åœ¨æ­¥éª¤ 9 åå¢åŠ "é“¾æ¥æœ‰æ•ˆæ€§éªŒè¯"ï¼š
   - éšæœºæŠ½å– 1-2 æ¡ç»“æœ
   - å°è¯•è®¿é—®è¯¦æƒ…é¡µ
   - éªŒè¯æ˜¯å¦æˆåŠŸåŠ è½½

2. å°†æ­¥éª¤ 6 çš„å›ºå®šç­‰å¾…æ”¹ä¸ºï¼š
   - è½®è¯¢æ£€æŸ¥æœç´¢ç»“æœå®¹å™¨æ˜¯å¦å‡ºç°
   - æœ€å¤šç­‰å¾… 10 ç§’

3. SearchGate é™çº§ï¼š
   - å¦‚æœ SearchGate æœªå“åº”ï¼Œè­¦å‘Šä½†ç»§ç»­æ‰§è¡Œ
   - è®°å½•è·³è¿‡ SearchGate çš„æ¬¡æ•°

### æ–¹æ¡ˆ B: å®Œæ•´é‡æ„ï¼ˆæ¨èï¼‰

1. å¢åŠ  `validateSearchResult()` å‡½æ•°ï¼š
```javascript
async function validateSearchResult(noteId) {
  // æ„é€ è¯¦æƒ…é¡µå®¹å™¨ ID
  const detailUrl = `https://www.xiaohongshu.com/explore/${noteId}`;
  
  // é€šè¿‡å®¹å™¨å¯¼èˆªï¼ˆç¦æ­¢ç›´æ¥æ„é€  URLï¼‰
  // æ–¹æ³•ï¼šåœ¨æœç´¢ç»“æœä¸­æ‰¾åˆ°å¯¹åº” note_id çš„å®¹å™¨å¹¶ç‚¹å‡»
  
  // éªŒè¯è¯¦æƒ…é¡µæ˜¯å¦æˆåŠŸåŠ è½½
  // è¿”å› true/false
}
```

2. é‡‡é›†åéªŒè¯ï¼š
```javascript
// é‡‡é›†ç»“æœå
const validItems = [];
for (const item of dedupedItems.slice(0, 3)) {
  const isValid = await validateSearchResult(item.note_id);
  if (isValid) {
    validItems.push(item);
  }
}

if (validItems.length < MIN_RESULTS) {
  console.error('âŒ æœ‰æ•ˆç»“æœä¸è¶³');
  process.exit(1);
}
```

3. æ”¹è¿›å¯¼èˆªç­‰å¾…ï¼š
```javascript
async function waitForSearchResults(maxWaitMs = 10000) {
  const startTime = Date.now();
  while (Date.now() - startTime < maxWaitMs) {
    const exists = await checkContainerExists('xiaohongshu_search.search_result_list');
    if (exists) return true;
    await delay(500);
  }
  return false;
}
```

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### é€‰é¡¹ 1: å…ˆæ‰§è¡Œå½“å‰ç‰ˆæœ¬ï¼Œè®°å½•é—®é¢˜
- è¿è¡Œ phase2-search-v3.mjs
- è®°å½•å®é™…é‡‡é›†çš„ note_id
- æ‰‹åŠ¨éªŒè¯è¿™äº› ID æ˜¯å¦å¯è®¿é—®
- æ ¹æ®å®é™…æƒ…å†µå†³å®šæ˜¯å¦éœ€è¦æ”¹è¿›

### é€‰é¡¹ 2: ç«‹å³å®æ–½æ–¹æ¡ˆ Aï¼ˆæ¨èï¼‰
- é¢„è®¡è€—æ—¶ï¼š30 åˆ†é’Ÿ
- ä¿®æ”¹ phase2-search-v3.mjs
- å¢åŠ é“¾æ¥éªŒè¯é€»è¾‘
- æµ‹è¯•éªŒè¯

### é€‰é¡¹ 3: å®æ–½æ–¹æ¡ˆ Bï¼ˆå½»åº•è§£å†³ï¼‰
- é¢„è®¡è€—æ—¶ï¼š2 å°æ—¶
- é‡æ„ phase2-search-v3.mjs
- å¢åŠ å®Œæ•´éªŒè¯æœºåˆ¶
- ç¼–å†™æµ‹è¯•ç”¨ä¾‹

## ç»“è®º

**å½“å‰ Phase 2 è„šæœ¬åŸºæœ¬å¯ç”¨ï¼Œä½†ç¼ºå°‘é“¾æ¥æœ‰æ•ˆæ€§éªŒè¯**

å»ºè®®ï¼š
1. å…ˆæ‰§è¡Œä¸€æ¬¡å½“å‰ç‰ˆæœ¬ï¼Œè§‚å¯Ÿå®é™…æ•ˆæœ
2. å¦‚æœé‡‡é›†çš„é“¾æ¥æœ‰æ•ˆç‡ä½ï¼Œç«‹å³å®æ–½æ–¹æ¡ˆ A
3. é•¿æœŸè§„åˆ’å®æ–½æ–¹æ¡ˆ B

