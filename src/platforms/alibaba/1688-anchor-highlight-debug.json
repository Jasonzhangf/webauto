{
  "name": "1688é”šç‚¹é«˜äº®è°ƒè¯•æµ‹è¯•",
  "description": "è°ƒè¯•1688é¡µé¢é”šç‚¹é«˜äº®åŠŸèƒ½ï¼ŒåŒ…å«è¯¦ç»†æ—¥å¿—",
  "version": "1.0.0",
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "å¼€å§‹", "next": ["ensure_camoufox"] },
    { "id": "ensure_camoufox", "type": "CamoufoxEnsureNode", "name": "Camoufox æ ¡éªŒ/å®‰è£…", "config": {}, "next": ["browser_init"] },
    {
      "id": "browser_init",
      "type": "BrowserInitNode",
      "name": "æµè§ˆå™¨åˆå§‹åŒ–",
      "config": {
        "engine": "camoufox",
        "headless": false,
        "viewport": { "width": 1920, "height": 1080 },
        "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
        "strictAutomationMitigation": false,
        "extraHeaders": false,
        "launchArgs": [
          "--disable-blink-features=AutomationControlled",
          "--disable-web-security",
          "--no-first-run",
          "--disable-default-apps",
          "--disable-sync",
          "--metrics-recording-only",
          "--disable-default-browser-check",
          "--disable-background-networking",
          "--disable-background-timer-throttling",
          "--disable-renderer-backgrounding",
          "--disable-backgrounding-occluded-windows",
          "--disable-extensions",
          "--disable-plugins-discovery",
          "--disable-ipc-flooding-protection",
          "--shuffle-messagetypes",
          "--disable-gpu",
          "--disable-dev-shm-usage",
          "--no-sandbox",
          "--disable-setuid-sandbox",
          "--lang=zh-CN",
          "--accept-lang=zh-CN,zh"
        ]
      },
      "next": ["load_cookies"]
    },
    {
      "id": "load_cookies",
      "type": "CookieLoaderNode",
      "name": "åŠ è½½Cookie",
      "config": {
        "cookiePath": "~/.webauto/cookies/1688-domestic.json"
      },
      "next": ["navigate_search"]
    },
    {
      "id": "navigate_search",
      "type": "NavigationNode",
      "name": "å¯¼èˆªåˆ°é’¢åŒ–è†œæœç´¢é¡µ",
      "config": {
        "url": "https://s.1688.com/selloffer/offer_search.htm?keywords=%B8%D6%BB%AF%C4%A4",
        "waitUntil": "domcontentloaded",
        "timeout": 30000
      },
      "next": ["page_analysis"]
    },
    {
      "id": "page_analysis",
      "type": "PageSnapshotNode",
      "name": "é¡µé¢ç»“æ„åˆ†æ",
      "config": {
        "script": "console.log('ğŸ” å¼€å§‹é¡µé¢ç»“æ„åˆ†æ...');\n\n// åˆ†æé¡µé¢åŸºæœ¬ç»“æ„\nconst pageUrl = window.location.href;\nconst pageTitle = document.title;\nconsole.log(`é¡µé¢URL: ${pageUrl}`);\nconsole.log(`é¡µé¢æ ‡é¢˜: ${pageTitle}`);\n\n// åˆ†ææ‰€æœ‰å¯èƒ½çš„é€‰æ‹©å™¨\nconst allSelectors = [\n  '.sm-offer-item',\n  '.offer-item', \n  '.sm-offer',\n  '[class*=offer]',\n  '.sm-offer-item-wrapper',\n  '.s-widget-offer',\n  '.offer-list-item',\n  '.sm-offer-card',\n  '.sm-offer-list .sm-offer-item',\n  '.offer-list .offer-item',\n  '[class*=\"offer\"]',\n  '[class*=\"product\"]',\n  '[class*=\"item\"]'\n];\n\nconst selectorResults = {};\n\nfor (const selector of allSelectors) {\n  try {\n    const elements = document.querySelectorAll(selector);\n    selectorResults[selector] = {\n      count: elements.length,\n      visible: 0,\n      hasLink: 0\n    };\n    \n    elements.forEach((el, index) => {\n      // æ£€æŸ¥å¯è§æ€§\n      const rect = el.getBoundingClientRect();\n      const isVisible = rect.width > 0 && rect.height > 0;\n      if (isVisible) selectorResults[selector].visible++;\n      \n      // æ£€æŸ¥æ˜¯å¦åŒ…å«é“¾æ¥\n      const hasLink = el.querySelector('a[href*=\"1688.com\"]');\n      if (hasLink) selectorResults[selector].hasLink++;\n      \n      // åªæ˜¾ç¤ºå‰3ä¸ªå…ƒç´ çš„è¯¦ç»†ä¿¡æ¯\n      if (index < 3) {\n        console.log(`é€‰æ‹©å™¨ ${selector}[${index}]:`, {\n          text: el.textContent.trim().substring(0, 100),\n          visible: isVisible,\n          hasLink: !!hasLink,\n          rect: {\n            width: rect.width,\n            height: rect.height,\n            top: rect.top,\n            left: rect.left\n          }\n        });\n      }\n    });\n    \n    console.log(`é€‰æ‹©å™¨ ${selector}: æ€»æ•°=${elements.length}, å¯è§=${selectorResults[selector].visible}, æœ‰é“¾æ¥=${selectorResults[selector].hasLink}`);\n  } catch (e) {\n    console.error(`é€‰æ‹©å™¨ ${selector} é”™è¯¯:`, e.message);\n    selectorResults[selector] = { error: e.message };\n  }\n}\n\n// æ‰¾åˆ°æœ€ä½³é€‰æ‹©å™¨\nlet bestSelector = null;\nlet bestScore = 0;\n\nfor (const [selector, result] of Object.entries(selectorResults)) {\n  if (result.error) continue;\n  \n  const score = result.visible * 10 + result.hasLink * 5; // å¯è§å…ƒç´ æƒé‡æ›´é«˜\n  if (score > bestScore) {\n    bestScore = score;\n    bestSelector = selector;\n  }\n}\n\nconsole.log(`\\nğŸ¯ æœ€ä½³é€‰æ‹©å™¨: ${bestSelector} (å¾—åˆ†: ${bestScore})`);\n\n// åˆ›å»ºè°ƒè¯•ä¿¡æ¯é¢æ¿\nconst debugPanel = document.createElement('div');\ndebugPanel.id = 'debug-panel';\ndebugPanel.innerHTML = `\n  <h3 style=\"color: #007aff; margin: 10px 0;\">ğŸ” é¡µé¢åˆ†æç»“æœ</h3>\n  <p><strong>é¡µé¢:</strong> ${pageTitle}</p>\n  <p><strong>æœ€ä½³é€‰æ‹©å™¨:</strong> ${bestSelector || 'æœªæ‰¾åˆ°'}</p>\n  <p><strong>é€‰æ‹©å™¨å¾—åˆ†:</strong> ${bestScore}</p>\n  <details style=\"margin: 10px 0;\">\n    <summary>è¯¦ç»†é€‰æ‹©å™¨åˆ†æ (ç‚¹å‡»å±•å¼€)</summary>\n    <div style=\"max-height: 200px; overflow-y: auto; font-size: 11px;\">\n      ${Object.entries(selectorResults).map(([selector, result]) => \n        `<p><strong>${selector}:</strong> æ€»æ•°=${result.count || 0}, å¯è§=${result.visible || 0}, æœ‰é“¾æ¥=${result.hasLink || 0}</p>`\n      ).join('')}\n    </div>\n  </details>\n  <p style=\"color: #ff3b30; font-size: 12px;\">ç­‰å¾…5ç§’åå¼€å§‹é”šç‚¹é«˜äº®æµ‹è¯•...</p>\n`;\n\ndebugPanel.style.cssText = `\n  position: fixed;\n  top: 20px;\n  right: 20px;\n  background: rgba(255, 255, 255, 0.95);\n  padding: 15px;\n  border-radius: 10px;\n  box-shadow: 0 4px 20px rgba(0,0,0,0.2);\n  z-index: 2147483647;\n  font-family: Arial, sans-serif;\n  font-size: 12px;\n  max-width: 400px;\n  border: 2px solid #007aff;\n`;\n\ndocument.body.appendChild(debugPanel);\n\n// 10ç§’åç§»é™¤è°ƒè¯•é¢æ¿\nsetTimeout(() => {\n  try { debugPanel.remove(); } catch {}\n}, 10000);\n\nreturn {\n  success: true,\n  pageUrl,\n  pageTitle,\n  bestSelector,\n  bestScore,\n  selectorResults,\n  totalSelectors: allSelectors.length,\n  timestamp: new Date().toISOString()\n};",
        "saveScreenshots": true
      },
      "next": ["manual_highlight_test"]
    },
    {
      "id": "manual_highlight_test",
      "type": "PageSnapshotNode",
      "name": "æ‰‹åŠ¨é«˜äº®æµ‹è¯•",
      "config": {
        "script": "console.log('ğŸ¨ å¼€å§‹æ‰‹åŠ¨é«˜äº®æµ‹è¯•...');\n\n// ç­‰å¾…5ç§’ç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½\nawait new Promise(resolve => setTimeout(resolve, 5000));\n\n// å°è¯•æ‰¾åˆ°å¹¶é«˜äº®å…ƒç´ \nconst selectors = [\n  '.sm-offer-item',\n  '.offer-item', \n  '.sm-offer',\n  '[class*=offer]',\n  '.sm-offer-item-wrapper'\n];\n\nlet targetElement = null;\nlet usedSelector = null;\n\nfor (const selector of selectors) {\n  const elements = document.querySelectorAll(selector);\n  console.log(`æµ‹è¯•é€‰æ‹©å™¨ ${selector}: æ‰¾åˆ° ${elements.length} ä¸ªå…ƒç´ `);\n  \n  for (let i = 0; i < Math.min(3, elements.length); i++) {\n    const el = elements[i];\n    const rect = el.getBoundingClientRect();\n    const isVisible = rect.width > 0 && rect.height > 0;\n    \n    if (isVisible) {\n      const hasLink = el.querySelector('a[href*=\"1688.com\"]');\n      if (hasLink) {\n        targetElement = el;\n        usedSelector = selector;\n        console.log(`æ‰¾åˆ°ç›®æ ‡å…ƒç´ : ${selector}[${i}]`);\n        break;\n      }\n    }\n  }\n  \n  if (targetElement) break;\n}\n\nif (!targetElement) {\n  console.error('æœªæ‰¾åˆ°åˆé€‚çš„ç›®æ ‡å…ƒç´ ');\n  \n  // åˆ›å»ºé”™è¯¯æç¤º\n  const errorPanel = document.createElement('div');\n  errorPanel.innerHTML = `\n    <h3 style=\"color: #ff3b30;\">âŒ æœªæ‰¾åˆ°ç›®æ ‡å…ƒç´ </h3>\n    <p>æ— æ³•æ‰¾åˆ°å¯ä»¥é«˜äº®çš„å•†å“é¡¹</p>\n    <p>é¡µé¢URL: ${window.location.href}</p>\n  `;\n  errorPanel.style.cssText = `\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: rgba(255, 59, 48, 0.9);\n    color: white;\n    padding: 20px;\n    border-radius: 10px;\n    z-index: 2147483647;\n    text-align: center;\n  `;\n  document.body.appendChild(errorPanel);\n  \n  return { success: false, error: 'æœªæ‰¾åˆ°ç›®æ ‡å…ƒç´ ' };\n}\n\n// æ‰‹åŠ¨åˆ›å»ºå¤šå±‚é«˜äº®æ•ˆæœ\nconsole.log('ğŸ¨ å¼€å§‹åº”ç”¨é«˜äº®æ•ˆæœ...');\n\n// 1. ä¿å­˜åŸå§‹æ ·å¼\nconst originalStyles = {\n  outline: targetElement.style.outline,\n  border: targetElement.style.border,\n  backgroundColor: targetElement.style.backgroundColor,\n  boxShadow: targetElement.style.boxShadow,\n  transition: targetElement.style.transition\n};\n\n// 2. åº”ç”¨é«˜äº®æ ·å¼\ntargetElement.style.outline = '4px solid #ff3b30';\ntargetElement.style.border = '3px solid #ff6b35';\ntargetElement.style.backgroundColor = 'rgba(255, 107, 53, 0.1)';\ntargetElement.style.boxShadow = '0 0 20px rgba(255, 59, 48, 0.6), 0 4px 15px rgba(255, 59, 48, 0.4)';\ntargetElement.style.transition = 'all 0.3s ease';\n\n// 3. åˆ›å»ºå¤–éƒ¨é«˜äº®æ¡†\nconst rect = targetElement.getBoundingClientRect();\nconst outerFrame = document.createElement('div');\nouterFrame.style.cssText = `\n  position: fixed;\n  left: ${rect.left - 6}px;\n  top: ${rect.top - 6}px;\n  width: ${rect.width + 12}px;\n  height: ${rect.height + 12}px;\n  border: 4px solid #ff3b30;\n  border-radius: 8px;\n  background: rgba(255, 59, 48, 0.05);\n  pointer-events: none;\n  z-index: 2147483646;\n  box-shadow: 0 0 30px rgba(255, 59, 48, 0.8);\n  animation: framePulse 2s infinite;\n`;\n\n// 4. æ·»åŠ åŠ¨ç”»æ ·å¼\nif (!document.querySelector('#highlight-animations')) {\n  const animStyle = document.createElement('style');\n  animStyle.id = 'highlight-animations';\n  animStyle.textContent = `\n    @keyframes framePulse {\n      0% { opacity: 1; transform: scale(1); }\n      50% { opacity: 0.7; transform: scale(1.01); }\n      100% { opacity: 1; transform: scale(1); }\n    }\n    @keyframes targetGlow {\n      0% { box-shadow: 0 0 20px rgba(255, 59, 48, 0.6); }\n      50% { box-shadow: 0 0 40px rgba(255, 59, 48, 0.9); }\n      100% { box-shadow: 0 0 20px rgba(255, 59, 48, 0.6); }\n    }\n  `;\n  document.head.appendChild(animStyle);\n}\n\ntargetElement.style.animation = 'targetGlow 2s infinite';\ndocument.body.appendChild(outerFrame);\n\n// 5. åˆ›å»ºæ ‡ç­¾\nconst label = document.createElement('div');\nlabel.textContent = 'ğŸ¯ é«˜äº®ç›®æ ‡';\nlabel.style.cssText = `\n  position: fixed;\n  left: ${rect.left + rect.width / 2 - 40}px;\n  top: ${rect.top - 40}px;\n  background: #ff3b30;\n  color: white;\n  padding: 6px 12px;\n  border-radius: 6px;\n  font-size: 14px;\n  font-weight: bold;\n  z-index: 2147483647;\n  box-shadow: 0 2px 10px rgba(0,0,0,0.4);\n  animation: labelBounce 1s ease-out;\n`;\n\n// æ·»åŠ æ ‡ç­¾åŠ¨ç”»\nif (!document.querySelector('#label-animation')) {\n  const labelStyle = document.createElement('style');\n  labelStyle.id = 'label-animation';\n  labelStyle.textContent = `\n    @keyframes labelBounce {\n      0% { transform: translateY(-20px); opacity: 0; }\n      60% { transform: translateY(5px); }\n      100% { transform: translateY(0); opacity: 1; }\n    }\n  `;\n  document.head.appendChild(labelStyle);\n}\n\ndocument.body.appendChild(label);\n\n// 6. åˆ›å»ºçŠ¶æ€é¢æ¿\nconst statusPanel = document.createElement('div');\nstatusPanel.innerHTML = `\n  <h3 style=\"color: #34c759; margin: 10px 0;\">âœ… é«˜äº®æµ‹è¯•æˆåŠŸ</h3>\n  <p><strong>é€‰æ‹©å™¨:</strong> ${usedSelector}</p>\n  <p><strong>å…ƒç´ æ–‡æœ¬:</strong> ${targetElement.textContent.trim().substring(0, 50)}...</p>\n  <p><strong>å…ƒç´ å°ºå¯¸:</strong> ${Math.round(rect.width)} Ã— ${Math.round(rect.height)}</p>\n  <p><strong>é«˜äº®å±‚æ•°:</strong> 3å±‚ (è¾¹æ¡†+å¤–æ¡†+æ ‡ç­¾)</p>\n  <p style=\"color: #007aff;\">å¦‚æœçœ‹åˆ°è¿™ä¸ªé¢æ¿å’Œé«˜äº®æ•ˆæœï¼Œè¯´æ˜åŠŸèƒ½æ­£å¸¸ï¼</p>\n`;\n\nstatusPanel.style.cssText = `\n  position: fixed;\n  top: 20px;\n  left: 20px;\n  background: rgba(52, 199, 89, 0.95);\n  color: white;\n  padding: 15px;\n  border-radius: 10px;\n  box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n  z-index: 2147483647;\n  font-family: Arial, sans-serif;\n  font-size: 12px;\n  max-width: 350px;\n  border: 2px solid #32d74b;\n`;\n\ndocument.body.appendChild(statusPanel);\n\n// 7. 15ç§’åæ¸…ç†\nsetTimeout(() => {\n  try {\n    // æ¢å¤åŸå§‹æ ·å¼\n    Object.assign(targetElement.style, originalStyles);\n    \n    // ç§»é™¤æ·»åŠ çš„å…ƒç´ \n    outerFrame.remove();\n    label.remove();\n    statusPanel.remove();\n    \n    console.log('ğŸ§¹ é«˜äº®æµ‹è¯•æ¸…ç†å®Œæˆ');\n  } catch (e) {\n    console.warn('æ¸…ç†è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:', e.message);\n  }\n}, 15000);\n\nconsole.log('âœ¨ é«˜äº®æ•ˆæœå·²åº”ç”¨ï¼Œå°†åœ¨15ç§’åè‡ªåŠ¨æ¸…ç†');\n\nreturn {\n  success: true,\n  usedSelector,\n  elementText: targetElement.textContent.trim().substring(0, 100),\n  elementSize: {\n    width: Math.round(rect.width),\n    height: Math.round(rect.height)\n  },\n  timestamp: new Date().toISOString()\n};",
        "saveScreenshots": true
      },
      "next": ["save_results"]
    },
    {
      "id": "save_results",
      "type": "ResultSaverNode",
      "name": "ä¿å­˜è°ƒè¯•ç»“æœ",
      "config": {
        "outputDir": "archive/workflow-records",
        "filenameTemplate": "1688-anchor-highlight-debug-{timestamp}.json",
        "includeMetadata": true,
        "mergeData": true
      },
      "next": ["end"]
    },
    {
      "id": "end",
      "type": "EndNode",
      "name": "ç»“æŸ",
      "config": { "cleanup": false, "saveLogs": true }
    }
  ],
  "globalConfig": {
    "logLevel": "debug",
    "screenshotOnError": true,
    "autoCleanup": false,
    "parallelExecution": false,
    "timeout": 120000
  }
}