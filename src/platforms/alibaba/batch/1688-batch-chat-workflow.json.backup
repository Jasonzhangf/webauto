{
  "name": "1688 批量聊天工作流",
  "description": "搜索->去重->批量打开聊天->输入->mock发送->记录->关闭",
  "version": "1.0.0",
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "开始", "next": ["attach"] },
    { "id": "attach", "type": "AttachSessionNode", "name": "会话接力", "config": {}, "next": ["search"] },

    {
      "id": "search",
      "type": "NavigationNode",
      "name": "导航到1688搜索页",
      "config": {
        "url": "https://www.1688.com/",
        "waitUntil": "domcontentloaded",
        "timeout": 30000
      },
      "next": ["search_input"]
    },

    {
      "id": "search_input",
      "type": "MockSearchInputNode",
      "name": "输入搜索关键词",
      "config": {
        "keyword": "数码产品",
        "selector": "#q",
        "waitMs": 2000
      },
      "next": ["search_submit"]
    },

    {
      "id": "search_submit",
      "type": "MockSearchSubmitNode",
      "name": "提交搜索",
      "config": {
        "submitSelector": ".search-btn",
        "waitMs": 3000
      },
      "next": ["capture_results"]
    },

    {
      "id": "capture_results",
      "type": "MockSearchResultsNode",
      "name": "捕获搜索结果",
      "config": {
        "resultSelector": ".sm-offer-item",
        "maxResults": 20,
        "minWaitMs": 2000,
        "maxWaitMs": 5000
      },
      "next": ["load_history"]
    },

    {
      "id": "load_history",
      "type": "FileReaderNode",
      "name": "加载发送历史",
      "config": {
        "filePath": "workflows/records/1688-chat-history-{date}.json",
        "fallbackPath": "workflows/records/",
        "createIfNotExists": true
      },
      "next": ["deduplicate"]
    },

    {
      "id": "deduplicate",
      "type": "MockDeduplicateNode",
      "name": "去重处理",
      "config": {
        "maxRecentDays": 7,
        "maxDailyCount": 3,
        "cooldownHours": 2
      },
      "next": ["batch_start"]
    },

    {
      "id": "batch_start",
      "type": "BatchLoopNode",
      "name": "批量聊天循环",
      "config": {
        "itemsVariable": "searchResults",
        "maxIterations": 10,
        "errorRetryLimit": 3,
        "iterationDelay": { "min": 8000, "max": 15000 }
      },
      "next": ["open_chat"]
    },

    {
      "id": "open_chat",
      "type": "MockOpenChatNode",
      "name": "打开聊天窗口",
      "config": {
        "initWaitMs": 5000,
        "stabilizeMs": 3000,
        "mockMode": true
      },
      "next": ["chat_compose"]
    },

    {
      "id": "chat_compose",
      "type": "MockChatComposeNode",
      "name": "输入并发送消息",
      "config": {
        "messageTemplate": "您好，我们对贵公司的产品很感兴趣，希望能了解更多详情。",
        "sendMode": "mock", // "mock" 或 "real"
        "inputWaitMs": 2000,
        "sendWaitMs": 1000,
        "highlightMs": 3000
      },
      "next": ["record_result"]
    },

    {
      "id": "record_result",
      "type": "MockRecordChatNode",
      "name": "记录聊天结果",
      "config": {
        "historyFile": "workflows/records/1688-chat-history-{date}.json",
        "includeScreenshot": true,
        "includePageInfo": true
      },
      "next": ["close_chat"]
    },

    {
      "id": "close_chat",
      "type": "MockCloseChatNode",
      "name": "关闭聊天窗口",
      "config": {
        "closeMethod": "navigation", // "navigation" 或 "close"
        "backWaitMs": 2000
      },
      "next": ["loop_control"]
    },

    {
      "id": "loop_control",
      "type": "LoopControlNode",
      "name": "循环控制",
      "config": {
        "continueVariable": "hasMoreItems",
        "nextTarget": "batch_start",
        "endTarget": "summary"
      },
      "next": ["summary"]
    },

    {
      "id": "summary",
      "type": "BatchSummaryNode",
      "name": "生成批量处理报告",
      "config": {
        "outputFile": "workflows/records/1688-batch-chat-{timestamp}.json",
        "includeDetails": true,
        "includeStatistics": true
      },
      "next": ["end"]
    },

    {
      "id": "end",
      "type": "EndNode",
      "name": "结束",
      "config": { "cleanup": false, "saveLogs": true }
    }
  ],
  "globalConfig": {
    "logLevel": "info",
    "screenshotOnError": true,
    "autoCleanup": false,
    "parallelExecution": false,
    "timeout": 1800000
  }
}