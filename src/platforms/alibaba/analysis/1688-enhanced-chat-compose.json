{
  "name": "1688 Enhanced Chat Compose Test",
  "description": "1688ä¸“ç”¨å¢å¼ºç‰ˆèŠå¤©ç»„ä»¶æµ‹è¯•ï¼ŒåŒ…å«æ·±åº¦DOMæ¢æµ‹å’Œå¤šç§è¾“å…¥æ–¹æ³•",
  "version": "1.0.0",
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "å¼€å§‹", "next": ["attach"] },
    { "id": "attach", "type": "AttachSessionNode", "name": "ä¼šè¯æ¥åŠ›", "config": {}, "next": ["navigate_search"] },
    {
      "id": "navigate_search",
      "type": "NavigationNode",
      "name": "å¯¼èˆªåˆ°æœç´¢é¡µé¢",
      "config": {
        "url": "https://s.1688.com/selloffer/offer_search.htm?keywords=%B9%A4%D2%B5%B4%F3%B7%E7%C9%C8&spm=a260k.home2025.searchbox.0",
        "waitUntil": "domcontentloaded",
        "timeout": 30000
      },
      "next": ["wait_search"]
    },
    { "id": "wait_search", "type": "WaitNode", "name": "æœç´¢é¡µé¢ç­‰å¾…", "config": { "minMs": 2000, "maxMs": 3000 }, "next": ["dismiss_modals"] },
    { "id": "dismiss_modals", "type": "ModalDismissNode", "name": "å…³é—­æœç´¢é¡µæ¨¡æ€", "config": { "maxAttempts": 4, "retryDelay": 500 }, "next": ["open_chat"] },
    {
      "id": "open_chat",
      "type": "PopupTokenCaptureNode",
      "name": "æ‰“å¼€èŠå¤©çª—å£",
      "config": {
        "containerSelector": ".space-pc-ui2024-content > div:nth-child(5)",
        "clickSelectors": ["a.ww-link.ww-inline", "span.J_WangWang a.ww-link", "a[href*=air.1688.com/app/]"],
        "hostFilter": "air.1688.com",
        "maxItems": 1,
        "minClickDelay": 500,
        "maxClickDelay": 1500,
        "afterPopupWaitMs": 3000,
        "closePopup": false,
        "popupClickSelectors": ["body > div:nth-child(23)"],
        "dryMode": false,
        "enforceWebPreference": true,
        "popupStepGate": false
      },
      "next": ["enhanced_chat_test"]
    },
    {
      "id": "enhanced_chat_test",
      "type": "ChatComposeNode",
      "name": "å¢å¼ºç‰ˆèŠå¤©æµ‹è¯•",
      "config": {
        "hostFilter": "air.1688.com",
        "message": "ğŸ”æµ‹è¯•æ¶ˆæ¯ - è¿™æ˜¯å¢å¼ºç‰ˆChatComposeNodeçš„æµ‹è¯•",
        "stepGate": true,
        "send": false,
        "inputSelectors": [
          // æ ‡å‡†è¾“å…¥å…ƒç´ 
          "textarea",
          "div[contenteditable='true']",
          "div[contenteditable]",
          "input[type='text']",
          "input[type='search']",
          "input[type='email']",
          "input:not([type])",

          // 1688ç‰¹å®šç±»å
          ".im-chat-input",
          ".msg-input",
          ".chat-input",
          ".message-input",
          ".input-area",
          ".editor-content",
          ".rich-editor",
          ".chat-editor",
          ".compose-area",
          "[class*='input']",
          "[class*='editor']",
          "[class*='compose']",
          "[class*='chat']",
          "[class*='im-']",

          // å¯èƒ½çš„éšè—è¾“å…¥
          "input[type='hidden']",
          "input[name='message']",
          "input[name='content']",
          "input[name='text']",
          "[data-input]",
          "[data-content]",
          "[data-message]",

          // React/Vueç»„ä»¶
          "[data-reactroot]",
          "[data-v-]",
          "[class*='vue-']",
          "[class*='react-']",

          // è‡ªå®šä¹‰å±æ€§
          "[contenteditable]",
          "[iscontenteditable]",
          "[role='textbox']",
          "[role='input']",
          "[aria-multiline]",
          "[aria-label*='è¾“å…¥']",
          "[aria-label*='æ¶ˆæ¯']",
          "[aria-label*='chat']",

          // é€šè¿‡çˆ¶å®¹å™¨æŸ¥æ‰¾
          ".chat-footer *",
          ".input-container *",
          ".compose-container *",
          ".message-box *",
          ".editor-container *",

          // é€šç”¨æŸ¥æ‰¾
          "*"
        ],
        "sendSelectors": [
          // æ ‡å‡†å‘é€æŒ‰é’®
          "button:has-text('å‘é€')",
          "button:has-text('Send')",
          ".send-btn",
          ".btn-send",
          ".im-chat-send-btn",
          ".chat-send-btn",
          "[class*='send']",
          "[class*='Send']",
          "button[type='submit']",
          "input[type='submit']",
          "button[type='button']",
          "a:has-text('å‘é€')",
          "a:has-text('Send')",

          // 1688ç‰¹å®š
          ".chat-send",
          ".msg-send",
          ".im-chat-send",
          "[data-action='send']",
          "[onclick*='send']",
          "[onclick*='Send']",
          "[data-command='send']",

          // é€šè¿‡ä½ç½®æŸ¥æ‰¾
          ".input-area + button",
          ".compose-area button:last-child",
          ".chat-footer button:last-child",
          ".message-box button:last-child",
          "textarea + button",
          "input + button",
          "[class*='input'] ~ button",
          "[class*='editor'] ~ button",

          // é€šç”¨æŒ‰é’®
          "button",
          "input[type='button']",
          "[role='button']",
          "a[role='button']",
          "span[role='button']",
          "div[role='button']",

          // ç‰¹æ®Šç±»å
          "[class*='primary']",
          "[class*='action']",
          "[class*='submit']",
          "[class*='confirm']",
          "[class*='ok']",

          // é€šç”¨æŸ¥æ‰¾
          "*"
        ],
        "highlightMs": 15000,
        "stabilizeMs": 3000,
        "gateTitle": "ğŸš€ å¢å¼ºç‰ˆèŠå¤©æµ‹è¯•",
        "gateMessage": "æ­£åœ¨ä½¿ç”¨å¢å¼ºç‰ˆChatComposeNodeè¿›è¡Œæ·±åº¦æ¢æµ‹...\n\nğŸ” æµ‹è¯•å†…å®¹ï¼š\nâœ… æ‰©å±•çš„è¾“å…¥æ¡†é€‰æ‹©å™¨åˆ—è¡¨\nâœ… æ·±åº¦DOMæ‰«æ\nâœ… Shadow DOMæ¢æµ‹\nâœ… iframeå†…å®¹æ¢æµ‹\nâœ… è‡ªå®šä¹‰ç»„ä»¶è¯†åˆ«\n\nğŸ“‹ è¯·è§‚å¯Ÿï¼š\n1. æ˜¯å¦çœ‹åˆ°è¾“å…¥æ¡†æœ‰æ–‡å­—ï¼Ÿ\n2. æ˜¯å¦çœ‹åˆ°å‘é€æŒ‰é’®æœ‰çº¢è‰²è¾¹æ¡†ï¼Ÿ\n3. è®°å½•æœ‰æ•ˆçš„é€‰æ‹©å™¨\n\nç‚¹å‡»'ä¸‹ä¸€æ­¥'ç»§ç»­æµ‹è¯•å‘é€åŠŸèƒ½"
      },
      "next": ["send_test_only"]
    },
    {
      "id": "send_test_only",
      "type": "ChatComposeNode",
      "name": "å‘é€æŒ‰é’®æµ‹è¯•",
      "config": {
        "hostFilter": "air.1688.com",
        "message": "ğŸ¯ è¿™æ˜¯å‘é€æµ‹è¯•æ¶ˆæ¯",
        "stepGate": true,
        "send": true,
        "inputSelectors": ["*"], // ä½¿ç”¨æœ€å¹¿æ³›çš„é€‰æ‹©å™¨
        "sendSelectors": [
          "button:has-text('å‘é€')",
          "button:has-text('Send')",
          ".send-btn",
          ".btn-send",
          ".im-chat-send-btn",
          ".chat-send-btn",
          "[class*='send']",
          "button[type='submit']",
          "button",
          "[role='button']"
        ],
        "highlightMs": 20000,
        "gateTitle": "ğŸ“¤ å‘é€æŒ‰é’®æµ‹è¯•",
        "gateMessage": "å‡†å¤‡æµ‹è¯•å‘é€åŠŸèƒ½...\n\nğŸ¯ æµ‹è¯•å†…å®¹ï¼š\nâœ… å¤šç§å‘é€æ–¹æ³•å°è¯•\nâœ… é”®ç›˜å¿«æ·é”®å‘é€\nâœ… é¼ æ ‡ç‚¹å‡»å‘é€\nâœ… äº‹ä»¶åˆ†å‘å‘é€\n\nâš ï¸ é‡è¦æç¤ºï¼š\n- å¦‚æœå‘é€æˆåŠŸï¼Œæ¶ˆæ¯åº”è¯¥å‡ºç°åœ¨èŠå¤©è®°å½•ä¸­\n- å¦‚æœå¤±è´¥ï¼Œä¼šæ˜¾ç¤ºå…·ä½“çš„é”™è¯¯ä¿¡æ¯\n- è¯·è§‚å¯ŸèŠå¤©ç•Œé¢çš„ååº”\n\nç‚¹å‡»'ä¸‹ä¸€æ­¥'å®Œæˆæµ‹è¯•"
      },
      "next": ["save_enhanced_results"]
    },
    {
      "id": "save_enhanced_results",
      "type": "ResultSaverNode",
      "name": "ä¿å­˜å¢å¼ºæµ‹è¯•ç»“æœ",
      "config": {
        "outputDir": "archive/workflow-records",
        "filenameTemplate": "1688-enhanced-chat-test-{timestamp}.json",
        "includeMetadata": true
      },
      "next": ["final_summary"]
    },
    {
      "id": "final_summary",
      "type": "GateOverlayNode",
      "name": "æ˜¾ç¤ºæµ‹è¯•æ€»ç»“",
      "config": {
        "hostFilter": "air.1688.com",
        "title": "âœ… å¢å¼ºç‰ˆæµ‹è¯•å®Œæˆ",
        "message": "1688èŠå¤©ç•Œé¢æµ‹è¯•å·²å®Œæˆï¼\n\nğŸ“Š æµ‹è¯•æ€»ç»“ï¼š\n1. è¾“å…¥æ¡†å®šä½ç»“æœï¼š[æ ¹æ®å®é™…æµ‹è¯•ç»“æœå¡«å†™]\n2. å‘é€æŒ‰é’®å®šä½ç»“æœï¼š[æ ¹æ®å®é™…æµ‹è¯•ç»“æœå¡«å†™]\n3. æœ‰æ•ˆçš„é€‰æ‹©å™¨åˆ—è¡¨ï¼š[è®°å½•æœ‰æ•ˆé€‰æ‹©å™¨]\n4. ç‰¹æ®Šå‘ç°ï¼š[è®°å½•Shadow DOMã€iframeç­‰]\n\nğŸ’¡ åŸºäºè¿™äº›ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥ï¼š\n- æ›´æ–°ChatComposeNodeçš„é»˜è®¤é…ç½®\n- åˆ›å»ºä¸“é—¨çš„1688èŠå¤©äº¤äº’workflow\n- å®ç°å¯é çš„è‡ªåŠ¨åŒ–èŠå¤©åŠŸèƒ½\n\nç‚¹å‡»'ä¸‹ä¸€æ­¥'ç»“æŸæµ‹è¯•",
        "stepGate": true,
        "block": true
      },
      "next": ["end"]
    },
    {
      "id": "end",
      "type": "EndNode",
      "name": "ç»“æŸ",
      "config": { "cleanup": false, "saveLogs": true }
    }
  ],
  "globalConfig": {
    "logLevel": "info",
    "screenshotOnError": true,
    "autoCleanup": false,
    "parallelExecution": false,
    "timeout": 900000
  }
}