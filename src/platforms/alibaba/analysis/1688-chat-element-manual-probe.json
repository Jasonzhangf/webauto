{
  "name": "1688 Chat Element Manual Probe",
  "description": "手动探测1688聊天界面元素，使用stepGate确认每个选择器",
  "version": "1.0.0",
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "开始", "next": ["attach"] },
    { "id": "attach", "type": "AttachSessionNode", "name": "会话接力", "config": {}, "next": ["navigate_search"] },
    {
      "id": "navigate_search",
      "type": "NavigationNode",
      "name": "导航到搜索页面",
      "config": {
        "url": "https://s.1688.com/selloffer/offer_search.htm?keywords=%B9%A4%D2%B5%B4%F3%B7%E7%C9%C8&spm=a260k.home2025.searchbox.0",
        "waitUntil": "domcontentloaded",
        "timeout": 30000
      },
      "next": ["wait_search"]
    },
    { "id": "wait_search", "type": "WaitNode", "name": "搜索页面等待", "config": { "minMs": 2000, "maxMs": 3000 }, "next": ["dismiss_modals"] },
    { "id": "dismiss_modals", "type": "ModalDismissNode", "name": "关闭搜索页模态", "config": { "maxAttempts": 4, "retryDelay": 500 }, "next": ["open_chat"] },
    {
      "id": "open_chat",
      "type": "PopupTokenCaptureNode",
      "name": "打开聊天窗口",
      "config": {
        "containerSelector": ".space-pc-ui2024-content > div:nth-child(5)",
        "clickSelectors": ["a.ww-link.ww-inline", "span.J_WangWang a.ww-link", "a[href*=air.1688.com/app/]"],
        "hostFilter": "air.1688.com",
        "maxItems": 1,
        "minClickDelay": 500,
        "maxClickDelay": 1500,
        "afterPopupWaitMs": 2000,
        "closePopup": false,
        "popupClickSelectors": ["body > div:nth-child(23)"],
        "dryMode": false,
        "enforceWebPreference": true,
        "popupStepGate": true,
        "gateTitle": "聊天窗口确认",
        "gateMessage": "请确认聊天窗口已完全加载，然后点击下一步"
      },
      "next": ["test_textarea"]
    },
    {
      "id": "test_textarea",
      "type": "ChatComposeNode",
      "name": "测试textarea输入",
      "config": {
        "hostFilter": "air.1688.com",
        "message": "测试textarea输入",
        "stepGate": true,
        "inputSelectors": ["textarea"],
        "sendSelectors": [],
        "testMode": true,
        "gateTitle": "textarea测试",
        "gateMessage": "正在测试textarea选择器。如果能输入文字，说明textarea有效，请点击下一步继续"
      },
      "next": ["test_contenteditable"]
    },
    {
      "id": "test_contenteditable",
      "type": "ChatComposeNode",
      "name": "测试contenteditable输入",
      "config": {
        "hostFilter": "air.1688.com",
        "message": "测试contenteditable输入",
        "stepGate": true,
        "inputSelectors": ["div[contenteditable='true']", "div[contenteditable]"],
        "sendSelectors": [],
        "testMode": true,
        "gateTitle": "contenteditable测试",
        "gateMessage": "正在测试contenteditable选择器。如果能输入文字，说明contenteditable有效，请点击下一步继续"
      },
      "next": ["test_text_input"]
    },
    {
      "id": "test_text_input",
      "type": "ChatComposeNode",
      "name": "测试text input输入",
      "config": {
        "hostFilter": "air.1688.com",
        "message": "测试text input输入",
        "stepGate": true,
        "inputSelectors": ["input[type='text']", "input[type='search']"],
        "sendSelectors": [],
        "testMode": true,
        "gateTitle": "text input测试",
        "gateMessage": "正在测试text input选择器。如果能输入文字，说明text input有效，请点击下一步继续"
      },
      "next": ["test_chat_inputs"]
    },
    {
      "id": "test_chat_inputs",
      "type": "ChatComposeNode",
      "name": "测试聊天特定输入框",
      "config": {
        "hostFilter": "air.1688.com",
        "message": "测试聊天特定输入框",
        "stepGate": true,
        "inputSelectors": [
          ".im-chat-input",
          ".msg-input",
          ".chat-input",
          ".message-input",
          ".input-area",
          ".editor-content",
          ".rich-editor",
          ".chat-editor",
          "[class*='input']",
          "[class*='editor']"
        ],
        "sendSelectors": [],
        "testMode": true,
        "gateTitle": "聊天特定输入框测试",
        "gateMessage": "正在测试聊天相关的输入框选择器。如果能输入文字，说明某个选择器有效，请点击下一步继续"
      },
      "next": ["test_send_button_text"]
    },
    {
      "id": "test_send_button_text",
      "type": "ChatComposeNode",
      "name": "测试发送按钮(文本)",
      "config": {
        "hostFilter": "air.1688.com",
        "message": "测试消息",
        "stepGate": true,
        "inputSelectors": [],
        "sendSelectors": ["button:has-text('发送')"],
        "testMode": true,
        "gateTitle": "发送按钮测试(文本)",
        "gateMessage": "正在测试'发送'文本按钮。如果按钮被高亮或可以点击，说明选择器有效，请点击下一步继续"
      },
      "next": ["test_send_button_class"]
    },
    {
      "id": "test_send_button_class",
      "type": "ChatComposeNode",
      "name": "测试发送按钮(类名)",
      "config": {
        "hostFilter": "air.1688.com",
        "message": "测试消息",
        "stepGate": true,
        "inputSelectors": [],
        "sendSelectors": [
          ".send-btn",
          ".btn-send",
          ".im-chat-send-btn",
          ".chat-send-btn",
          "[class*='send']",
          "[class*='Send']"
        ],
        "testMode": true,
        "gateTitle": "发送按钮测试(类名)",
        "gateMessage": "正在测试带send类名的按钮。如果按钮被高亮或可以点击，说明选择器有效，请点击下一步继续"
      },
      "next": ["test_send_button_general"]
    },
    {
      "id": "test_send_button_general",
      "type": "ChatComposeNode",
      "name": "测试通用按钮",
      "config": {
        "hostFilter": "air.1688.com",
        "message": "测试消息",
        "stepGate": true,
        "inputSelectors": [],
        "sendSelectors": [
          "button",
          "input[type='button']",
          "input[type='submit']",
          ".chat-send",
          ".msg-send",
          "button[class*='primary']"
        ],
        "testMode": true,
        "gateTitle": "发送按钮测试(通用)",
        "gateMessage": "正在测试通用按钮选择器。如果按钮被高亮或可以点击，说明选择器有效，请点击下一步继续"
      },
      "next": ["final_summary"]
    },
    {
      "id": "final_summary",
      "type": "GateOverlayNode",
      "name": "显示测试总结",
      "config": {
        "hostFilter": "air.1688.com",
        "title": "元素测试完成",
        "message": "测试完成！请记录以下信息：\n\n1. 哪些输入框选择器有效\n2. 哪些发送按钮选择器有效\n3. 聊天界面的实际结构\n\n这些信息将用于更新ChatComposeNode的配置。\n\n点击'下一步'结束测试。",
        "stepGate": true,
        "block": true
      },
      "next": ["save_results"]
    },
    {
      "id": "save_results",
      "type": "ResultSaverNode",
      "name": "保存测试结果",
      "config": {
        "outputDir": "archive/workflow-records",
        "filenameTemplate": "1688-chat-element-manual-probe-{timestamp}.json",
        "includeMetadata": true
      },
      "next": ["end"]
    },
    {
      "id": "end",
      "type": "EndNode",
      "name": "结束",
      "config": { "cleanup": false, "saveLogs": true }
    }
  ],
  "globalConfig": {
    "logLevel": "info",
    "screenshotOnError": true,
    "autoCleanup": false,
    "parallelExecution": false,
    "timeout": 600000
  }
}