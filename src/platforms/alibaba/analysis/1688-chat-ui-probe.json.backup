{
  "name": "1688 Chat UI Probe",
  "description": "专门分析1688聊天界面UI结构，找出正确的输入框和发送按钮选择器",
  "version": "1.0.0",
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "开始", "next": ["attach"] },
    { "id": "attach", "type": "AttachSessionNode", "name": "会话接力", "config": {}, "next": ["navigate_search"] },
    {
      "id": "navigate_search",
      "type": "NavigationNode",
      "name": "导航到搜索页面",
      "config": {
        "url": "https://s.1688.com/selloffer/offer_search.htm?keywords=%B9%A4%D2%B5%B4%F3%B7%E7%C9%C8&spm=a260k.home2025.searchbox.0",
        "waitUntil": "domcontentloaded",
        "timeout": 30000
      },
      "next": ["wait_search"]
    },
    { "id": "wait_search", "type": "WaitNode", "name": "搜索页面等待", "config": { "minMs": 2000, "maxMs": 3000 }, "next": ["dismiss_modals"] },
    { "id": "dismiss_modals", "type": "ModalDismissNode", "name": "关闭搜索页模态", "config": { "maxAttempts": 4, "retryDelay": 500 }, "next": ["capture_token"] },
    {
      "id": "capture_token",
      "type": "PopupTokenCaptureNode",
      "name": "捕获聊天窗口",
      "config": {
        "containerSelector": ".space-pc-ui2024-content > div:nth-child(5)",
        "clickSelectors": ["a.ww-link.ww-inline", "span.J_WangWang a.ww-link", "a[href*=air.1688.com/app/]"],
        "hostFilter": "air.1688.com",
        "maxItems": 1,
        "minClickDelay": 500,
        "maxClickDelay": 1500,
        "afterPopupWaitMs": 2000,
        "closePopup": false,
        "popupClickSelectors": ["body > div:nth-child(23)"],
        "dryMode": false,
        "enforceWebPreference": true,
        "popupStepGate": true,
        "gateTitle": "聊天UI分析",
        "gateMessage": "即将开始分析聊天界面结构，请确保聊天窗口已完全加载"
      },
      "next": ["probe_chat_ui"]
    },
    {
      "id": "probe_chat_ui",
      "type": "SelectorProbeNode",
      "name": "深度探测聊天UI",
      "config": {
        "targetPopup": true,
        "probes": [
          {
            "name": "输入框详细探测",
            "selectors": [
              "textarea",
              "div[contenteditable='true']",
              "div[contenteditable]",
              ".im-chat-input",
              ".msg-input",
              ".chat-input",
              ".message-input",
              ".input-area",
              ".editor",
              ".compose-input",
              "input[type='text']",
              "input[placeholder*='请输入']",
              "input[placeholder*='消息']",
              "input[placeholder*='聊天']",
              "[class*='input']",
              "[class*='Input']",
              "[class*='textarea']",
              "[class*='Textarea']",
              "[data-placeholder]",
              "pre[contenteditable]",
              ".rich-editor",
              ".editor-content",
              ".chat-editor",
              ".im-editor",
              ".compose-editor"
            ]
          },
          {
            "name": "发送按钮详细探测",
            "selectors": [
              "button:has-text('发送')",
              "button:has-text('Send')",
              ".send-btn",
              ".btn-send",
              ".im-chat-send-btn",
              ".chat-send-btn",
              ".msg-send-btn",
              ".send-button",
              ".chat-send",
              ".msg-send",
              "button[class*='send']",
              "button[class*='Send']",
              "button[type='submit']",
              "button[aria-label*='发送']",
              "button[title*='发送']",
              "span:has-text('发送')",
              "div:has-text('发送')",
              "a:has-text('发送')",
              ".btn-primary",
              "button[class*='primary']",
              "button[class*='Primary']",
              ".action-btn",
              "button[class*='action']",
              "[data-action='send']",
              "[data-testid*='send']",
              "textarea + button",
              ".input-group button",
              ".editor + button",
              ".compose-area button",
              ".chat-footer button",
              ".message-box button"
            ]
          },
          {
            "name": "聊天容器探测",
            "selectors": [
              ".chat-container",
              ".im-chat",
              ".message-container",
              ".chat-window",
              ".im-window",
              ".conversation",
              ".chat-panel",
              ".im-panel",
              ".chat-main",
              ".im-main"
            ]
          }
        ],
        "saveScreenshots": true,
        "saveHtml": true,
        "outputDir": "workflows/records"
      },
      "next": ["take_popup_snapshot"]
    },
    {
      "id": "take_popup_snapshot",
      "type": "PageSnapshotNode",
      "name": "保存聊天界面快照",
      "config": {
        "targetPopup": true,
        "maxHtmlLength": 800000,
        "includeInlineScripts": true,
        "includeExternalScripts": true,
        "maxInlineScripts": 80,
        "maxInlineScriptLength": 25000
      },
      "next": ["test_input_methods"]
    },
    {
      "id": "test_input_methods",
      "type": "SelectorProbeNode",
      "name": "测试输入方法",
      "config": {
        "targetPopup": true,
        "probes": [
          {
            "name": "测试textarea输入",
            "action": "test-input",
            "selectors": ["textarea"],
            "testText": "测试消息"
          },
          {
            "name": "测试contenteditable输入",
            "action": "test-input",
            "selectors": ["div[contenteditable='true']", "div[contenteditable]"],
            "testText": "测试消息"
          },
          {
            "name": "测试input输入",
            "action": "test-input",
            "selectors": ["input[type='text']", "input[placeholder*='输入']"],
            "testText": "测试消息"
          }
        ],
        "saveScreenshots": true,
        "outputDir": "workflows/records"
      },
      "next": ["save_results"]
    },
    {
      "id": "save_results",
      "type": "ResultSaverNode",
      "name": "保存分析结果",
      "config": {
        "outputDir": "workflows/records",
        "filenameTemplate": "1688-chat-ui-probe-{timestamp}.json",
        "includeMetadata": true
      },
      "next": ["end"]
    },
    {
      "id": "end",
      "type": "EndNode",
      "name": "结束",
      "config": { "cleanup": false, "saveLogs": true }
    }
  ],
  "globalConfig": {
    "logLevel": "info",
    "screenshotOnError": true,
    "autoCleanup": false,
    "parallelExecution": false,
    "timeout": 400000
  }
}