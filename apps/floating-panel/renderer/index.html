<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebAuto Floating Console</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="window-shell" data-drag-region>
      <header class="title-bar" data-drag-region>
        <div class="title-copy">
          <div class="app-name">WebAuto Floating Console</div>
          <div class="subtitle">跨平台容器控制面板</div>
        </div>
        <div class="status-pill" id="connectionStatus">就绪</div>
        <div class="window-buttons" data-no-drag>
          <button id="stickBrowserButton" class="ghost icon" title="浏览器贴边">🪟</button>
          <button id="collapseButton" class="icon-button" title="贴边收起">◻︎</button>
          <button id="minButton" class="icon-button" title="最小化">—</button>
          <button id="closeButton" class="icon-button" title="关闭">✕</button>
        </div>
      </header>
      <div class="collapsed-strip hidden" id="collapsedStrip" data-drag-region>
        <div class="collapsed-strip-label">浮窗已贴边，点击展开继续操作</div>
        <button id="expandCollapsedButton" class="ghost" data-no-drag>展开</button>
      </div>

      <main data-no-drag>
        <section class="panel" id="browserPanel">
          <div class="section-heading">
            <div>
              <div class="section-title">浏览器控制</div>
              <p class="section-desc">查看当前浏览器服务与会话状态</p>
            </div>
            <div class="mini-actions">
              <button id="refreshBrowser" class="ghost">刷新</button>
            </div>
          </div>
          <div class="panel-body">
            <div class="stat" id="browserStatusText">未连接</div>
            <div class="muted" id="browserDetails">等待查询...</div>
          </div>
          <form id="sessionCreateForm" class="stack">
            <div class="form-row">
              <label>
                <span>Profile</span>
                <input id="profileInput" type="text" placeholder="weibo-fresh" autocomplete="off" />
              </label>
              <label>
                <span>导航 URL</span>
                <input id="launchUrlInput" type="text" placeholder="https://weibo.com/" autocomplete="off" />
              </label>
            </div>
            <div class="form-row align-center">
              <label class="checkbox">
                <input id="headlessToggle" type="checkbox" />
                <span>无头模式</span>
              </label>
              <div class="grow"></div>
              <button type="submit" class="primary">创建/唤醒会话</button>
            </div>
          </form>
        </section>

        <section class="panel" id="sessionPanel">
          <div class="section-heading">
            <div>
              <div class="section-title">会话列表</div>
              <p class="section-desc">选择一个会话后可进行容器调试</p>
            </div>
            <div class="mini-actions">
              <button id="refreshSessions" class="ghost">刷新</button>
            </div>
          </div>
          <div id="sessionList" class="session-list"></div>
        </section>

        <section class="panel" id="containersPanel">
          <div class="section-heading">
            <div>
              <div class="section-title">容器与 DOM</div>
              <p class="section-desc">树状容器 + DOM 映射（只读）</p>
            </div>
            <div class="mini-actions">
              <button id="openInspector" class="ghost">容器视图</button>
              <button id="refreshContainers" class="ghost">刷新面板</button>
            </div>
          </div>
          <div class="container-grid">
            <div class="subpanel">
              <div class="subpanel-title">容器树</div>
              <div id="containerTreePlaceholder" class="placeholder">
                <strong>等待匹配</strong>
                <p>选择会话后，通过 CLI 捕获容器树。</p>
              </div>
            </div>
            <div class="subpanel">
              <div class="subpanel-title">DOM 映射</div>
              <div id="domMapPlaceholder" class="placeholder">
                <strong>等待会话</strong>
                <p>容器树捕获后自动展示 DOM 信息。</p>
              </div>
            </div>
          </div>
          <div class="operations-card">
            <div class="subpanel-title">可用操作</div>
            <div class="operation-chips" id="operationChips"></div>
          </div>
        </section>

        <section class="panel log-panel" id="logPanel">
          <div class="section-heading">
            <div>
              <div class="section-title">日志面板</div>
              <p class="section-desc">读取 ~/.webauto/logs 下的运行日志</p>
            </div>
            <div class="mini-actions">
              <select id="logSourceSelect">
                <option value="browser">浏览器</option>
                <option value="service">服务</option>
                <option value="orchestrator">编排器</option>
              </select>
              <button id="refreshLogs" class="ghost">刷新</button>
              <button id="clearLogs" class="ghost">清空</button>
            </div>
          </div>
          <pre id="logStream" class="log-stream">暂无日志</pre>
        </section>
      </main>
    </div>

    <div class="global-message hidden" id="globalMessage"></div>
    <script type="module" src="./app.js"></script>
  </body>
</html>
