<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebAuto Floating Console</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="window-shell">
      <header class="title-bar" data-drag-region>
        <div class="title-copy">
          <div class="app-name">WebAuto Floating Console</div>
          <div class="subtitle">跨平台容器控制面板</div>
        </div>
        <div class="status-pill" id="connectionStatus">就绪</div>
        <div class="window-buttons" data-no-drag>
          <button id="headlessButton" class="icon-button" title="隐藏浮窗">👁</button>
          <button id="stickBrowserButton" class="ghost icon" title="浏览器贴边">🪟</button>
          <button id="collapseButton" class="icon-button" title="贴边收起">◻︎</button>
          <button id="minButton" class="icon-button" title="最小化">—</button>
          <button id="closeButton" class="icon-button" title="关闭">✕</button>
        </div>
      </header>
      <div class="collapsed-strip hidden" id="collapsedStrip" data-drag-region>
        <div class="collapsed-strip-label">浮窗已贴边，点击展开继续操作</div>
        <button id="expandCollapsedButton" class="ghost" data-no-drag>展开</button>
      </div>

      <main class="app-layout" data-no-drag>
        <div class="layout-sidebar">
          <section class="panel compact" id="browserPanel">
          <div class="section-heading">
            <div>
              <div class="section-title">浏览器控制</div>
              <p class="section-desc">查看当前浏览器服务与会话状态</p>
            </div>
            <div class="mini-actions">
              <button id="refreshBrowser" class="ghost">刷新</button>
            </div>
          </div>
          <div class="panel-body">
            <div class="stat" id="browserStatusText">未连接</div>
            <div class="muted" id="browserDetails">等待查询...</div>
          </div>
          <form id="sessionCreateForm" class="stack compact">
            <div class="form-row">
              <label>
                <span>Profile</span>
                <input id="profileInput" type="text" placeholder="weibo-fresh" autocomplete="off" />
              </label>
              <label>
                <span>导航 URL</span>
                <input id="launchUrlInput" type="text" placeholder="https://weibo.com/" autocomplete="off" />
              </label>
            </div>
            <div class="form-row align-center">
              <label class="checkbox">
                <input id="headlessToggle" type="checkbox" />
                <span>无头模式</span>
              </label>
              <div class="grow"></div>
              <button type="submit" class="primary">创建/唤醒会话</button>
            </div>
          </form>
          </section>

          <section class="panel compact" id="sessionPanel">
          <div class="section-heading">
            <div>
              <div class="section-title">会话列表</div>
              <p class="section-desc">选择一个会话后可进行容器调试</p>
            </div>
            <div class="mini-actions">
              <button id="refreshSessions" class="ghost">刷新</button>
            </div>
          </div>
          <div id="sessionList" class="session-list compact"></div>
          <div class="sidebar-actions">
            <button id="sidebarCaptureButton" class="ghost primary">捕获页面元素</button>
          </div>
          </section>
        </div>

        <div class="layout-main">
          <section class="panel" id="containersPanel">
          <div class="section-heading">
            <div>
              <div class="section-title">容器与 DOM</div>
              <p class="section-desc">树状容器 + DOM 映射（只读）</p>
            </div>
            <div class="mini-actions">
              <button id="openInspector" class="ghost">容器视图</button>
              <button id="linkModeButton" class="ghost">重连容器</button>
              <button id="refreshContainers" class="ghost">刷新面板</button>
            </div>
          </div>
          <div class="containers-tools">
            <div class="tool-tabs" role="tablist">
              <button class="tool-tab is-active" data-tab="dom" id="tabDomTools" aria-controls="domToolPanel">DOM 操作</button>
              <button class="tool-tab" data-tab="container" id="tabContainerTools" aria-controls="containerToolPanel">容器操作</button>
            </div>
            <div class="tool-panels">
              <div class="tool-panel is-active" id="domToolPanel" role="tabpanel" aria-labelledby="tabDomTools">
                <div class="dom-actions-panel" id="domActionsPanel">
                <div class="dom-actions-head">
                  <div>
                    <div class="dom-actions-title">DOM 节点操作</div>
                    <div class="dom-actions-target" id="domActionTarget">未选择 DOM 节点</div>
                  </div>
                <div class="dom-actions-status" id="domActionStatus"></div>
              </div>
                <div class="dom-actions-body">
                  <div class="dom-actions-row">
                    <label class="dom-actions-field">
                      <span>目标容器</span>
                      <select id="domActionContainerSelect"></select>
                  </label>
                  <button id="domActionReplace" class="ghost primary">替换容器选择器</button>
                </div>
                <div class="dom-actions-row">
                  <label class="dom-actions-field">
                    <span>新容器 ID</span>
                    <input id="domNewContainerId" type="text" placeholder="root.section" autocomplete="off" />
                  </label>
                  <label class="dom-actions-field">
                    <span>新容器别名</span>
                    <input id="domNewContainerAlias" type="text" placeholder="模块名称" autocomplete="off" />
                  </label>
                  <button id="domActionCreate" class="ghost">创建子容器</button>
                </div>
                <div class="dom-actions-row dom-highlight-row">
                  <label class="dom-actions-field">
                    <span>当前容器别名</span>
                    <input id="domAliasInput" type="text" placeholder="显示名称" autocomplete="off" />
                  </label>
                  <div class="dom-highlight-actions">
                    <button id="domActionSaveAlias" class="ghost">保存别名</button>
                    <label class="checkbox inline">
                      <input id="domHighlightHoldToggle" type="checkbox" />
                      <span>保持高亮</span>
                    </label>
                    <button id="domActionHighlight" class="ghost">高亮节点</button>
                    <button id="domActionClearHighlight" class="ghost">清除高亮</button>
                    <button id="domActionPick" class="ghost">拾取页面元素</button>
                  </div>
                </div>
                <div class="dom-actions-foot" id="domActionFootnote"></div>
                </div>
              </div>
                <div class="dom-secondary-actions">
                  <button id="domActionPickSidebar" class="ghost">捕获页面元素</button>
                </div>
              </div>
              <div class="tool-panel" id="containerToolPanel" role="tabpanel" aria-labelledby="tabContainerTools">
                <div class="container-ops-panel" id="containerOpsPanel">
                <div class="container-ops-head">
                  <div>
                    <div class="container-ops-title">容器操作配置</div>
                    <div class="container-ops-target" id="containerOpsTarget">未选择容器</div>
                  </div>
                <div class="container-ops-status" id="containerOpsStatus"></div>
              </div>
              <div class="container-ops-list" id="containerOpsList"></div>
                <div class="container-ops-actions">
                  <div class="container-ops-action-group">
                    <button id="containerOpsAddHighlight" class="ghost">+ 高亮操作</button>
                    <button id="containerOpsAddExtract" class="ghost">+ 提取链接</button>
                    <button id="containerOpsReset" class="ghost">重置</button>
                  </div>
                  <button id="containerOpsSave" class="primary">保存操作</button>
                </div>
                <textarea id="containerOpsEditor" class="container-ops-editor" spellcheck="false" placeholder="[]"></textarea>
                </div>
                <div class="operations-card">
                  <div class="subpanel-title">可用操作</div>
                  <div class="operation-chips" id="operationChips"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="tree-grid">
            <div class="tree-grid-header">
              <span class="col-container">容器（<span id="treeContainerCount">0</span>）</span>
              <span class="col-dom">DOM 节点（<span id="treeDomCount">0</span>）</span>
            </div>
            <div class="tree-grid-body">
              <div class="graph-shell" id="containerDomGrid">
                <div class="graph-canvas">
                  <canvas id="graphCanvas" width="400" height="300"></canvas>
                  <div class="graph-overlay">
                    <div class="tree-placeholder">
                      <strong>等待匹配</strong>
                      <p>选择会话后，通过 CLI 捕获容器树。</p>
                    </div>
                  </div>
                  <div class="graph-tooltip hidden" id="graphTooltip">
                    <div class="graph-tooltip-title"></div>
                    <div class="graph-tooltip-body"></div>
                  </div>
                </div>
                <div class="tree-detail" id="treeDetail">
                  <div class="tree-column">
                    <div class="tree-column-title">容器树</div>
                    <div class="tree-view scrollable" id="containerTreeView"></div>
                  </div>
                  <div class="tree-column">
                    <div class="tree-column-title">DOM Explorer</div>
                    <div class="tree-view scrollable" id="domTreeView"></div>
                  </div>
                  <svg id="matchLinkLayer" class="match-link-layer"></svg>
                </div>
              </div>
            </div>
          </div>
          <div class="link-mode-banner hidden" id="linkModeIndicator"></div>
          </section>

          <section class="panel log-panel" id="logPanel">
          <div class="section-heading">
            <div>
              <div class="section-title">日志面板</div>
              <p class="section-desc">读取 ~/.webauto/logs 下的运行日志</p>
            </div>
            <div class="mini-actions">
              <select id="logSourceSelect">
                <option value="browser">浏览器</option>
                <option value="service">服务</option>
                <option value="orchestrator">编排器</option>
              </select>
              <button id="refreshLogs" class="ghost">刷新</button>
              <button id="clearLogs" class="ghost">清空</button>
            </div>
          </div>
          <pre id="logStream" class="log-stream">暂无日志</pre>
          </section>
        </div>
      </main>
    </div>

    <div class="global-message hidden" id="globalMessage"></div>
    <script type="module">
      import('./main.js');
    </script>
  </body>
</html>
