{
  "name": "1688å¯¹è¯æ¡†å‘é€æŒ‰é’®åˆ†æ",
  "description": "ç™»å½•1688å¹¶åˆ†æå¯¹è¯æ¡†é¡µé¢ç»“æ„å’Œå‘é€æŒ‰é’®å…ƒç´ ",
  "version": "1.0.0",
  "preflows": ["1688-login-preflow"],
  "anchor": {
    "hostFilter": "1688.com",
    "selectors": [".userAvatarLogo img"],
    "requireVisible": true,
    "maxWaitMs": 600000,
    "pollIntervalMs": 1500,
    "highlight": true,
    "persistHighlight": true,
    "highlightLabel": "LOGIN_ANCHOR"
  },
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "å¼€å§‹", "next": ["attach"] },
    {
      "id": "attach",
      "type": "AttachSessionNode",
      "name": "ä¼šè¯æ¥åŠ›",
      "config": {},
      "next": ["navigate_to_chat"]
    },
    {
      "id": "navigate_to_chat",
      "type": "NavigationNode",
      "name": "å¯¼èˆªåˆ°1688èŠå¤©é¡µé¢",
      "config": {
        "url": "https://air.1688.com/app/ocms-fusion-components-1688/def_cbu_web_im/index.html",
        "waitUntil": "domcontentloaded",
        "timeout": 30000
      },
      "next": ["wait_chat_load"]
    },
    {
      "id": "wait_chat_load",
      "type": "WaitNode",
      "name": "ç­‰å¾…èŠå¤©é¡µé¢åŠ è½½",
      "config": { "minMs": 5000, "maxMs": 8000 },
      "next": ["analyze_dialog_structure"]
    },
    {
      "id": "analyze_dialog_structure",
      "type": "PageSnapshotNode",
      "name": "åˆ†æå¯¹è¯æ¡†é¡µé¢ç»“æ„",
      "config": {
        "script": "console.log('ğŸ” å¼€å§‹åˆ†æ1688å¯¹è¯æ¡†é¡µé¢ç»“æ„...'); const analysis = { timestamp: new Date().toISOString(), url: window.location.href, title: document.title }; const inputElements = []; document.querySelectorAll('textarea, input[type=\"text\"], input[type=\"email\"], [contenteditable], .chat-input, .message-input, [class*=\"input\"]').forEach((el, index) => { const rect = el.getBoundingClientRect(); inputElements.push({ index, tagName: el.tagName, className: el.className, id: el.id, placeholder: el.placeholder || el.getAttribute('placeholder') || '', visible: rect.width > 0 && rect.height > 0 && el.offsetParent !== null, rect: { width: rect.width, height: rect.height, x: rect.x, y: rect.y }, attributes: Array.from(el.attributes).map(attr => ({ name: attr.name, value: attr.value })), cssSelector: getCSSSelector(el) }); }); const buttonElements = []; document.querySelectorAll('button, [role=\"button\"], [class*=\"send\"], [class*=\"btn\"], input[type=\"submit\"], input[type=\"button\"]').forEach((el, index) => { const rect = el.getBoundingClientRect(); const text = el.textContent.trim() || el.value || el.getAttribute('aria-label') || ''; buttonElements.push({ index, tagName: el.tagName, className: el.className, id: el.id, text: text, visible: rect.width > 0 && rect.height > 0 && el.offsetParent !== null, rect: { width: rect.width, height: rect.height, x: rect.x, y: rect.y }, attributes: Array.from(el.attributes).map(attr => ({ name: attr.name, value: attr.value })), cssSelector: getCSSSelector(el), isSendButton: text.includes('å‘é€') || text.includes('Send') || el.className.includes('send') || el.className.includes('submit') }); }); const sendCandidates = buttonElements.filter(btn => btn.isSendButton); analysis.inputElements = inputElements; analysis.buttonElements = buttonElements; analysis.sendButtonCandidates = sendCandidates; analysis.totalInputs = inputElements.length; analysis.totalButtons = buttonElements.length; analysis.totalSendCandidates = sendCandidates.length; console.log(`ğŸ“Š åˆ†æç»“æœ: ${analysis.totalInputs}ä¸ªè¾“å…¥æ¡†, ${analysis.totalButtons}ä¸ªæŒ‰é’®, ${analysis.totalSendCandidates}ä¸ªå‘é€æŒ‰é’®å€™é€‰`); sendCandidates.forEach((btn, i) => { console.log(`ğŸ“¤ å‘é€æŒ‰é’®å€™é€‰${i+1}: ${btn.text} (${btn.cssSelector})`); }); function getCSSSelector(el) { if (el.id) return `#${el.id}; let path = []; while (el && el.nodeType === Node.ELEMENT_NODE) { let selector = el.nodeName.toLowerCase(); if (el.className) { const classes = el.className.split(' ').filter(c => c.trim()); if (classes.length > 0) { selector += '.' + classes.join('.'); } } path.unshift(selector); el = el.parentNode; } return path.join(' > '); } return analysis;",
        "saveScreenshots": true
      },
      "next": ["highlight_elements"]
    },
    {
      "id": "highlight_elements",
      "type": "JavaScriptExecutionNode",
      "name": "é«˜äº®æ˜¾ç¤ºå…³é”®å…ƒç´ ",
      "config": {
        "script": "console.log('ğŸ¨ å¼€å§‹é«˜äº®å…³é”®å…ƒç´ ...'); const highlightStyle = 'border: 3px solid red !important; background: rgba(255, 0, 0, 0.2) !important; z-index: 9999 !important; position: relative !important;'; const sendButtonStyle = 'border: 3px solid green !important; background: rgba(0, 255, 0, 0.2) !important; z-index: 9999 !important; position: relative !important;'; let highlightedCount = 0; document.querySelectorAll('textarea, input[type=\"text\"], [contenteditable], .chat-input, .message-input').forEach((el, index) => { if (el.getBoundingClientRect().width > 0 && el.getBoundingClientRect().height > 0) { el.style.cssText += highlightStyle; el.setAttribute('data-webauto-highlight', 'input-' + index); highlightedCount++; console.log(`âœ… é«˜äº®è¾“å…¥æ¡† ${index + 1}: ${el.tagName}${el.className ? '.' + el.className.split(' ').join('.') : ''}`); } }); document.querySelectorAll('button, [role=\"button\"], [class*=\"send\"], [class*=\"btn\"]').forEach((el, index) => { const rect = el.getBoundingClientRect(); if (rect.width > 0 && rect.height > 0) { const text = el.textContent.trim() || el.value || ''; const isSend = text.includes('å‘é€') || text.includes('Send') || el.className.includes('send') || el.className.includes('submit'); el.style.cssText += isSend ? sendButtonStyle : highlightStyle; el.setAttribute('data-webauto-highlight', isSend ? 'send-button-' + index : 'button-' + index); el.setAttribute('data-webauto-send', isSend ? '1' : '0'); highlightedCount++; console.log(`${isSend ? 'ğŸ“¤' : 'ğŸ”˜'} é«˜äº®${isSend ? 'å‘é€' : 'æ™®é€š'}æŒ‰é’® ${index + 1}: ${text || '(æ— æ–‡æœ¬)'} (${el.tagName}${el.className ? '.' + el.className.split(' ').join('.') : ''})`); } }); console.log(`ğŸ¯ é«˜äº®å®Œæˆ! æ€»å…±é«˜äº®äº† ${highlightedCount} ä¸ªå…ƒç´ `); return { success: true, highlightedCount: highlightedCount, timestamp: new Date().toISOString() };",
        "waitForResult": true
      },
      "next": ["extract_detailed_structure"]
    },
    {
      "id": "extract_detailed_structure",
      "type": "PageSnapshotNode",
      "name": "æå–è¯¦ç»†ç»“æ„ä¿¡æ¯",
      "config": {
        "script": "console.log('ğŸ”¬ æå–è¯¦ç»†ç»“æ„ä¿¡æ¯...'); const detailedAnalysis = { timestamp: new Date().toISOString(), pageStructure: {}, chatContainers: [], inputMethods: [], sendMethods: [] }; const chatContainers = document.querySelectorAll('[class*=\"chat\"], [class*=\"im\"], [class*=\"message\"], [class*=\"dialog\"], [class*=\"conversation\"]'); chatContainers.forEach((container, index) => { const rect = container.getBoundingClientRect(); if (rect.width > 0 && rect.height > 0) { detailedAnalysis.chatContainers.push({ index, tagName: container.tagName, className: container.className, id: container.id, rect: { width: rect.width, height: rect.height, x: rect.x, y: rect.y }, childCount: container.children.length, cssSelector: getCSSSelector(container) }); } }); const possibleInputs = ['textarea', 'input[type=\"text\"]', 'input[type=\"email\"]', '[contenteditable=\"true\"]', '.chat-input', '.message-input', '[class*=\"input\"]', '[class*=\"textarea\"]']; possibleInputs.forEach(selector => { document.querySelectorAll(selector).forEach((el, index) => { const rect = el.getBoundingClientRect(); if (rect.width > 0 && rect.height > 0) { detailedAnalysis.inputMethods.push({ selector, index, tagName: el.tagName, className: el.className, id: el.id, placeholder: el.placeholder || '', rect: { width: rect.width, height: rect.height, x: rect.x, y: rect.y }, cssSelector: getCSSSelector(el) }); } }); }); const sendSelectors = ['button[type=\"submit\"]', '[class*=\"send\"]', '[class*=\"submit\"]', 'button:contains(\"å‘é€\")', 'button:contains(\"Send\")', '[data-action=\"send\"]', '[role=\"button\"]:contains(\"å‘é€\")']; sendSelectors.forEach(selector => { try { document.querySelectorAll(selector).forEach((el, index) => { const rect = el.getBoundingClientRect(); if (rect.width > 0 && rect.height > 0) { const text = el.textContent.trim() || el.value || ''; detailedAnalysis.sendMethods.push({ selector, index, tagName: el.tagName, className: el.className, id: el.id, text: text, rect: { width: rect.width, height: rect.height, x: rect.x, y: rect.y }, cssSelector: getCSSSelector(el), attributes: Array.from(el.attributes).map(attr => ({ name: attr.name, value: attr.value })) }); } }); } catch (e) { console.log(`é€‰æ‹©å™¨ ${selector} æ‰§è¡Œå¤±è´¥:`, e.message); } }); const pageText = document.body.innerText; const hasChinese = /[\\u4e00-\\u9fff]/.test(pageText); detailedAnalysis.pageStructure = { hasChineseContent: hasChinese, totalElements: document.querySelectorAll('*').length, visibleButtons: document.querySelectorAll('button:not([style*=\"display: none\"]):not([hidden])').length, visibleInputs: document.querySelectorAll('textarea:not([style*=\"display: none\"]):not([hidden]), input[type=\"text\"]:not([style*=\"display: none\"]):not([hidden]), [contenteditable]:not([style*=\"display: none\"]):not([hidden])').length }; function getCSSSelector(el) { if (el.id) return `#${el.id}`; let path = []; while (el && el.nodeType === Node.ELEMENT_NODE) { let selector = el.nodeName.toLowerCase(); if (el.className) { const classes = el.className.split(' ').filter(c => c.trim()); if (classes.length > 0) { selector += '.' + classes.join('.'); } } path.unshift(selector); el = el.parentNode; } return path.join(' > '); } console.log(`ğŸ“‹ è¯¦ç»†åˆ†æå®Œæˆ: ${detailedAnalysis.chatContainers.length}ä¸ªèŠå¤©å®¹å™¨, ${detailedAnalysis.inputMethods.length}ç§è¾“å…¥æ–¹å¼, ${detailedAnalysis.sendMethods.length}ç§å‘é€æ–¹å¼`); return detailedAnalysis;",
        "saveScreenshots": true
      },
      "next": ["save_analysis"]
    },
    {
      "id": "save_analysis",
      "type": "ResultSaverNode",
      "name": "ä¿å­˜åˆ†æç»“æœ",
      "config": {
        "outputDir": "archive/workflow-records",
        "filenameTemplate": "1688-chat-dialog-analysis-{timestamp}.json",
        "includeMetadata": true
      },
      "next": ["end"]
    },
    {
      "id": "end",
      "type": "EndNode",
      "name": "ç»“æŸ",
      "config": { "cleanup": false, "saveLogs": true }
    }
  ],
  "globalConfig": {
    "logLevel": "info",
    "screenshotOnError": true,
    "autoCleanup": false,
    "parallelExecution": false,
    "timeout": 600000
  }
}