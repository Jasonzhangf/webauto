{
  "name": "1688é¡µé¢ç»“æ„åˆ†æ",
  "description": "åˆ†æ1688æœç´¢ç»“æœé¡µé¢çš„DOMç»“æ„ï¼Œæ‰¾åˆ°å•†å®¶åˆ—è¡¨å’Œæ—ºæ—ºé“¾æ¥çš„æ­£ç¡®é€‰æ‹©å™¨",
  "version": "1.0.0",
  "preflows": ["1688-login-preflow"],
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "å¼€å§‹", "next": ["attach"] },
    {
      "id": "attach",
      "type": "AttachSessionNode",
      "name": "ä¼šè¯æ¥åŠ›",
      "config": {},
      "next": ["navigate_search"]
    },
    {
      "id": "navigate_search",
      "type": "NavigationNode",
      "name": "å¯¼èˆªåˆ°æœç´¢ç»“æœé¡µ",
      "config": {
        "url": "https://s.1688.com/selloffer/offer_search.htm?keywords=%B7%FE%D7%B0",
        "waitUntil": "domcontentloaded",
        "timeout": 30000
      },
      "next": ["wait_search"]
    },
    {
      "id": "wait_search",
      "type": "WaitNode",
      "name": "ç­‰å¾…æœç´¢ç»“æœåŠ è½½",
      "config": { "minMs": 3000, "maxMs": 5000 },
      "next": ["analyze_page_structure"]
    },
    {
      "id": "analyze_page_structure",
      "type": "PageSnapshotNode",
      "name": "åˆ†æé¡µé¢æ•´ä½“ç»“æ„",
      "config": {
        "script": "console.log('ğŸ” å¼€å§‹åˆ†æ1688é¡µé¢ç»“æ„...'); const analysis = { title: document.title, url: window.location.href, userAgent: navigator.userAgent }; // åˆ†æä¸»è¦å®¹å™¨ const mainContainers = []; const containerSelectors = ['#container', '.container', '.main', '[class*main]', '[class*container]', '.sm-offer-list', '.offer-list', '.search-result']; containerSelectors.forEach(selector => { const elements = document.querySelectorAll(selector); if (elements.length > 0) { mainContainers.push({ selector, count: elements.length, firstElementId: elements[0].id, firstElementClass: elements[0].className, innerHTML: elements[0].innerHTML.substring(0, 200) }); } }); // åˆ†æå•†å®¶å®¹å™¨ const merchantContainers = []; const merchantSelectors = ['.sm-offer-item', '.offer-item', '.sm-offer', '[class*=offer]', '.product-item', '[class*=product]', '.sm-offer-card', '[class*=card]', '.list-item', '[class*=item]']; merchantSelectors.forEach(selector => { const elements = document.querySelectorAll(selector); if (elements.length > 0) { const firstElement = elements[0]; merchantContainers.push({ selector, count: elements.length, hasImage: !!firstElement.querySelector('img'), hasLink: !!firstElement.querySelector('a'), hasPrice: !!firstElement.querySelector('[class*=price], [data-price], .price'), hasTitle: !!firstElement.querySelector('h4, h3, h5, [class*=title]'), htmlSample: firstElement.outerHTML.substring(0, 300) }); } }); // åˆ†æè”ç³»/èŠå¤©å…ƒç´  const contactElements = []; const contactSelectors = ['[class*=contact]', '[class*=chat]', '[class*=talk]', '[class*=im]', '[class*=æ—ºæ—º]', '.sm-im', '.s-im', '[data-im]', '[onclick*=chat]', '[onclick*=talk]', 'a[href*=\"im\"]', 'a[href*=\"chat\"]', 'button[onclick*=\"chat\"]']; contactSelectors.forEach(selector => { const elements = document.querySelectorAll(selector); if (elements.length > 0) { const samples = Array.from(elements).slice(0, 3).map(el => ({ text: el.textContent.trim(), href: el.href, onclick: el.getAttribute('onclick'), className: el.className, tagName: el.tagName })); contactElements.push({ selector, count: elements.length, samples: samples }); } }); // åˆ†æåˆ†é¡µ const pagination = document.querySelector('.ui-pagination, .pagination, [class*=page]'); const paginationInfo = pagination ? { exists: true, className: pagination.className, html: pagination.outerHTML.substring(0, 200) } : { exists: false }; console.log('é¡µé¢ç»“æ„åˆ†æå®Œæˆ'); console.log('ä¸»è¦å®¹å™¨æ•°é‡:', mainContainers.length); console.log('å•†å®¶å®¹å™¨æ•°é‡:', merchantContainers.length); console.log('è”ç³»å…ƒç´ æ•°é‡:', contactElements.length); return { success: true, analysis: analysis, mainContainers: mainContainers, merchantContainers: merchantContainers, contactElements: contactElements, paginationInfo: paginationInfo, timestamp: new Date().toISOString() };",
        "saveScreenshots": true
      },
      "next": ["test_selectors"]
    },
    {
      "id": "test_selectors",
      "type": "PageSnapshotNode",
      "name": "æµ‹è¯•æœ€ä½³é€‰æ‹©å™¨",
      "config": {
        "script": "console.log('ğŸ§ª æµ‹è¯•é€‰æ‹©å™¨å¹¶é«˜äº®æ˜¾ç¤º...'); const results = []; // æµ‹è¯•å•†å®¶å®¹å™¨é€‰æ‹©å™¨ const testMerchantSelectors = ['.sm-offer-item', '.offer-item', '.sm-offer', '[class*=offer]']; testMerchantSelectors.forEach(selector => { const elements = document.querySelectorAll(selector); if (elements.length > 0 && elements.length <= 50) { // é«˜äº®æ˜¾ç¤ºå…ƒç´  elements.forEach((el, index) => { if (index < 3) { el.style.border = '3px solid red'; el.style.backgroundColor = 'yellow'; el.style.zIndex = '9999'; } }); results.push({ type: 'merchant', selector: selector, count: elements.length, highlighted: Math.min(3, elements.length), status: 'tested' }); } }); // æµ‹è¯•è”ç³»æŒ‰é’®é€‰æ‹©å™¨ const testContactSelectors = ['[class*=contact]', '[class*=chat]', '[class*=im]', '.sm-im', '[class*=æ—ºæ—º]']; testContactSelectors.forEach(selector => { const elements = document.querySelectorAll(selector); if (elements.length > 0) { // é«˜äº®æ˜¾ç¤º elements.forEach((el, index) => { if (index < 2) { el.style.border = '3px solid blue'; el.style.backgroundColor = 'lightblue'; el.style.zIndex = '9999'; } }); results.push({ type: 'contact', selector: selector, count: elements.length, highlighted: Math.min(2, elements.length), status: 'tested' }); } }); // 3ç§’åç§»é™¤é«˜äº® setTimeout(() => { document.querySelectorAll('[style*=\"border\"]').forEach(el => { el.style.border = ''; el.style.backgroundColor = ''; el.style.zIndex = ''; }); }, 3000); console.log('é€‰æ‹©å™¨æµ‹è¯•å®Œæˆï¼Œé«˜äº®3ç§’'); return { success: true, testedSelectors: results, totalTested: results.length, timestamp: new Date().toISOString() };",
        "saveScreenshots": true
      },
      "next": ["extract_sample_data"]
    },
    {
      "id": "extract_sample_data",
      "type": "PageSnapshotNode",
      "name": "æå–æ ·æœ¬æ•°æ®éªŒè¯",
      "config": {
        "script": "console.log('ğŸ“Š æå–æ ·æœ¬å•†å®¶æ•°æ®è¿›è¡ŒéªŒè¯...'); const sampleData = []; // ä½¿ç”¨æœ€ä½³é€‰æ‹©å™¨æå–å•†å®¶ä¿¡æ¯ const bestMerchantSelector = '.sm-offer-item'; const merchants = document.querySelectorAll(bestMerchantSelector); console.log('æ‰¾åˆ°å•†å®¶æ•°é‡:', merchants.length); // æå–å‰5ä¸ªå•†å®¶çš„è¯¦ç»†ä¿¡æ¯ for (let i = 0; i < Math.min(5, merchants.length); i++) { const item = merchants[i]; const titleEl = item.querySelector('h4, [class*=title], a[title], [class*=name]'); const linkEl = item.querySelector('a[href*=\"1688.com\"]'); const priceEl = item.querySelector('[class*=price], [data-price], .price'); const imgEl = item.querySelector('img[src]'); const contactEl = item.querySelector('[class*=contact], [class*=chat], [class*=im], [class*=æ—ºæ—º], .sm-im'); const companyEl = item.querySelector('[class*=company], [class*=shop]'); const merchantLink = linkEl ? linkEl.href : null; // æå–å•†å®¶ID let merchantId = null; if (merchantLink) { const idMatch = merchantLink.match(/member_id=([\\d]+)/); if (idMatch) merchantId = idMatch[1]; else { const pathMatch = merchantLink.match(/\\/(\\d+)\\.htm/); if (pathMatch) merchantId = pathMatch[1]; } } sampleData.push({ index: i, merchantId: merchantId, title: titleEl ? titleEl.textContent.trim() : '', companyName: companyEl ? companyEl.textContent.trim() : '', price: priceEl ? priceEl.textContent.trim() : '', merchantLink: merchantLink, hasImage: !!imgEl, hasContact: !!contactEl, contactInfo: contactEl ? { className: contactEl.className, text: contactEl.textContent.trim(), href: contactEl.href } : null, itemHTML: item.outerHTML.substring(0, 200) }); } // åˆ†ææ•°æ®è´¨é‡ const validMerchants = sampleData.filter(m => m.merchantId && m.title); const withContact = sampleData.filter(m => m.hasContact); console.log('æœ‰æ•ˆå•†å®¶æ•°é‡:', validMerchants.length); console.log('æœ‰è”ç³»æ–¹å¼çš„å•†å®¶æ•°é‡:', withContact.length); console.log('æ ·æœ¬æ•°æ®æå–å®Œæˆ'); return { success: true, sampleData: sampleData, totalFound: merchants.length, validMerchants: validMerchants.length, withContact: withContact.length, timestamp: new Date().toISOString() };",
        "saveScreenshots": true
      },
      "next": ["save_analysis"]
    },
    {
      "id": "save_analysis",
      "type": "ResultSaverNode",
      "name": "ä¿å­˜åˆ†æç»“æœ",
      "config": {
        "outputDir": "archive/workflow-records",
        "filenameTemplate": "1688-page-structure-analysis-{timestamp}.json",
        "includeMetadata": true
      },
      "next": ["end"]
    },
    {
      "id": "end",
      "type": "EndNode",
      "name": "ç»“æŸåˆ†æ",
      "config": { "cleanup": false, "saveLogs": true }
    }
  ],
  "globalConfig": {
    "logLevel": "info",
    "screenshotOnError": true,
    "autoCleanup": false,
    "parallelExecution": false,
    "timeout": 300000
  }
}