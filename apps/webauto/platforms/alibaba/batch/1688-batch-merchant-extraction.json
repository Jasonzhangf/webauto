{
  "name": "1688æ‰¹é‡å•†å®¶ä¿¡æ¯è·å–å·¥ä½œæµ",
  "description": "ä»ä¸»é¡µæœç´¢å¼€å§‹ï¼Œæ‰¹é‡è·å–å•†å®¶ä¿¡æ¯å’Œè”ç³»æ–¹å¼",
  "version": "1.0.0",
  "preflows": [
    "1688-login-preflow"
  ],
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "å¼€å§‹", "next": ["attach"] },
    { "id": "attach", "type": "AttachSessionNode", "name": "ä¼šè¯æ¥åŠ›", "config": {}, "next": ["navigate_homepage"] },
    {
      "id": "navigate_homepage",
      "type": "NavigationNode",
      "name": "å¯¼èˆªåˆ°ä¸»é¡µ",
      "config": {
        "url": "https://www.1688.com/",
        "waitUntil": "networkidle",
        "timeout": 30000
      },
      "next": ["wait_homepage"]
    },
    {
      "id": "wait_homepage",
      "type": "WaitNode",
      "name": "ç­‰å¾…ä¸»é¡µç¨³å®š",
      "config": { "minMs": 2000, "maxMs": 3000 },
      "next": ["find_search_box"]
    },
    {
      "id": "find_search_box",
      "type": "PageSnapshotNode",
      "name": "æŸ¥æ‰¾æœç´¢æ¡†",
      "config": {
        "script": "console.log('ğŸ” æŸ¥æ‰¾æœç´¢æ¡†...'); const searchSelectors = ['input[placeholder*=\"æœç´¢\"]', 'input[type=\"search\"]', '.search-input', '#q', 'input[name=\"q\"]']; let searchInput = null; let foundSelector = null; for (const selector of searchSelectors) { const element = document.querySelector(selector); if (element) { searchInput = element; foundSelector = selector; break; } } if (searchInput) { console.log('âœ… æ‰¾åˆ°æœç´¢æ¡†:', foundSelector); searchInput.style.border = '3px solid blue'; searchInput.style.backgroundColor = 'lightblue'; } else { console.log('âŒ æœªæ‰¾åˆ°æœç´¢æ¡†'); } return { success: !!searchInput, selector: foundSelector, elementCount: searchSelectors.length, timestamp: new Date().toISOString() };",
        "saveScreenshots": true
      },
      "next": ["natural_search_input"]
    },
    {
      "id": "natural_search_input",
      "type": "PageSnapshotNode",
      "name": "è‡ªç„¶è¾“å…¥æœç´¢å…³é”®è¯",
      "config": {
        "script": "console.log('ğŸ” å¼€å§‹è‡ªç„¶æœç´¢è¡Œä¸ºæ¨¡æ‹Ÿ...'); const searchKeyword = 'æœè£…æ‰¹å‘'; const searchSelectors = ['input[placeholder*=\"æœç´¢\"]', 'input[type=\"search\"]', '.search-input', '#q', 'input[name=\"q\"]']; let searchInput = null; let foundSelector = null; for (const selector of searchSelectors) { const element = document.querySelector(selector); if (element) { searchInput = element; foundSelector = selector; break; } } if (searchInput) { console.log('âœ… æ‰¾åˆ°æœç´¢æ¡†:', foundSelector); searchInput.focus(); searchInput.click(); await new Promise(resolve => setTimeout(resolve, 500 + Math.random() * 500)); searchInput.value = ''; for (let i = 0; i < searchKeyword.length; i++) { searchInput.value += searchKeyword[i]; const event = new Event('input', { bubbles: true }); searchInput.dispatchEvent(event); await new Promise(resolve => setTimeout(resolve, 80 + Math.random() * 120)); } console.log('âœ… è‡ªç„¶è¾“å…¥å®Œæˆ:', searchKeyword); } else { console.log('âŒ æœç´¢æ¡†æœªæ‰¾åˆ°'); } return { success: !!searchInput, selector: foundSelector, keyword: searchKeyword, timestamp: new Date().toISOString() };",
        "saveScreenshots": false
      },
      "next": ["wait_before_search"]
    },
    {
      "id": "wait_before_search",
      "type": "WaitNode",
      "name": "è¾“å…¥åç­‰å¾…æ¨¡æ‹Ÿæ€è€ƒ",
      "config": { "minMs": 800, "maxMs": 1500 },
      "next": ["execute_search"]
    },
    {
      "id": "execute_search",
      "type": "PageSnapshotNode",
      "name": "æ‰§è¡Œæœç´¢",
      "config": {
        "script": "console.log('ğŸ” æ‰§è¡Œæœç´¢...'); const searchSelectors = ['input[placeholder*=\"æœç´¢\"]', 'input[type=\"search\"]', '.search-input', '#q', 'input[name=\"q\"]']; let searchInput = null; for (const selector of searchSelectors) { const element = document.querySelector(selector); if (element) { searchInput = element; break; } } if (searchInput) { const searchButtonSelectors = ['.search-btn', '.btn-search', 'button[type=\"submit\"]', '.search-button']; let searchButton = null; for (const selector of searchButtonSelectors) { const element = document.querySelector(selector); if (element) { searchButton = element; break; } } if (searchButton) { console.log('âœ… æ‰¾åˆ°æœç´¢æŒ‰é’®ï¼Œç‚¹å‡»æœç´¢'); searchButton.click(); } else { console.log('âœ… æœªæ‰¾åˆ°æœç´¢æŒ‰é’®ï¼Œä½¿ç”¨å›è½¦é”®'); searchInput.focus(); const enterEvent = new KeyboardEvent('keydown', { key: 'Enter', code: 'Enter', keyCode: 13, which: 13, bubbles: true, cancelable: true }); searchInput.dispatchEvent(enterEvent); } } else { console.log('âŒ æœç´¢æ¡†æœªæ‰¾åˆ°'); } return { success: !!searchInput, timestamp: new Date().toISOString() };",
        "saveScreenshots": false
      },
      "next": ["wait_search_results"]
    },
    {
      "id": "wait_search_results",
      "type": "WaitNode",
      "name": "ç­‰å¾…æœç´¢ç»“æœ",
      "config": { "minMs": 3000, "maxMs": 5000 },
      "next": ["check_search_page"]
    },
    {
      "id": "check_search_page",
      "type": "PageSnapshotNode",
      "name": "æ£€æŸ¥æœç´¢ç»“æœé¡µé¢",
      "config": {
        "script": "console.log('ğŸ” æ£€æŸ¥æœç´¢ç»“æœé¡µé¢...'); const currentUrl = window.location.href; const isSearchPage = currentUrl.includes('search.1688.com') || currentUrl.includes('offer'); const productSelectors = ['.sm-offer-item', '.offer-item', '.product-item', '.item']; let products = []; let foundSelector = null; for (const selector of productSelectors) { const elements = document.querySelectorAll(selector); if (elements.length > 0) { products = Array.from(elements); foundSelector = selector; break; } } console.log('å½“å‰URL:', currentUrl); console.log('æ˜¯å¦æœç´¢é¡µ:', isSearchPage); console.log('å•†å“æ•°é‡:', products.length); if (foundSelector) { console.log('ä½¿ç”¨é€‰æ‹©å™¨:', foundSelector); } return { success: isSearchPage && products.length > 0, url: currentUrl, isSearchPage, productCount: products.length, selector: foundSelector, timestamp: new Date().toISOString() };",
        "saveScreenshots": true
      },
      "next": ["extract_merchant_info"]
    },
    {
      "id": "extract_merchant_info",
      "type": "PageSnapshotNode",
      "name": "æå–å•†å®¶ä¿¡æ¯",
      "config": {
        "script": "console.log('ğŸ“Š å¼€å§‹æå–å•†å®¶ä¿¡æ¯...'); const productSelector = '.sm-offer-item, .offer-item, .product-item, .item'; const products = Array.from(document.querySelectorAll(productSelector)); const merchantData = []; products.slice(0, 5).forEach((product, index) => { try { const titleEl = product.querySelector('.title, .product-title, h4, h3') || product; const title = titleEl.textContent?.trim() || 'æœªçŸ¥å•†å“'; const priceEl = product.querySelector('.price, .cost, [class*=\"price\"]') || product; const price = priceEl.textContent?.trim() || 'ä»·æ ¼é¢è®®'; const contactBtn = product.querySelector('a[href*=\"contact\"], button[title*=\"è”ç³»\"], .contact-btn, .chat-btn'); const hasContact = !!contactBtn; const merchantEl = product.querySelector('.company, .shop, .merchant, [class*=\"shop\"]') || product; const merchantName = merchantEl.textContent?.trim() || `å•†å®¶${index + 1}`; merchantData.push({ index: index + 1, title, price, merchantName, hasContact, contactSelector: contactBtn ? (contactBtn.tagName.toLowerCase() + (contactBtn.className ? '.' + contactBtn.className.split(' ').join('.') : '')) : null }); console.log(`âœ… æå–å•†å®¶ ${index + 1}: ${merchantName} - ${title}`); } catch (error) { console.error(`âŒ æå–å•†å®¶ ${index + 1} ä¿¡æ¯å¤±è´¥:`, error.message); } }); console.log(`ğŸ“Š æ€»å…±æå– ${merchantData.length} ä¸ªå•†å®¶ä¿¡æ¯`); return { success: merchantData.length > 0, merchantCount: merchantData.length, merchants: merchantData, timestamp: new Date().toISOString() };",
        "saveScreenshots": true
      },
      "next": ["save_merchant_data"]
    },
    {
      "id": "save_merchant_data",
      "type": "ResultSaverNode",
      "name": "ä¿å­˜å•†å®¶æ•°æ®",
      "config": {
        "outputDir": "archive/workflow-records",
        "filenameTemplate": "1688-batch-merchant-data-{timestamp}.json",
        "includeMetadata": true
      },
      "next": ["test_batch_chat"]
    },
    {
      "id": "test_batch_chat",
      "type": "PageSnapshotNode",
      "name": "æµ‹è¯•æ‰¹é‡èŠå¤©è®¿é—®",
      "config": {
        "script": "console.log('ğŸ’¬ æµ‹è¯•æ‰¹é‡èŠå¤©è®¿é—®...'); const productSelector = '.sm-offer-item, .offer-item, .product-item, .item'; const products = Array.from(document.querySelectorAll(productSelector)).slice(0, 2); const chatResults = []; for (let i = 0; i < products.length; i++) { try { const product = products[i]; const contactBtn = product.querySelector('a[href*=\"contact\"], button[title*=\"è”ç³»\"], .contact-btn, .chat-btn'); if (contactBtn) { console.log(`ğŸ” æ‰¾åˆ°å•†å®¶ ${i + 1} è”ç³»æŒ‰é’®`); contactBtn.style.border = '3px solid green'; contactBtn.style.backgroundColor = 'lightgreen'; chatResults.push({ merchantIndex: i + 1, hasContact: true, buttonHighlighted: true }); } else { console.log(`âŒ å•†å®¶ ${i + 1} æœªæ‰¾åˆ°è”ç³»æŒ‰é’®`); chatResults.push({ merchantIndex: i + 1, hasContact: false, buttonHighlighted: false }); } } catch (error) { console.error(`âŒ å¤„ç†å•†å®¶ ${i + 1} èŠå¤©æµ‹è¯•å¤±è´¥:`, error.message); chatResults.push({ merchantIndex: i + 1, hasContact: false, error: error.message }); } } console.log(`ğŸ’¬ æ‰¹é‡èŠå¤©æµ‹è¯•å®Œæˆï¼Œå¤„ç† ${chatResults.length} ä¸ªå•†å®¶`); return { success: chatResults.length > 0, testedCount: chatResults.length, results: chatResults, timestamp: new Date().toISOString() };",
        "saveScreenshots": true
      },
      "next": ["final_report"]
    },
    {
      "id": "final_report",
      "type": "ResultSaverNode",
      "name": "ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š",
      "config": {
        "outputDir": "archive/workflow-records",
        "filenameTemplate": "1688-batch-processing-report-{timestamp}.json",
        "includeMetadata": true
      },
      "next": ["end"]
    },
    {
      "id": "end",
      "type": "EndNode",
      "name": "ç»“æŸ",
      "config": { "cleanup": false, "saveLogs": true }
    }
  ],
  "globalConfig": {
    "logLevel": "info",
    "screenshotOnError": true,
    "autoCleanup": false,
    "parallelExecution": false,
    "timeout": 300000
  }
}