# WebAuto ä»»åŠ¡è¿½è¸ªï¼ˆå°çº¢ä¹¦ Workflow æ‹† Block è½åœ°ï¼‰

> ç›®æ ‡ï¼šåŸºäºå®¹å™¨é©±åŠ¨çš„ Workflow å®Œæˆå°çº¢ä¹¦æœç´¢ + è¯¦æƒ… + è¯„è®ºé‡‡é›†ï¼ˆç›®æ ‡ 100 æ¡ï¼‰ã€‚

## å½“å‰å®ç°çŠ¶æ€ï¼ˆ2026-01-12 12:50 PMï¼‰

### ğŸ¯ æ ¸å¿ƒæœåŠ¡å·²å®Œæˆï¼ˆdaemon + state centerï¼‰

#### âœ… æœåŠ¡å±‚ï¼ˆç»Ÿä¸€ daemon å¸¸é©»ï¼‰
- **Core Daemon**ï¼š`scripts/core-daemon.mjs` å·²è½åœ°
  - å‘½ä»¤ï¼š`start|stop|status|restart`
  - ç»Ÿä¸€ç®¡ç†ï¼šUnified API(7701)ã€Browser Service(7704)ã€SearchGate(7790)
  - PID ç®¡ç† + å¥åº·æ£€æŸ¥
  - çŠ¶æ€éªŒè¯ï¼šæ‰€æœ‰æœåŠ¡è¿è¡Œæ­£å¸¸
    ```bash
    $ node scripts/core-daemon.mjs status
    unified-api       7701     healthy      -          âœ“ OK
    browser-service   7704     healthy      -          âœ“ OK
    search-gate       7790     healthy      -          âœ“ OK
    ```

#### âœ… çŠ¶æ€ä¸­å¿ƒï¼ˆStateRegistryï¼‰
- **æ–‡ä»¶**ï¼š`services/unified-api/state-registry.ts`
- **åŠŸèƒ½**ï¼š
  - ServiceStateï¼šæœåŠ¡åç§°/ç«¯å£/çŠ¶æ€/å¥åº·æ—¶é—´
  - SessionStateï¼šprofile/session/URL/é˜¶æ®µ/æ´»åŠ¨æ—¶é—´
  - EnvStateï¼šæ„å»ºç‰ˆæœ¬/é…ç½®è·¯å¾„/ç‰¹æ€§å¼€å…³

#### âœ… æµè§ˆå™¨ä¼šè¯ç®¡ç†
- **start-headful.mjs**ï¼šå·²æ”¹ä¸º daemon æ¨¡å¼
  - ä¸å†å¯åŠ¨æœåŠ¡ï¼Œä»…åˆ›å»ºä¼šè¯
  - æ”¯æŒ headless å‚æ•°ä¼ é€’
  - ç™»å½•æ£€æµ‹åŸºäºå®¹å™¨åŒ¹é…
- **å½“å‰ä¼šè¯**ï¼š`xiaohongshu_fresh` å·²åˆ›å»ºå¹¶è¿è¡Œ
  - Browser Service å¯è§ï¼ˆé€šè¿‡ `/command getStatus`ï¼‰
  - Phase è„šæœ¬å¯å¤ç”¨ï¼ˆé€šè¿‡ `session:list`ï¼‰

### âœ… Phase 2 æœç´¢åŠŸèƒ½éªŒè¯ï¼ˆ2026-01-12 12:48 PMï¼‰

**è„šæœ¬**ï¼š`scripts/xiaohongshu/tests/phase2-search-v3.mjs`

**æµ‹è¯•ç»“æœ**ï¼šâœ… é€šè¿‡
- âœ… æœç´¢æ¡†é”šç‚¹éªŒè¯ï¼šRect(501.3, 16.0, 437.3, 40.0)
- âœ… æœç´¢è¾“å…¥ + å›è½¦ï¼šå…³é”®è¯"åä¸º"
- âœ… æœç´¢ç»“æœåˆ—è¡¨ï¼šé‡‡é›† 24 æ¡ï¼ˆå»é‡å 24 æ¡ï¼‰
- âš ï¸  URL æœªè·³è½¬åˆ° `/search_result`ï¼ˆå°çº¢ä¹¦ä½¿ç”¨ AJAX åŠ¨æ€æ›´æ–°ï¼‰

**å‰ 3 æ¡ç»“æœ**ï¼š
1. æœ¬åœ°éƒ¨ç½²AIå…³é”®æ—¶åˆ»è¿˜çœŸèµ·äº†å¤§ä½œç”¨â€¦â€¼ï¸ (note_id: 69461583000000001d03c3b2)
2. å¼€é€ ï¼Œèµ›é“è§ï¼ğŸ (note_id: 6953ac06000000001e02e9e0)
3. äººè´©å­ä¸ä¼šå‘Šè¯‰ä½ ... (note_id: 69634b4d0000000022008fe0)

### âš ï¸ å½“å‰é—®é¢˜

#### é—®é¢˜ 1ï¼šcontainers:match è¶…æ—¶ï¼ˆP1 ä¼˜å…ˆçº§ï¼‰
**ç°è±¡**ï¼š
- Phase1 ç™»å½•æ£€æµ‹æ—¶ `containers:match` æ“ä½œè¶…æ—¶ï¼ˆ10sï¼‰
- Phase3 è¯¦æƒ…é¡µéªŒè¯æ—¶ `containers:match` åŒæ ·è¶…æ—¶

**å½±å“**ï¼š
- æ‰€æœ‰ä¾èµ–å®¹å™¨åŒ¹é…çš„é€»è¾‘éƒ½è¢«é˜»å¡
- å¿…é¡»é™çº§åˆ°çº¯ DOM é€‰æ‹©å™¨

**è§£å†³æ–¹æ¡ˆï¼ˆå·²éƒ¨åˆ†å®æ–½ï¼‰**ï¼š
- âœ… Phase2 å·²æ”¹ä¸ºçº¯ DOM é€‰æ‹©å™¨ï¼ˆä¸ä¾èµ–å®¹å™¨åŒ¹é…ï¼‰
- ğŸš§ Phase1 éœ€æ·»åŠ è¶…æ—¶ä¿æŠ¤ + URL é™çº§æ£€æµ‹
- ğŸš§ Phase3/4 éœ€ç®€åŒ–ç‰ˆæœ¬ï¼ˆ/tmp/phase3-detail-simple.mjsï¼‰

#### é—®é¢˜ 2ï¼šStateRegistry ä¼šè¯åŒæ­¥å»¶è¿Ÿ
**ç°è±¡**ï¼š
- Browser Service è¿”å›ä¼šè¯
- Unified API `/v1/system/sessions` è¿”å›ç©ºæ•°ç»„
- Phase è„šæœ¬é€šè¿‡ `session:list` å¯è§ä¼šè¯

**å½±å“**ï¼šè¾ƒå°ï¼ˆè„šæœ¬å¯é€šè¿‡ controller action è®¿é—®ï¼‰

**å¾…ä¿®å¤**ï¼šRemoteSessionManager å¯åŠ¨æ—¶è‡ªåŠ¨åŒæ­¥é€»è¾‘

### ğŸ“‹ ä¸‹ä¸€æ­¥å·¥ä½œï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

#### P0ï¼šéªŒè¯ Phase 1-4 åŸºç¡€èƒ½åŠ›ï¼ˆå½“å‰æ‰§è¡Œï¼‰

**ç›®æ ‡**ï¼šä¸ä¾èµ–å®¹å™¨åŒ¹é…ï¼Œä½¿ç”¨çº¯ DOM é€‰æ‹©å™¨å®Œæˆå®Œæ•´æµç¨‹

1. âœ… **Phase 1**ï¼šä¼šè¯æ£€æµ‹
   - æ£€æµ‹æ–¹æ³•ï¼š`session:list` + URL åˆ¤æ–­
   - çŠ¶æ€ï¼šå·²é€šè¿‡ï¼ˆä¼šè¯å­˜åœ¨ï¼ŒURL å¯è·å–ï¼‰

2. âœ… **Phase 2**ï¼šæœç´¢åŠŸèƒ½
   - æ‰§è¡Œæ–¹æ³•ï¼šDOM é€‰æ‹©å™¨ + ç³»ç»Ÿç‚¹å‡»
   - çŠ¶æ€ï¼šå·²é€šè¿‡ï¼ˆ24 æ¡ç»“æœï¼‰

3. ğŸš§ **Phase 3**ï¼šè¯¦æƒ…é¡µéªŒè¯
   - ç®€åŒ–è„šæœ¬ï¼š`/tmp/phase3-detail-simple.mjs`
   - å¾…éªŒè¯ï¼šç‚¹å‡»è¿›å…¥ + å…ƒç´ éªŒè¯

4. â³ **Phase 4**ï¼šè¯„è®ºåŠŸèƒ½
   - å¾…æ‰§è¡Œ

#### P1ï¼šä¿®å¤ containers:match è¶…æ—¶

**æ–¹æ¡ˆ A**ï¼šæ·»åŠ è¶…æ—¶ä¿æŠ¤
- æ‰€æœ‰ `containers:match` è°ƒç”¨æ·»åŠ  5s è¶…æ—¶
- è¶…æ—¶åé™çº§åˆ°å›ºå®šå®¹å™¨ ID æˆ– DOM é€‰æ‹©å™¨

**æ–¹æ¡ˆ B**ï¼šä¼˜åŒ–å®¹å™¨åŒ¹é…æ€§èƒ½
- åˆ†æ Container Library ç´¢å¼•åŠ è½½æ—¶é—´
- å‡å°‘ maxDepth/maxChildren å‚æ•°
- ç¼“å­˜åŒ¹é…ç»“æœ

#### P2ï¼šä¼˜åŒ–é‡‡é›†æ•ˆæœ
1. æœç´¢åˆ—è¡¨æ»šåŠ¨ï¼ˆç›®æ ‡ 5+ æ¡å¯è§ï¼‰
2. è¯¦æƒ…å†…å®¹æŠ½å–ä¸ä¸ºç©º
3. è¯„è®ºåŒºæ»šåŠ¨ç­–ç•¥ï¼ˆé¿å…ç¦»å±ï¼‰

#### P3ï¼šé›†æˆæµ‹è¯•
1. å®Œæ•´ collect-100 workflow
2. å†™ç›˜è·¯å¾„å’Œæ ¼å¼éªŒè¯
3. å‹åŠ›æµ‹è¯•ï¼ˆè¿ç»­ 10+ æ¡ï¼‰

---

## æ‰§è¡Œè®°å½•ï¼ˆè¯æ®é“¾ï¼‰

### 2026-01-12 12:48 PMï¼šPhase 2 æœç´¢éªŒè¯é€šè¿‡
```bash
$ node scripts/xiaohongshu/tests/phase2-search-v3.mjs
ğŸ” Phase 2 v3: æœç´¢éªŒè¯ï¼ˆå¢å¼ºç‰ˆï¼‰

1ï¸âƒ£ è¿›å…¥å‰æ£€æŸ¥...
   URL: https://www.xiaohongshu.com/explore
   æ ¹å®¹å™¨: xiaohongshu_home
   âœ… é¡µé¢çŠ¶æ€æ£€æŸ¥é€šè¿‡

2ï¸âƒ£ éªŒè¯æœç´¢æ¡†é”šç‚¹...
ğŸ” éªŒè¯é”šç‚¹: æœç´¢æ¡† (#search-input, input[type="search"])
   âœ… æ‰¾åˆ°å…ƒç´ 
      Rect: x=501.3, y=16.0, w=437.3, h=40.0

3ï¸âƒ£ æ‰§è¡Œæœç´¢: "åä¸º"...
   âœ… æœç´¢å·²è§¦å‘

4ï¸âƒ£ é€€å‡ºåæ£€æŸ¥...
   URL: https://www.xiaohongshu.com/explore
   âš ï¸  URL æœªåŒ…å« search_resultï¼Œå¯èƒ½å¯¼èˆªå¤±è´¥

5ï¸âƒ£ éªŒè¯æœç´¢ç»“æœåˆ—è¡¨é”šç‚¹...
ğŸ” éªŒè¯é”šç‚¹: æœç´¢ç»“æœåˆ—è¡¨ (.feeds-container)
   âœ… æ‰¾åˆ°å…ƒç´ 
      Rect: x=266.7, y=144.0, w=1141.3, h=1885.0

ğŸ“‹ é‡‡é›†æœç´¢ç»“æœï¼ˆç›®æ ‡ï¼šè‡³å°‘ 5 æ¡ï¼‰...
   åŸå§‹æ•°é‡: 24
   å»é‡åæ•°é‡: 24
   âœ… å·²é‡‡é›†è¶³å¤Ÿç»“æœ

âœ… Phase 2 å®Œæˆ - æœç´¢åŠŸèƒ½æ­£å¸¸
```

### 2026-01-12 12:45 AMï¼šcore-daemon çŠ¶æ€æ£€æŸ¥
```bash
$ node scripts/core-daemon.mjs status
Service Status:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Service              Port     Status       PID        Health
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
unified-api          7701     healthy      -          âœ“ OK
browser-service      7704     healthy      -          âœ“ OK
search-gate          7790     healthy      -          âœ“ OK
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ All services are healthy
```

### 2026-01-12 12:43 AMï¼šBrowser Service ä¼šè¯æ£€æŸ¥
```bash
$ curl -s http://127.0.0.1:7704/command -X POST -d '{"action":"getStatus"}' | jq
{
  "ok": true,
  "sessions": [
    {
      "profileId": "xiaohongshu_fresh",
      "session_id": "xiaohongshu_fresh",
      "current_url": "https://www.xiaohongshu.com/explore",
      "mode": "dev"
    }
  ]
}
```

---

