# iFlow API Documentation

## Overview
心流开放平台 (iFlow Open Platform) API documentation for LLM model interactions.

## Base URL
```
https://platform.iflow.cn/api/v1/chat/completions
```

## Authentication
- **Method**: Bearer Token
- **Header**: `Authorization: Bearer <your-api-key>`

## Chat Completions API

### Endpoint
```
POST /api/v1/chat/completions
```

### Request Parameters

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `messages` | `object[]` | Yes | - | List of messages for the conversation |
| `messages.content` | `string` | Yes | - | Message content |
| `messages.role` | `enum<string>` | Yes | - | Message role: `user`, `assistant`, `system` |
| `model` | `enum<string>` | Yes | - | Model name |
| `frequency_penalty` | `number` | No | `0.5` | Frequency penalty for token generation |
| `max_tokens` | `integer` | No | `512` | Maximum tokens to generate (1 < x < 8192) |
| `n` | `integer` | No | `1` | Number of results to return |
| `response_format` | `object` | No | - | Response format object |
| `response_format.type` | `string` | No | - | Response format type |
| `stop` | `string[]` | No | - | Stop sequences |
| `stream` | `boolean` | No | `false` | Enable streaming response |
| `temperature` | `number` | No | `0.7` | Response randomness control |
| `tools` | `object[]` | No | - | List of tools the model may call |
| `tools.function` | `object` | No | - | Function object |
| `tools.function.name` | `string` | No | - | Function name to call |
| `tools.function.description` | `string` | No | - | Function description |
| `tools.function.parameters` | `object` | No | - | Function parameters as JSON Schema |
| `tools.function.strict` | `boolean` | No | `false` | Strict parameter validation |
| `tools.type` | `enum<string>` | No | `function` | Tool type (only `function` supported) |
| `top_k` | `number` | No | `50` | Top-k token selection |
| `top_p` | `number` | No | `0.7` | Top-p (nucleus) sampling |

### Supported Models
Based on the documentation, supported models include:
- `deepseek-r1`
- `qwen3-coder`
- `qwen3-coder-480b-a35b-instruct-mlx`
- `iflow-chat`
- `iflow-chat-pro`
- `iflow-chat-turbo`

### Response Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `choices` | `object[]` | Yes | List of generated choices |
| `choices.finish_reason` | `enum<string>` | No | Reason for generation end: `stop`, `eos`, `length`, `tool_calls` |
| `choices.message` | `object` | Yes | Message object returned by model |
| `created` | `integer` | Yes | Response timestamp |
| `id` | `string` | Yes | Unique response identifier |
| `model` | `string` | Yes | Model name used |
| `object` | `enum<string>` | Yes | Response type: `chat.completion` |
| `tool_calls` | `object[]` | No | Tool calls generated by model |
| `tool_calls.function` | `object` | No | Function called by model |
| `tool_calls.function.arguments` | `string` | No | Function arguments (JSON string) |
| `tool_calls.function.name` | `string` | No | Function name to call |
| `tool_calls.id` | `string` | No | Unique tool call identifier |
| `tool_calls.type` | `enum<string>` | No | Tool type: `function` |
| `usage` | `object` | Yes | Token usage statistics |
| `usage.completion_tokens` | `integer` | Yes | Tokens in completion |
| `usage.prompt_tokens` | `integer` | Yes | Tokens in prompt |
| `usage.total_tokens` | `integer` | Yes | Total tokens used |

### Tool Calling Support

iFlow supports function calling with the following characteristics:

1. **Tool Definition**: Tools are defined using OpenAI-compatible format
2. **Function Parameters**: Parameters are described using JSON Schema
3. **Strict Mode**: Optional strict parameter validation
4. **Multiple Tools**: Supports up to 128 functions in a single request
5. **Response Format**: Tool calls appear in both `choices.message.tool_calls` and top-level `tool_calls`

### Example Request

```bash
curl --request POST \
  --url https://platform.iflow.cn/api/v1/chat/completions \
  --header 'Authorization: Bearer <iflow-api-key>' \
  --header 'Content-Type: application/json' \
  --data '{
    "model": "qwen3-coder",
    "messages": [
      {
        "role": "user",
        "content": "List files in the current directory"
      }
    ],
    "stream": false,
    "max_tokens": 512,
    "temperature": 0.7,
    "tools": [
      {
        "type": "function",
        "function": {
          "name": "list_files",
          "description": "List files in a directory",
          "parameters": {
            "type": "object",
            "properties": {
              "directory": {
                "type": "string",
                "description": "Directory path to list files from"
              },
              "recursive": {
                "type": "boolean",
                "description": "Whether to list files recursively",
                "default": false
              }
            },
            "required": ["directory"]
          },
          "strict": false
        }
      }
    ]
  }'
```

### Example Response

```json
{
  "id": "<string>",
  "choices": [
    {
      "message": {
        "role": "assistant",
        "content": "<string>",
        "reasoning_content": "<string>"
      },
      "finish_reason": "tool_calls"
    }
  ],
  "tool_calls": [
    {
      "id": "<string>",
      "type": "function",
      "function": {
        "name": "list_files",
        "arguments": "{\"directory\": \".\", \"recursive\": false}"
      }
    }
  ],
  "usage": {
    "prompt_tokens": 123,
    "completion_tokens": 123,
    "total_tokens": 123
  },
  "created": 123,
  "model": "<string>",
  "object": "chat.completion"
}
```

### Key Features

1. **Full OpenAI Compatibility**: iFlow API is fully compatible with OpenAI's chat completions format
2. **Tool Calling**: Complete support for function/tool calling
3. **Streaming**: Server-sent events for streaming responses
4. **Multiple Models**: Various model options for different use cases
5. **Token Control**: Fine-grained control over generation parameters
6. **Usage Statistics**: Detailed token usage information

### Error Handling

The API returns standard HTTP status codes and error messages. Refer to the error codes documentation for detailed information.