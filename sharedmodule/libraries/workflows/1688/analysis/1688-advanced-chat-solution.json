{
  "name": "1688 Advanced Chat Solution",
  "description": "é«˜çº§1688èŠå¤©è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨JavaScriptæ³¨å…¥å’Œæ·±åº¦DOMæ‰«æ",
  "version": "1.0.0",
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "å¼€å§‹", "next": ["attach"] },
    { "id": "attach", "type": "AttachSessionNode", "name": "ä¼šè¯æ¥åŠ›", "config": {}, "next": ["navigate_search"] },
    {
      "id": "navigate_search",
      "type": "NavigationNode",
      "name": "å¯¼èˆªåˆ°æœç´¢é¡µé¢",
      "config": {
        "url": "https://s.1688.com/selloffer/offer_search.htm?keywords=%B9%A4%D2%B5%B4%F3%B7%E7%C9%C8&spm=a260k.home2025.searchbox.0",
        "waitUntil": "domcontentloaded",
        "timeout": 30000
      },
      "next": ["wait_search"]
    },
    { "id": "wait_search", "type": "WaitNode", "name": "æœç´¢é¡µé¢ç­‰å¾…", "config": { "minMs": 2000, "maxMs": 3000 }, "next": ["dismiss_modals"] },
    { "id": "dismiss_modals", "type": "ModalDismissNode", "name": "å…³é—­æœç´¢é¡µæ¨¡æ€", "config": { "maxAttempts": 4, "retryDelay": 500 }, "next": ["open_chat"] },
    {
      "id": "open_chat",
      "type": "PopupTokenCaptureNode",
      "name": "æ‰“å¼€èŠå¤©çª—å£",
      "config": {
        "containerSelector": ".space-pc-ui2024-content > div:nth-child(5)",
        "clickSelectors": ["a.ww-link.ww-inline", "span.J_WangWang a.ww-link", "a[href*=air.1688.com/app/]"],
        "hostFilter": "air.1688.com",
        "maxItems": 1,
        "minClickDelay": 500,
        "maxClickDelay": 1500,
        "afterPopupWaitMs": 3000,
        "closePopup": false,
        "popupClickSelectors": ["body > div:nth-child(23)"],
        "dryMode": false,
        "enforceWebPreference": true,
        "popupStepGate": false
      },
      "next": ["javascript_analysis"]
    },
    {
      "id": "javascript_analysis",
      "type": "ScriptTokenExtractorNode",
      "name": "JavaScriptæ·±åº¦åˆ†æ",
      "config": {
        "hostFilter": "air.1688.com",
        "scripts": [
          {
            "name": "Shadow DOMæ‰«æ",
            "code": "function scanShadowDOM() { const results = []; document.querySelectorAll('*').forEach(el => { if (el.shadowRoot) { const shadowContent = el.shadowRoot.innerHTML; results.push({ element: el.tagName, shadowContent: shadowContent }); } }); return results; } scanShadowDOM();"
          },
          {
            "name": "iframeå†…å®¹æ‰«æ",
            "code": "function scanIframes() { const results = []; document.querySelectorAll('iframe').forEach((frame, index) => { try { const doc = frame.contentDocument || frame.contentWindow.document; results.push({ index: index, content: doc.body.innerHTML, url: frame.src }); } catch(e) { results.push({ index: index, error: e.message, url: frame.src }); } }); return results; } scanIframes();"
          },
          {
            "name": "Reactç»„ä»¶æ‰«æ",
            "code": "function scanReactComponents() { const results = []; const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_ELEMENT); let node; while (node = walker.nextNode()) { const reactKey = Object.keys(node).find(key => key.startsWith('__react')); if (reactKey) { results.push({ element: node.tagName, className: node.className, reactKey: reactKey }); } } return results; } scanReactComponents();"
          },
          {
            "name": "äº‹ä»¶ç›‘å¬å™¨æ‰«æ",
            "code": "function scanEventListeners() { const results = []; document.querySelectorAll('*').forEach(el => { const events = ['onclick', 'oninput', 'onkeydown', 'onkeyup', 'onchange']; const activeEvents = events.filter(event => el[event]); if (activeEvents.length > 0) { results.push({ element: el.tagName, className: node.className, events: activeEvents }); } }); return results; } scanEventListeners();"
          },
          {
            "name": "è‡ªå®šä¹‰å±æ€§æ‰«æ",
            "code": "function scanCustomAttributes() { const results = []; document.querySelectorAll('*').forEach(el => { const attrs = {}; for (let attr of el.attributes) { if (attr.name.startsWith('data-') || attr.name.includes('-') || attr.name.includes('_')) { attrs[attr.name] = attr.value; } } if (Object.keys(attrs).length > 0) { results.push({ element: el.tagName, className: el.className, attributes: attrs }); } }); return results; } scanCustomAttributes();"
          }
        ],
        "saveResults": true,
        "outputDir": "archive/workflow-records"
      },
      "next": ["advanced_input_test"]
    },
    {
      "id": "advanced_input_test",
      "type": "ScriptTokenExtractorNode",
      "name": "é«˜çº§è¾“å…¥æµ‹è¯•",
      "config": {
        "hostFilter": "air.1688.com",
        "scripts": [
          {
            "name": "æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥",
            "code": "function simulateInput() { const event = new KeyboardEvent('keydown', { key: 'H', code: 'KeyH', keyCode: 72, which: 72, bubbles: true }); document.body.dispatchEvent(event); document.body.dispatchEvent(new KeyboardEvent('keyup', { key: 'H', bubbles: true })); return 'æ¨¡æ‹Ÿè¾“å…¥Hé”®'; } simulateInput();"
          },
          {
            "name": "æŸ¥æ‰¾å¯ç¼–è¾‘åŒºåŸŸ",
            "code": "function findEditableAreas() { const results = []; const testText = 'TEST_INPUT'; document.querySelectorAll('*').forEach(el => { try { el.focus(); el.click(); if (el.selectionStart !== undefined || el.isContentEditable || el.contentEditable === 'true') { el.value = testText; el.textContent = testText; results.push({ element: el.tagName, className: el.className, id: el.id, success: true }); } } catch(e) { results.push({ element: el.tagName, className: el.className, error: e.message }); } }); return results; } findEditableAreas();"
          },
          {
            "name": "å…¨å±€è¾“å…¥äº‹ä»¶ç›‘å¬",
            "code": "function setupInputListener() { let inputDetected = false; document.addEventListener('input', (e) => { inputDetected = true; console.log('è¾“å…¥äº‹ä»¶æ£€æµ‹:', e.target); }); document.addEventListener('keydown', (e) => { console.log('é”®ç›˜äº‹ä»¶:', e.key, e.target); }); setTimeout(() => { return inputDetected ? 'æ£€æµ‹åˆ°è¾“å…¥äº‹ä»¶' : 'æœªæ£€æµ‹åˆ°è¾“å…¥äº‹ä»¶'; }, 2000); } setupInputListener();"
          }
        ],
        "interactionDelay": 2000,
        "saveResults": true
      },
      "next": ["manual_chat_test"]
    },
    {
      "id": "manual_chat_test",
      "type": "GateOverlayNode",
      "name": "æ‰‹åŠ¨èŠå¤©æµ‹è¯•",
      "config": {
        "hostFilter": "air.1688.com",
        "title": "ğŸ¯ é«˜çº§èŠå¤©åˆ†æå®Œæˆ",
        "message": "å·²å®ŒæˆJavaScriptæ·±åº¦åˆ†æï¼Œç°åœ¨è¯·æ‰‹åŠ¨æµ‹è¯•ï¼š\\n\\nğŸ“‹ åˆ†æç»“æœï¼š\\nâœ… Shadow DOMæ‰«æå®Œæˆ\\nâœ… iframeå†…å®¹æ‰«æå®Œæˆ\\nâœ… Reactç»„ä»¶è¯†åˆ«å®Œæˆ\\nâœ… äº‹ä»¶ç›‘å¬å™¨æ˜ å°„å®Œæˆ\\nâœ… è‡ªå®šä¹‰å±æ€§æ‰«æå®Œæˆ\\n\\nğŸ”§ æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤ï¼š\\n1. åœ¨èŠå¤©ç•Œé¢å°è¯•è¾“å…¥æ–‡å­—\\n2. è§‚å¯Ÿæ˜¯å¦æœ‰ä»»ä½•ååº”\\n3. æŒ‰F12æŸ¥çœ‹Consoleä¸­çš„äº‹ä»¶æ—¥å¿—\\n4. æ£€æŸ¥æ˜¯å¦æœ‰éšè—çš„è¾“å…¥ç»„ä»¶è¢«æ¿€æ´»\\n\\nğŸ’¡ å¦‚æœæ‰¾åˆ°è¾“å…¥æ–¹æ³•ï¼Œè¯·è®°å½•å…·ä½“æ­¥éª¤å’Œå…ƒç´ ä¿¡æ¯ã€‚\\n\\nç‚¹å‡»'ä¸‹ä¸€æ­¥'ä¿å­˜åˆ†æç»“æœ",
        "stepGate": true,
        "block": true
      },
      "next": ["create_solution"]
    },
    {
      "id": "create_solution",
      "type": "ScriptTokenExtractorNode",
      "name": "ç”Ÿæˆè§£å†³æ–¹æ¡ˆ",
      "config": {
        "hostFilter": "air.1688.com",
        "scripts": [
          {
            "name": "ç”ŸæˆChatComposeNodeé…ç½®",
            "code": "function generateSolution() { const solution = { problem: '1688ä½¿ç”¨éæ ‡å‡†èŠå¤©ç•Œé¢', solution: 'éœ€è¦JavaScriptæ³¨å…¥å’Œè™šæ‹Ÿäº‹ä»¶å¤„ç†', selectors: { inputSelectors: ['body', '[contenteditable]', '*'], sendSelectors: ['body', '*'] }, methods: ['simulate-keyboard-events', 'dispatch-input-events', 'react-props-injection'] }; return solution; } generateSolution();"
          }
        ],
        "saveResults": true
      },
      "next": ["save_solution"]
    },
    {
      "id": "save_solution",
      "type": "ResultSaverNode",
      "name": "ä¿å­˜è§£å†³æ–¹æ¡ˆ",
      "config": {
        "outputDir": "archive/workflow-records",
        "filenameTemplate": "1688-advanced-chat-solution-{timestamp}.json",
        "includeMetadata": true
      },
      "next": ["end"]
    },
    {
      "id": "end",
      "type": "EndNode",
      "name": "ç»“æŸ",
      "config": { "cleanup": false, "saveLogs": true }
    }
  ],
  "globalConfig": {
    "logLevel": "info",
    "screenshotOnError": true,
    "autoCleanup": false,
    "parallelExecution": false,
    "timeout": 900000
  }
}