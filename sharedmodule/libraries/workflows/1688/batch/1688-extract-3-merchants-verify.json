{
  "name": "1688æå–3ä¸ªå•†å®¶å¹¶é€ä¸€éªŒè¯",
  "description": "æå–3ä¸ªå•†å®¶ä¿¡æ¯ï¼Œç„¶åé€ä¸€æ‰“å¼€èŠå¤©é¡µé¢éªŒè¯å‡†ç¡®æ€§",
  "version": "1.0.0",
  "preflows": ["1688-login-preflow"],
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "å¼€å§‹", "next": ["attach"] },
    {
      "id": "attach",
      "type": "AttachSessionNode",
      "name": "ä¼šè¯æ¥åŠ›",
      "config": {},
      "next": ["navigate_search"]
    },
    {
      "id": "navigate_search",
      "type": "NavigationNode",
      "name": "å¯¼èˆªåˆ°æœç´¢ç»“æœé¡µ",
      "config": {
        "url": "https://s.1688.com/selloffer/offer_search.htm?keywords=%B7%FE%D7%B0",
        "waitUntil": "domcontentloaded",
        "timeout": 30000
      },
      "next": ["wait_search"]
    },
    {
      "id": "wait_search",
      "type": "WaitNode",
      "name": "ç­‰å¾…æœç´¢ç»“æœå®Œå…¨åŠ è½½",
      "config": { "minMs": 3000, "maxMs": 5000 },
      "next": ["extract_3_merchants"]
    },
    {
      "id": "extract_3_merchants",
      "type": "PageSnapshotNode",
      "name": "æå–å‰3ä¸ªå•†å®¶è¯¦ç»†ä¿¡æ¯",
      "config": {
        "script": "console.log('ğŸ” å¼€å§‹æå–å‰3ä¸ªå•†å®¶è¯¦ç»†ä¿¡æ¯...'); const merchants = []; const offerItems = document.querySelectorAll('.sm-offer-item, .offer-item, .sm-offer, [class*=offer]'); console.log(`æ‰¾åˆ° ${offerItems.length} ä¸ªå•†å®¶å®¹å™¨ï¼Œæå–å‰3ä¸ª`); for (let i = 0; i < Math.min(3, offerItems.length); i++) { const item = offerItems[i]; console.log(`\\n=== æå–å•†å®¶ ${i + 1} ===`); // æå–å•†å®¶åŸºæœ¬ä¿¡æ¯ const title = item.querySelector('h4, [class*=title], a[title]'); const link = item.querySelector('a[href*=\"1688.com\"]'); const price = item.querySelector('[class*=price], [data-price]'); const image = item.querySelector('img[src]'); const merchantName = item.querySelector('[class*=company], [class*=name], [class*=shop]'); const merchantLink = link ? link.href : null; // æå–æ—ºæ—ºè”ç³»æ–¹å¼ const wangwangSpan = item.querySelector('span.J_WangWang'); const wangwangLink = wangwangSpan ? wangwangSpan.querySelector('a.ww-link') : null; const wangwangText = wangwangSpan ? wangwangSpan.textContent.trim() : ''; // æå–å•†å®¶ID let merchantId = null; if (merchantLink) { const idMatch = merchantLink.match(/member_id=([\\\\d]+)/); if (idMatch) merchantId = idMatch[1]; else { const pathMatch = merchantLink.match(/\\\\/(\\\\d+)\\\\.htm/); if (pathMatch) merchantId = pathMatch[1]; } } // æå–æ—ºæ—ºèŠå¤©é“¾æ¥ let chatUrl = null; if (wangwangLink && wangwangLink.href) { chatUrl = wangwangLink.href; // è§£ç URLä¸­çš„å•†å®¶åç§° const urlParams = new URLSearchParams(chatUrl.split('?')[1]); const uid = urlParams.get('uid'); if (uid) { console.log(`  URLä¸­çš„å•†å®¶åç§°: ${decodeURIComponent(uid)}`); } } // è®°å½•è¯¦ç»†ä¿¡æ¯ console.log(`  æ ‡é¢˜: ${title ? title.textContent.trim() : 'æœªæ‰¾åˆ°'}`); console.log(`  å•†å®¶åç§°: ${merchantName ? merchantName.textContent.trim() : 'æœªæ‰¾åˆ°'}`); console.log(`  ä»·æ ¼: ${price ? price.textContent.trim() : 'æœªæ‰¾åˆ°'}`); console.log(`  å•†å®¶ID: ${merchantId}`); console.log(`  å•†å®¶é“¾æ¥: ${merchantLink}`); console.log(`  æ—ºæ—ºæ–‡æœ¬: ${wangwangText}`); console.log(`  æ—ºæ—ºèŠå¤©é“¾æ¥: ${chatUrl}`); console.log(`  æœ‰å›¾ç‰‡: ${!!image}`); // æ„å»ºå•†å®¶æ•°æ® const merchantData = { index: i + 1, merchantId: merchantId, title: title ? title.textContent.trim() : '', merchantName: merchantName ? merchantName.textContent.trim() : '', price: price ? price.textContent.trim() : '', merchantLink: merchantLink, chatUrl: chatUrl, wangwangText: wangwangText, hasImage: !!image, imageUrl: image ? image.src : null, wangwangData: wangwangSpan ? { className: wangwangSpan.className, dataNick: wangwangSpan.getAttribute('data-nick'), dataIcon: wangwangSpan.getAttribute('data-icon'), dataEncode: wangwangSpan.getAttribute('data-encode') } : null }; merchants.push(merchantData); console.log(`  âœ… å•†å®¶ ${i + 1} æå–å®Œæˆ`); } console.log(`\\nğŸ“Š æ€»å…±æå–äº† ${merchants.length} ä¸ªå•†å®¶`); return { success: true, merchants: merchants, totalFound: offerItems.length, extractedCount: merchants.length, timestamp: new Date().toISOString() };",
        "saveScreenshots": true
      },
      "next": ["save_merchant_data"]
    },
    {
      "id": "save_merchant_data",
      "type": "ResultSaverNode",
      "name": "ä¿å­˜å•†å®¶æ•°æ®",
      "config": {
        "outputDir": "archive/workflow-records",
        "filenameTemplate": "1688-extracted-merchants-{timestamp}.json",
        "includeMetadata": true
      },
      "next": ["verify_first_merchant"]
    },
    {
      "id": "verify_first_merchant",
      "type": "NavigationNode",
      "name": "éªŒè¯ç¬¬1ä¸ªå•†å®¶èŠå¤©é¡µé¢",
      "config": {
        "url": "{{merchants[0].chatUrl || merchants[0].merchantLink}}",
        "waitUntil": "domcontentloaded",
        "timeout": 20000
      },
      "next": ["wait_first_chat"]
    },
    {
      "id": "wait_first_chat",
      "type": "WaitNode",
      "name": "ç­‰å¾…ç¬¬1ä¸ªèŠå¤©é¡µé¢åŠ è½½",
      "config": { "minMs": 3000, "maxMs": 5000 },
      "next": ["verify_first_chat"]
    },
    {
      "id": "verify_first_chat",
      "type": "PageSnapshotNode",
      "name": "éªŒè¯ç¬¬1ä¸ªèŠå¤©é¡µé¢ä¿¡æ¯",
      "config": {
        "script": "console.log('ğŸ” éªŒè¯ç¬¬1ä¸ªå•†å®¶èŠå¤©é¡µé¢...'); const currentUrl = window.location.href; const pageTitle = document.title; const isInChat = currentUrl.includes('air.1688.com') || currentUrl.includes('def_cbu_web_im'); console.log(`å½“å‰URL: ${currentUrl}`); console.log(`é¡µé¢æ ‡é¢˜: ${pageTitle}`); console.log(`æ˜¯å¦åœ¨èŠå¤©é¡µé¢: ${isInChat}`); // æ£€æŸ¥èŠå¤©ç•Œé¢å…ƒç´  const chatInterface = document.querySelector('textarea, input[type=\"text\"], [contenteditable], .chat-input, .message-input'); const sendButton = document.querySelector('button[type=\"submit\"], [class*=\"send\"], [class*=\"send-btn\"]'); console.log(`æ‰¾åˆ°èŠå¤©è¾“å…¥æ¡†: ${!!chatInterface}`); console.log(`æ‰¾åˆ°å‘é€æŒ‰é’®: ${!!sendButton}`); // æå–å½“å‰é¡µé¢çš„å•†å®¶ä¿¡æ¯ const merchantInfo = { currentUrl: currentUrl, pageTitle: pageTitle, isInChat: isInChat, hasChatInterface: !!chatInterface, hasSendButton: !!sendButton, timestamp: new Date().toISOString() }; return { success: isInChat, verification: merchantInfo, merchantIndex: 1, timestamp: new Date().toISOString() };",
        "saveScreenshots": true
      },
      "next": ["back_to_search"]
    },
    {
      "id": "back_to_search",
      "type": "NavigationNode",
      "name": "è¿”å›æœç´¢é¡µé¢",
      "config": {
        "url": "https://s.1688.com/selloffer/offer_search.htm?keywords=%B7%FE%D7%B0",
        "waitUntil": "domcontentloaded",
        "timeout": 15000
      },
      "next": ["verify_second_merchant"]
    },
    {
      "id": "verify_second_merchant",
      "type": "NavigationNode",
      "name": "éªŒè¯ç¬¬2ä¸ªå•†å®¶èŠå¤©é¡µé¢",
      "config": {
        "url": "{{merchants[1].chatUrl || merchants[1].merchantLink}}",
        "waitUntil": "domcontentloaded",
        "timeout": 20000
      },
      "next": ["wait_second_chat"]
    },
    {
      "id": "wait_second_chat",
      "type": "WaitNode",
      "name": "ç­‰å¾…ç¬¬2ä¸ªèŠå¤©é¡µé¢åŠ è½½",
      "config": { "minMs": 3000, "maxMs": 5000 },
      "next": ["verify_second_chat"]
    },
    {
      "id": "verify_second_chat",
      "type": "PageSnapshotNode",
      "name": "éªŒè¯ç¬¬2ä¸ªèŠå¤©é¡µé¢ä¿¡æ¯",
      "config": {
        "script": "console.log('ğŸ” éªŒè¯ç¬¬2ä¸ªå•†å®¶èŠå¤©é¡µé¢...'); const currentUrl = window.location.href; const pageTitle = document.title; const isInChat = currentUrl.includes('air.1688.com') || currentUrl.includes('def_cbu_web_im'); console.log(`å½“å‰URL: ${currentUrl}`); console.log(`é¡µé¢æ ‡é¢˜: ${pageTitle}`); console.log(`æ˜¯å¦åœ¨èŠå¤©é¡µé¢: ${isInChat}`); const merchantInfo = { currentUrl: currentUrl, pageTitle: pageTitle, isInChat: isInChat, timestamp: new Date().toISOString() }; return { success: isInChat, verification: merchantInfo, merchantIndex: 2, timestamp: new Date().toISOString() };",
        "saveScreenshots": true
      },
      "next": ["back_to_search_2"]
    },
    {
      "id": "back_to_search_2",
      "type": "NavigationNode",
      "name": "è¿”å›æœç´¢é¡µé¢",
      "config": {
        "url": "https://s.1688.com/selloffer/offer_search.htm?keywords=%B7%FE%D7%B0",
        "waitUntil": "domcontentloaded",
        "timeout": 15000
      },
      "next": ["verify_third_merchant"]
    },
    {
      "id": "verify_third_merchant",
      "type": "NavigationNode",
      "name": "éªŒè¯ç¬¬3ä¸ªå•†å®¶èŠå¤©é¡µé¢",
      "config": {
        "url": "{{merchants[2].chatUrl || merchants[2].merchantLink}}",
        "waitUntil": "domcontentloaded",
        "timeout": 20000
      },
      "next": ["wait_third_chat"]
    },
    {
      "id": "wait_third_chat",
      "type": "WaitNode",
      "name": "ç­‰å¾…ç¬¬3ä¸ªèŠå¤©é¡µé¢åŠ è½½",
      "config": { "minMs": 3000, "maxMs": 5000 },
      "next": ["verify_third_chat"]
    },
    {
      "id": "verify_third_chat",
      "type": "PageSnapshotNode",
      "name": "éªŒè¯ç¬¬3ä¸ªèŠå¤©é¡µé¢ä¿¡æ¯",
      "config": {
        "script": "console.log('ğŸ” éªŒè¯ç¬¬3ä¸ªå•†å®¶èŠå¤©é¡µé¢...'); const currentUrl = window.location.href; const pageTitle = document.title; const isInChat = currentUrl.includes('air.1688.com') || currentUrl.includes('def_cbu_web_im'); console.log(`å½“å‰URL: ${currentUrl}`); console.log(`é¡µé¢æ ‡é¢˜: ${pageTitle}`); console.log(`æ˜¯å¦åœ¨èŠå¤©é¡µé¢: ${isInChat}`); const merchantInfo = { currentUrl: currentUrl, pageTitle: pageTitle, isInChat: isInChat, timestamp: new Date().toISOString() }; return { success: isInChat, verification: merchantInfo, merchantIndex: 3, timestamp: new Date().toISOString() };",
        "saveScreenshots": true
      },
      "next": ["save_verification_results"]
    },
    {
      "id": "save_verification_results",
      "type": "ResultSaverNode",
      "name": "ä¿å­˜éªŒè¯ç»“æœ",
      "config": {
        "outputDir": "archive/workflow-records",
        "filenameTemplate": "1688-merchant-verification-{timestamp}.json",
        "includeMetadata": true
      },
      "next": ["end"]
    },
    {
      "id": "end",
      "type": "EndNode",
      "name": "ç»“æŸéªŒè¯",
      "config": { "cleanup": false, "saveLogs": true }
    }
  ],
  "globalConfig": {
    "logLevel": "info",
    "screenshotOnError": true,
    "autoCleanup": false,
    "parallelExecution": false,
    "timeout": 600000
  }
}