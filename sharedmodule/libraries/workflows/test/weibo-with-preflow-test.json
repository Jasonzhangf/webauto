{
  "name": "å¾®åšå¸¦é¢„ç™»å½•æµç¨‹çš„æœç´¢æµ‹è¯•",
  "description": "ä½¿ç”¨é¢„ç™»å½•æµç¨‹å¤„ç†å¾®åšåçˆ¬è™«ï¼Œç„¶åæœç´¢å¤§æ¨¡å‹å¹¶ç‚¹å‡»ç»“æœ",
  "version": "1.0.0",
  "preflows": ["workflows/preflows/weibo-login-preflow.json"],
  "nodes": [
    { "id": "start", "type": "StartNode", "name": "å¼€å§‹", "next": ["check_login_status"] },
    {
      "id": "check_login_status",
      "type": "JavaScriptExecutionNode",
      "name": "æ£€æŸ¥ç™»å½•çŠ¶æ€",
      "config": {
        "script": "console.log('ğŸ” æ£€æŸ¥å¾®åšç™»å½•çŠ¶æ€...');\n\n// æ£€æŸ¥æ˜¯å¦å·²ç»ç™»å½•\nconst userInfo = document.querySelector('.gn_name') || document.querySelector('.name') || document.querySelector('.S_txt1');\nconst loginButton = document.querySelector('.gn_login') || document.querySelector('.login-btn') || document.querySelector('a[href*=\"login\"]');\n\nif (userInfo) {\n  console.log('âœ… ç”¨æˆ·å·²ç™»å½•:', userInfo.textContent.trim());\n  return {\n    success: true,\n    isLoggedIn: true,\n    userInfo: userInfo.textContent.trim(),\n    action: 'already_logged_in',\n    pageUrl: window.location.href,\n    timestamp: new Date().toISOString()\n  };\n} else if (loginButton) {\n  console.log('âš ï¸ ç”¨æˆ·æœªç™»å½•ï¼Œéœ€è¦ç™»å½•');\n  return {\n    success: true,\n    isLoggedIn: false,\n    loginButtonSelector: '.gn_login, .login-btn, a[href*=\"login\"]',\n    action: 'need_login',\n    pageUrl: window.location.href,\n    timestamp: new Date().toISOString()\n  };\n} else {\n  console.log('â³ é¡µé¢ä»åœ¨åŠ è½½ä¸­...');\n  return {\n    success: false,\n    error: 'é¡µé¢æœªå®Œå…¨åŠ è½½ï¼Œæ— æ³•æ£€æµ‹ç™»å½•çŠ¶æ€',\n    action: 'page_loading',\n    pageUrl: window.location.href,\n    timestamp: new Date().toISOString()\n  };\n}",
        "saveScreenshots": true
      },
      "next": ["decide_next_action"]
    },
    {
      "id": "decide_next_action",
      "type": "ConditionalNode",
      "name": "æ ¹æ®ç™»å½•çŠ¶æ€å†³å®šä¸‹ä¸€æ­¥",
      "config": {
        "condition": "previous.isLoggedIn === true",
        "trueBranch": "navigate_search",
        "falseBranch": "perform_login"
      }
    },
    {
      "id": "perform_login",
      "type": "JavaScriptExecutionNode",
      "name": "æ‰§è¡Œç™»å½•æ“ä½œ",
      "config": {
        "script": "console.log('ğŸ” å¼€å§‹ç™»å½•æµç¨‹...');\n\n// æŸ¥æ‰¾ç™»å½•æŒ‰é’®å¹¶ç‚¹å‡»\nconst loginSelectors = [\n  '.gn_login',\n  '.login-btn',\n  'a[href*=\"login\"]',\n  '.S_txt1',\n  'a[onclick*=\"login\"]'\n];\n\nlet loginButton = null;\nfor (const selector of loginSelectors) {\n  loginButton = document.querySelector(selector);\n  if (loginButton) {\n    console.log(`âœ… æ‰¾åˆ°ç™»å½•æŒ‰é’®: ${selector}`);\n    break;\n  }\n}\n\nif (loginButton) {\n  // é«˜äº®æ˜¾ç¤ºç™»å½•æŒ‰é’®\n  const originalStyle = loginButton.style.cssText;\n  loginButton.style.border = '3px solid red';\n  loginButton.style.backgroundColor = 'yellow';\n  loginButton.style.boxShadow = '0 0 10px rgba(255,0,0,0.5)';\n  \n  setTimeout(() => {\n    loginButton.style.cssText = originalStyle;\n  }, 2000);\n  \n  // ç‚¹å‡»ç™»å½•æŒ‰é’®\n  loginButton.click();\n  \n  return {\n    success: true,\n    action: 'login_button_clicked',\n    selector: loginSelectors.find(s => document.querySelector(s)),\n    message: 'å·²ç‚¹å‡»ç™»å½•æŒ‰é’®ï¼Œè¯·åœ¨å¼¹å‡ºçª—å£ä¸­å®Œæˆç™»å½•',\n    timestamp: new Date().toISOString()\n  };\n} else {\n  return {\n    success: false,\n    error: 'æœªæ‰¾åˆ°ç™»å½•æŒ‰é’®ï¼Œé¡µé¢å¯èƒ½å·²ç»å‘ç”Ÿå˜åŒ–',\n    availableSelectors: loginSelectors,\n    timestamp: new Date().toISOString()\n  };\n}",
        "saveScreenshots": true
      },
      "next": ["wait_for_login"]
    },
    {
      "id": "wait_for_login",
      "type": "WaitNode",
      "name": "ç­‰å¾…ç™»å½•å®Œæˆ",
      "config": { "minMs": 10000, "maxMs": 15000 },
      "next": ["check_login_result"]
    },
    {
      "id": "check_login_result",
      "type": "JavaScriptExecutionNode",
      "name": "æ£€æŸ¥ç™»å½•ç»“æœ",
      "config": {
        "script": "console.log('ğŸ” æ£€æŸ¥ç™»å½•ç»“æœ...');\n\n// å†æ¬¡æ£€æŸ¥ç™»å½•çŠ¶æ€\nconst userInfo = document.querySelector('.gn_name') || document.querySelector('.name') || document.querySelector('.S_txt1');\n\nif (userInfo) {\n  console.log('âœ… ç™»å½•æˆåŠŸ:', userInfo.textContent.trim());\n  return {\n    success: true,\n    isLoggedIn: true,\n    userInfo: userInfo.textContent.trim(),\n    action: 'login_success',\n    pageUrl: window.location.href,\n    timestamp: new Date().toISOString()\n  };\n} else {\n  return {\n    success: false,\n    error: 'ç™»å½•å¤±è´¥æˆ–æœªå®Œæˆï¼Œè¯·æ‰‹åŠ¨å®Œæˆç™»å½•',\n    action: 'login_failed',\n    pageUrl: window.location.href,\n    timestamp: new Date().toISOString()\n  };\n}",
        "saveScreenshots": true
      },
      "next": ["navigate_search"]
    },
    {
      "id": "navigate_search",
      "type": "JavaScriptExecutionNode",
      "name": "å¯¼èˆªåˆ°æœç´¢åŠŸèƒ½",
      "config": {
        "script": "console.log('ğŸ” å‡†å¤‡æœç´¢åŠŸèƒ½...');\n\n// æŸ¥æ‰¾æœç´¢æ¡†\nconst searchInput = document.querySelector('#searchInput') || \n                      document.querySelector('.search-input') || \n                      document.querySelector('[placeholder*=\"æœç´¢\"]') ||\n                      document.querySelector('input[type=\"search\"]') ||\n                      document.querySelector('.gn_search');\n\nif (searchInput) {\n  console.log('âœ… æ‰¾åˆ°æœç´¢æ¡†');\n  \n  // é«˜äº®æœç´¢æ¡†\n  const originalStyle = searchInput.style.cssText;\n  searchInput.style.border = '3px solid red';\n  searchInput.style.backgroundColor = 'yellow';\n  \n  setTimeout(() => {\n    searchInput.style.cssText = originalStyle;\n  }, 2000);\n  \n  return {\n    success: true,\n    action: 'search_input_found',\n    selector: '#searchInput, .search-input, [placeholder*=\"æœç´¢\"], input[type=\"search\"], .gn_search',\n    searchInputPlaceholder: searchInput.placeholder || 'æœç´¢æ¡†',\n    timestamp: new Date().toISOString()\n  };\n} else {\n  // å°è¯•ç‚¹å‡»æœç´¢å›¾æ ‡æˆ–æœç´¢æŒ‰é’®\n  const searchIcon = document.querySelector('.gn_search') || document.querySelector('.search-icon') || \n                  document.querySelector('a[href*=\"search\"]');\n  \n  if (searchIcon) {\n    console.log('ğŸ” æ‰¾åˆ°æœç´¢å›¾æ ‡ï¼Œå‡†å¤‡ç‚¹å‡»');\n    searchIcon.click();\n    \n    return {\n      success: true,\n      action: 'search_icon_clicked',\n      message: 'å·²ç‚¹å‡»æœç´¢å›¾æ ‡ï¼Œç­‰å¾…æœç´¢æ¡†å‡ºç°',\n      timestamp: new Date().toISOString()\n    };\n  }\n  \n  return {\n    success: false,\n    error: 'æœªæ‰¾åˆ°æœç´¢è¾“å…¥æ¡†æˆ–æœç´¢æŒ‰é’®',\n    pageContent: document.title,\n    timestamp: new Date().toISOString()\n  };\n}",
        "saveScreenshots": true
      },
      "next": ["input_search_keyword"]
    },
    {
      "id": "input_search_keyword",
      "type": "AdvancedClickNode",
      "name": "ç‚¹å‡»æœç´¢æ¡†",
      "config": {
        "selector": "{{previous.selector}}",
        "strategy": "auto",
        "clickMethods": ["playwright_click", "javascript_click"],
        "maxRetries": 2,
        "retryDelay": 800,
        "waitAfter": 1000,
        "timeout": 8000,
        "verifyVisibility": true,
        "scrollIntoView": true,
        "highlight": true,
        "highlightDuration": 1500,
        "saveDebugInfo": true,
        "takeScreenshots": true,
        "logLevel": "info"
      },
      "next": ["type_keyword"]
    },
    {
      "id": "type_keyword",
      "type": "JavaScriptExecutionNode",
      "name": "è¾“å…¥æœç´¢å…³é”®è¯",
      "config": {
        "script": "console.log('ğŸ”¤ è¾“å…¥æœç´¢å…³é”®è¯ï¼šå¤§æ¨¡å‹');\n\n// è·å–æœç´¢æ¡†\nconst searchSelectors = [\n  '#searchInput',\n  '.search-input',\n  '[placeholder*=\"æœç´¢\"]',\n  'input[type=\"search\"]',\n  '.gn_search input'\n];\n\nlet searchInput = null;\nfor (const selector of searchSelectors) {\n  searchInput = document.querySelector(selector);\n  if (searchInput) {\n    console.log(`âœ… æ‰¾åˆ°æœç´¢æ¡†: ${selector}`);\n    break;\n  }\n}\n\nif (searchInput) {\n  // æ¸…ç©ºæœç´¢æ¡†å¹¶è¾“å…¥å…³é”®è¯\n  searchInput.value = '';\n  searchInput.focus();\n  \n  // æ¨¡æ‹Ÿè¾“å…¥\n  const keyword = 'å¤§æ¨¡å‹';\n  searchInput.value = keyword;\n  \n  // è§¦å‘è¾“å…¥äº‹ä»¶\n  searchInput.dispatchEvent(new Event('input', { bubbles: true }));\n  searchInput.dispatchEvent(new Event('change', { bubbles: true }));\n  \n  console.log(`âœ… å·²è¾“å…¥æœç´¢å…³é”®è¯: ${keyword}`);\n  \n  // é«˜äº®æœç´¢æ¡†\n  const originalStyle = searchInput.style.cssText;\n  searchInput.style.border = '3px solid green';\n  searchInput.style.backgroundColor = 'lightgreen';\n  \n  setTimeout(() => {\n    searchInput.style.cssText = originalStyle;\n  }, 2000);\n  \n  return {\n    success: true,\n    action: 'keyword_entered',\n    keyword: keyword,\n    searchValue: searchInput.value,\n    timestamp: new Date().toISOString()\n  };\n} else {\n  return {\n    success: false,\n    error: 'æœªæ‰¾åˆ°æœç´¢è¾“å…¥æ¡†',\n    searchedSelectors: searchSelectors,\n    timestamp: new Date().toISOString()\n  };\n}",
        "saveScreenshots": true
      },
      "next": ["click_search_button"]
    },
    {
      "id": "click_search_button",
      "type": "AdvancedClickNode",
      "name": "ç‚¹å‡»æœç´¢æŒ‰é’®",
      "config": {
        "selector": "#searchBtn, .search-btn, [type='submit'], .gn_search_btn, button[title*='æœç´¢']",
        "strategy": "auto",
        "clickMethods": ["playwright_click", "javascript_click", "mouse_coordinates"],
        "maxRetries": 2,
        "retryDelay": 800,
        "waitAfter": 3000,
        "timeout": 10000,
        "verifyVisibility": true,
        "scrollIntoView": true,
        "highlight": true,
        "highlightDuration": 1500,
        "verifyNavigation": true,
        "expectedUrlPattern": ".*weibo.*search.*",
        "saveDebugInfo": true,
        "takeScreenshots": true,
        "logLevel": "info"
      },
      "next": ["wait_for_results"]
    },
    {
      "id": "wait_for_results",
      "type": "WaitNode",
      "name": "ç­‰å¾…æœç´¢ç»“æœåŠ è½½",
      "config": { "minMs": 3000, "maxMs": 5000 },
      "next": ["find_results"]
    },
    {
      "id": "find_results",
      "type": "JavaScriptExecutionNode",
      "name": "æŸ¥æ‰¾æœç´¢ç»“æœ",
      "config": {
        "script": "console.log('ğŸ” æŸ¥æ‰¾æœç´¢ç»“æœ...');\n\n// æŸ¥æ‰¾æœç´¢ç»“æœçš„é€‰æ‹©å™¨\nconst resultSelectors = [\n  '.card-wrap .content',\n  '.content',\n  '.feed_content',\n  '.card',\n  '[data-feed-id]',\n  '.WB_feed .WB_detail',\n  '.WB_feed',\n  '.feed_1st'\n];\n\nlet searchResults = [];\n\nfor (const selector of resultSelectors) {\n  const elements = document.querySelectorAll(selector);\n  console.log(`å°è¯•é€‰æ‹©å™¨ ${selector}: æ‰¾åˆ° ${elements.length} ä¸ªå…ƒç´ `);\n  \n  if (elements.length > 0) {\n    for (let i = 0; i < Math.min(3, elements.length); i++) {\n      const element = elements[i];\n      const isVisible = element.offsetParent !== null;\n      const text = element.textContent?.trim() || '';\n      \n      if (isVisible && text.length > 10) {\n        const link = element.querySelector('a') || element.closest('a');\n        const href = link ? link.href : 'æ— é“¾æ¥';\n        \n        searchResults.push({\n          index: i + 1,\n          selector: selector,\n          text: text.substring(0, 100),\n          href: href,\n          isVisible: true\n        });\n        \n        console.log(`âœ… æ‰¾åˆ°ç¬¬ ${i + 1} æ¡ç»“æœ: ${text.substring(0, 50)}`);\n        \n        if (searchResults.length >= 3) break;\n      }\n    }\n    \n    if (searchResults.length >= 3) break;\n  }\n}\n\nif (searchResults.length > 0) {\n  console.log(`ğŸ¯ æˆåŠŸæ‰¾åˆ° ${searchResults.length} æ¡æœç´¢ç»“æœ`);\n  \n  return {\n    success: true,\n    action: 'search_results_found',\n    resultsCount: searchResults.length,\n    results: searchResults,\n    pageUrl: window.location.href,\n    pageTitle: document.title,\n    timestamp: new Date().toISOString()\n  };\n} else {\n  return {\n    success: false,\n    error: 'æœªæ‰¾åˆ°æœç´¢ç»“æœ',\n    pageUrl: window.location.href,\n    pageTitle: document.title,\n    triedSelectors: resultSelectors,\n    timestamp: new Date().toISOString()\n  };\n}",
        "saveScreenshots": true
      },
      "next": ["click_first_result"]
    },
    {
      "id": "click_first_result",
      "type": "AdvancedClickNode",
      "name": "ç‚¹å‡»ç¬¬ä¸€æ¡ç»“æœ",
      "config": {
        "selector": "{{previous.results[0].selector}}",
        "strategy": "auto",
        "clickMethods": ["playwright_click", "javascript_click"],
        "maxRetries": 2,
        "retryDelay": 1000,
        "waitAfter": 2000,
        "timeout": 8000,
        "verifyVisibility": true,
        "scrollIntoView": true,
        "highlight": true,
        "highlightDuration": 2000,
        "verifyNavigation": true,
        "saveDebugInfo": true,
        "takeScreenshots": true,
        "logLevel": "info"
      },
      "next": ["verify_click"]
    },
    {
      "id": "verify_click",
      "type": "JavaScriptExecutionNode",
      "name": "éªŒè¯ç‚¹å‡»ç»“æœ",
      "config": {
        "script": "console.log('ğŸ” éªŒè¯ç‚¹å‡»ç»“æœ...');\n\nconst currentUrl = window.location.href;\nconst currentTitle = document.title;\n\nconsole.log('å½“å‰URL:', currentUrl);\nconsole.log('å½“å‰æ ‡é¢˜:', currentTitle);\n\nreturn {\n  success: true,\n  action: 'click_verified',\n  currentUrl: currentUrl,\n  currentTitle: currentTitle,\n  timestamp: new Date().toISOString()\n};",
        "saveScreenshots": true
      },
      "next": ["end"]
    },
    {
      "id": "end",
      "type": "EndNode",
      "name": "ç»“æŸ",
      "config": { "cleanup": true, "saveLogs": true }
    }
  ],
  "globalConfig": {
    "logLevel": "info",
    "screenshotOnError": true,
    "autoCleanup": true,
    "parallelExecution": false,
    "timeout": 300000
  }
}