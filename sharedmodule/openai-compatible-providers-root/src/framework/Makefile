# OpenAI Compatible Providers Framework Makefile
# æ ‡å‡†æ„å»ºå’Œå‘å¸ƒå·¥å…·

.PHONY: help install build test lint clean publish release dev-setup version-check format

# é»˜è®¤ç›®æ ‡
help:
	@echo "ğŸš€ OpenAI Compatible Providers Framework æ„å»ºå·¥å…·"
	@echo "=================================================="
	@echo ""
	@echo "ğŸ“¦ æ„å»º:"
	@echo "  install    - å®‰è£…ä¾èµ–"
	@echo "  build      - æ„å»ºé¡¹ç›®"
	@echo "  clean      - æ¸…ç†æ„å»ºæ–‡ä»¶"
	@echo "  dev-setup  - å¼€å‘ç¯å¢ƒè®¾ç½®"
	@echo ""
	@echo "ğŸ§ª æµ‹è¯•:"
	@echo "  test       - è¿è¡Œæµ‹è¯•"
	@echo "  test:watch - ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•"
	@echo "  test:cover - è¿è¡Œæµ‹è¯•è¦†ç›–ç‡"
	@echo ""
	@echo "ğŸ” ä»£ç è´¨é‡:"
	@echo "  lint       - è¿è¡Œä»£ç æ£€æŸ¥"
	@echo "  lint:fix   - è‡ªåŠ¨ä¿®å¤ä»£ç é—®é¢˜"
	@echo "  format     - æ ¼å¼åŒ–ä»£ç "
	@echo "  format:check - æ£€æŸ¥ä»£ç æ ¼å¼"
	@echo ""
	@echo "ğŸ“¤ å‘å¸ƒ:"
	@echo "  publish    - å‘å¸ƒåˆ° npm"
	@echo "  release    - å®Œæ•´å‘å¸ƒæµç¨‹"
	@echo "  release:patch - è¡¥ä¸ç‰ˆæœ¬å‘å¸ƒ"
	@echo "  release:minor - æ¬¡è¦ç‰ˆæœ¬å‘å¸ƒ"
	@echo "  release:major - ä¸»è¦ç‰ˆæœ¬å‘å¸ƒ"
	@echo ""
	@echo "ğŸ“‹ å…¶ä»–:"
	@echo "  version    - æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯"
	@echo "  docs       - ç”Ÿæˆæ–‡æ¡£"
	@echo "  setup-hooks - è®¾ç½® Git hooks"

# å®‰è£…ä¾èµ–
install:
	npm install

# æ„å»ºé¡¹ç›®
build: clean
	node scripts/build.js

# å¼€å‘ç¯å¢ƒè®¾ç½®
dev-setup: install
	npm install --save-dev typescript @types/node jest eslint prettier
	npx tsc --init

# æ¸…ç†æ„å»ºæ–‡ä»¶
clean:
	rm -rf dist/
	rm -rf node_modules/.cache/
	find . -name "*.log" -delete
	find . -name "*.tmp" -delete

# è¿è¡Œæµ‹è¯•
test:
	npm test

# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
test:watch:
	npm run test:watch

# è¿è¡Œæµ‹è¯•è¦†ç›–ç‡
test:cover:
	npm run test:coverage

# è¿è¡Œä»£ç æ£€æŸ¥
lint:
	npm run lint

# è‡ªåŠ¨ä¿®å¤ä»£ç é—®é¢˜
lint:fix:
	npm run lint:fix

# æ ¼å¼åŒ–ä»£ç 
format:
	npm run format

# æ£€æŸ¥ä»£ç æ ¼å¼
format:check:
	npm run format:check

# å¿«é€Ÿå‘å¸ƒ (è·³è¿‡ä¸€äº›æ£€æŸ¥)
publish: build test lint
	npm publish

# å®Œæ•´å‘å¸ƒæµç¨‹
release:
	node scripts/publish.js

# è¡¥ä¸ç‰ˆæœ¬å‘å¸ƒ
release:patch:
	npm version patch && npm run build && npm publish

# æ¬¡è¦ç‰ˆæœ¬å‘å¸ƒ
release:minor:
	npm version minor && npm run build && npm publish

# ä¸»è¦ç‰ˆæœ¬å‘å¸ƒ
release:major:
	npm version major && npm run build && npm publish

# æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
version:
	@node -e "console.log('ğŸ“¦ Version:', require('./package.json').version)"
	@node -e "console.log('ğŸ·ï¸  Name:', require('./package.json').name)"
	@node -e "console.log('ğŸ“ Description:', require('./package.json').description)"

# ç”Ÿæˆæ–‡æ¡£
docs:
	npx typedoc src/index.ts --out docs/

# è®¾ç½® Git hooks
setup-hooks:
	npx husky install
	npx husky add .husky/pre-commit "npm run lint"
	npx husky add .husky/pre-push "npm test"

# æ£€æŸ¥é¡¹ç›®çŠ¶æ€
check: lint test format:check
	@echo "âœ… é¡¹ç›®çŠ¶æ€æ£€æŸ¥å®Œæˆ"

# å¿«é€Ÿå¼€å‘æ„å»º
dev: build
	@echo "ğŸš€ å¼€å‘æ„å»ºå®Œæˆ"

# ç”Ÿäº§æ„å»º
prod: clean lint test build
	@echo "ğŸ¯ ç”Ÿäº§æ„å»ºå®Œæˆ"

# åˆ›å»ºæ–°ç‰ˆæœ¬
version-bump:
	@read -p "è¾“å…¥æ–°ç‰ˆæœ¬ (å½“å‰: $(shell node -e "console.log(require('./package.json').version)")): " version; \
	npm version $$version

# æ£€æŸ¥ä¾èµ–æ›´æ–°
check-deps:
	npm outdated

# æ›´æ–°ä¾èµ–
update-deps:
	npm update

# å®‰å…¨æ£€æŸ¥
security-audit:
	npm audit

# ä¿®å¤å®‰å…¨æ¼æ´
security-fix:
	npm audit fix

# æ¸…ç†å¹¶é‡æ–°å®‰è£…
reinstall: clean install
	@echo "ğŸ”„ é‡æ–°å®‰è£…å®Œæˆ"

# æ„å»ºå¹¶æµ‹è¯•æ‰€æœ‰
all: clean install lint test build
	@echo "ğŸ‰ å®Œæ•´æ„å»ºæµç¨‹å®Œæˆ"