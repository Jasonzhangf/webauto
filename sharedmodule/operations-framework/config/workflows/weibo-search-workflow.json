{
  "name": "weibo-search-workflow",
  "description": "微博搜索工作流 - 根据关键词搜索微博内容",
  "version": "1.0.0",
  "enabled": true,
  "variables": [
    {
      "name": "keyword",
      "type": "string",
      "value": "${input.keyword}",
      "scope": "workflow",
      "description": "搜索关键词"
    },
    {
      "name": "resultCount",
      "type": "number",
      "value": "${input.resultCount || 50}",
      "scope": "workflow",
      "description": "搜索结果数量"
    },
    {
      "name": "outputDir",
      "type": "string",
      "value": "${input.outputDir || './output/weibo-search'}",
      "scope": "workflow",
      "description": "输出目录"
    },
    {
      "name": "enableAIProcessing",
      "type": "boolean",
      "value": "${input.enableAIProcessing || false}",
      "scope": "workflow",
      "description": "是否启用AI处理"
    },
    {
      "name": "enableWebhook",
      "type": "boolean",
      "value": "${input.enableWebhook || false}",
      "scope": "workflow",
      "description": "是否启用Webhook通知"
    }
  ],
  "steps": [
    {
      "id": "search_weibo",
      "name": "微博搜索",
      "operation": "web-scraper",
      "params": {
        "operation": "search",
        "searchEngine": "weibo",
        "query": "${keyword}",
        "resultCount": "${resultCount}",
        "selectors": [
          {
            "name": "search_results",
            "type": "text",
            "selector": ".Feed_body_3R0rO .Feed_body_3R0rO"
          },
          {
            "name": "post_links",
            "type": "href",
            "selector": ".Feed_body_3R0rO a"
          },
          {
            "name": "post_times",
            "type": "text",
            "selector": ".Feed_body_3R0rO .Feed_body_3R0rO"
          },
          {
            "name": "user_names",
            "type": "text",
            "selector": ".Feed_body_3R0rO .Feed_body_3R0rO"
          }
        ],
        "outputFormat": "json",
        "outputDir": "${outputDir}",
        "fileName": "weibo_search_results",
        "browserConfig": {
          "headless": false,
          "timeout": 30000
        }
      },
      "outputVariable": "searchResults",
      "retry": {
        "maxRetries": 3,
        "delay": 2000,
        "backoffFactor": 2
      },
      "errorHandling": "retry"
    },
    {
      "id": "extract_links",
      "name": "提取链接",
      "operation": "data-processor",
      "params": {
        "operation": "extract",
        "inputData": "${searchResults}",
        "extractionRules": [
          {
            "name": "post_urls",
            "type": "pattern",
            "pattern": "https://weibo\\.com/\\d+/[\\w]+",
            "source": "post_links"
          }
        ],
        "outputFormat": "json"
      },
      "outputVariable": "postLinks",
      "condition": {
        "type": "exists",
        "condition": "searchResults",
        "config": {
          "checkEmpty": true
        }
      }
    },
    {
      "id": "batch_extract",
      "name": "批量内容提取",
      "operation": "web-scraper",
      "params": {
        "operation": "batch",
        "urls": "${postLinks}",
        "selectors": [
          {
            "name": "post_content",
            "type": "text",
            "selector": ".Feed_body_3R0rO"
          },
          {
            "name": "post_images",
            "type": "src",
            "selector": ".Feed_body_3R0rO img"
          },
          {
            "name": "post_videos",
            "type": "src",
            "selector": ".Feed_body_3R0rO video"
          },
          {
            "name": "comments",
            "type": "text",
            "selector": ".Feed_body_3R0rO .Feed_body_3R0rO"
          },
          {
            "name": "likes",
            "type": "text",
            "selector": ".Feed_body_3R0rO .Feed_body_3R0rO"
          },
          {
            "name": "shares",
            "type": "text",
            "selector": ".Feed_body_3R0rO .Feed_body_3R0rO"
          }
        ],
        "outputFormat": "json",
        "outputDir": "${outputDir}",
        "fileName": "weibo_batch_extract",
        "maxConcurrency": 3,
        "delayBetweenRequests": 1000,
        "browserConfig": {
          "headless": false,
          "timeout": 30000
        }
      },
      "outputVariable": "batchResults",
      "retry": {
        "maxRetries": 2,
        "delay": 3000
      },
      "condition": {
        "type": "exists",
        "condition": "postLinks",
        "config": {
          "checkEmpty": true
        }
      }
    },
    {
      "id": "organize_content",
      "name": "内容整理",
      "operation": "file-organizer",
      "params": {
        "operation": "intelligentOrganize",
        "sourceDirectory": "${outputDir}",
        "targetDirectory": "${outputDir}/organized",
        "strategy": "extension",
        "createSummary": true,
        "backup": false
      },
      "outputVariable": "organizedResults",
      "condition": {
        "type": "exists",
        "condition": "batchResults",
        "config": {
          "checkEmpty": true
        }
      }
    },
    {
      "id": "ai_processing",
      "name": "AI内容处理",
      "operation": "conditional",
      "params": {
        "operation": "if",
        "condition": {
          "type": "expression",
          "condition": "enableAIProcessing === true"
        },
        "thenSteps": [
          {
            "id": "ai_summarize",
            "name": "AI总结",
            "operation": "ai-summarizer",
            "params": {
              "operation": "summarizeContent",
              "sourceFiles": ["${outputDir}/organized/*.json"],
              "outputDirectory": "${outputDir}/ai-results",
              "strategy": "executive",
              "maxTokens": 1000
            },
            "outputVariable": "aiSummary"
          },
          {
            "id": "html_conversion",
            "name": "HTML转换",
            "operation": "html-formatter",
            "params": {
              "operation": "batchFormatHTML",
              "sourceFiles": ["${outputDir}/organized/*.html"],
              "outputDirectory": "${outputDir}/formatted-html",
              "strategy": "balanced"
            },
            "outputVariable": "formattedHTML"
          }
        ],
        "elseSteps": [
          {
            "id": "markdown_conversion",
            "name": "Markdown转换",
            "operation": "html-formatter",
            "params": {
              "operation": "convertToMarkdown",
              "sourceFiles": ["${outputDir}/organized/*.html"],
              "outputDirectory": "${outputDir}/markdown"
            },
            "outputVariable": "markdownContent"
          }
        ]
      },
      "outputVariable": "processingResults"
    },
    {
      "id": "merge_results",
      "name": "合并结果",
      "operation": "data-processor",
      "params": {
        "operation": "merge",
        "inputData": ["${searchResults}", "${batchResults}", "${organizedResults}", "${processingResults}"],
        "mergeStrategy": "combine",
        "outputFormat": "json",
        "outputFile": "${outputDir}/final_results.json"
      },
      "outputVariable": "finalResults"
    },
    {
      "id": "send_notification",
      "name": "发送通知",
      "operation": "conditional",
      "params": {
        "operation": "if",
        "condition": {
          "type": "expression",
          "condition": "enableWebhook === true"
        },
        "thenSteps": [
          {
            "id": "webhook_notification",
            "name": "Webhook通知",
            "operation": "notification",
            "params": {
              "operation": "webhook",
              "url": "${input.webhookUrl || 'https://example.com/webhook'}",
              "method": "POST",
              "data": {
                "workflow": "weibo-search-workflow",
                "keyword": "${keyword}",
                "resultCount": "${resultCount}",
                "timestamp": "${Date.now()}",
                "results": "${finalResults}"
              },
              "headers": {
                "Content-Type": "application/json"
              }
            },
            "outputVariable": "webhookResult"
          }
        ]
      },
      "outputVariable": "notificationResult"
    }
  ],
  "metadata": {
    "author": "WebAuto Team",
    "created": "2024-01-01T00:00:00Z",
    "updated": "2024-01-01T00:00:00Z",
    "tags": ["weibo", "search", "social-media", "automation"],
    "category": "web-scraping",
    "complexity": "medium",
    "estimatedTime": "5-10 minutes"
  }
}