{
  "name": "weibo-user-profile-workflow",
  "description": "微博个人主页内容捕获工作流",
  "version": "1.0.0",
  "author": "WebAuto Team",
  "created": "2025-09-15",
  "category": "weibo-profile",
  "tags": ["weibo", "user-profile", "content-extraction", "timeline"],
  "settings": {
    "maxRetries": 3,
    "timeout": 300000,
    "parallelExecution": false,
    "continueOnError": false,
    "saveResults": true,
    "resultFormat": "structured",
    "enableImageFiltering": true,
    "enableDeduplication": true,
    "maxPages": 10
  },
  "context": {
    "container": {
      "type": "weibo-user-profile",
      "platform": "weibo",
      "language": "zh",
      "url": "https://weibo.com"
    },
    "browser": {
      "headless": false,
      "autoInjectCookies": true,
      "waitForLogin": true,
      "targetDomain": "weibo.com",
      "defaultTimeout": 15000,
      "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"
    },
    "save": {
      "rootDir": "~/.webauto/weibo/user-profiles",
      "format": "structured",
      "includeImages": true,
      "includeMetadata": true,
      "createReadme": true,
      "includeCSV": true,
      "enableDeduplication": true
    },
    "profile": {
      "includeUserInfo": true,
      "includeStats": true,
      "includeFollowData": true,
      "includeRecentPosts": true,
      "includePagination": true
    },
    "imageFiltering": {
      "enabled": true,
      "filterAvatars": true,
      "filterLogos": true,
      "filterSystemImages": true,
      "filterThumbnails": true,
      "filterEmojis": true,
      "minImageSize": 50
    }
  },
  "steps": [
    {
      "id": "initialize-browser",
      "name": "初始化浏览器环境",
      "abstractCategory": "browser-initialization",
      "description": "启动浏览器并设置微博Cookie",
      "config": {
        "url": "https://weibo.com",
        "waitForSelector": ".WB_global_nav, .gn_header",
        "timeout": 30000,
        "loadCookies": true,
        "cookieDomain": "weibo.com",
        "cookiePath": "~/.webauto/cookies"
      },
      "expectedOutput": ["browserContext", "page"],
      "forceOperation": "BrowserInitializationOperation"
    },
    {
      "id": "construct-profile-url",
      "name": "构建个人主页URL",
      "abstractCategory": "url-construction",
      "description": "构建微博用户个人主页URL",
      "config": {
        "profileUrl": "${profileUrl}",
        "extractUsername": true
      },
      "expectedOutput": ["profileUrl", "username"],
      "forceOperation": "ProfileUrlParserOperation"
    },
    {
      "id": "extract-username-from-page",
      "name": "从页面提取用户名",
      "abstractCategory": "content-extraction",
      "description": "如果URL是数字ID，从页面内容提取用户名",
      "config": {
        "username": "${username}",
        "selectors": {
          "username": [
            ".PCD_user_info .username",
            ".Profile_header .name",
            ".UserInfo_name",
            ".WB_cardwrap .username",
            ".gn_name",
            ".name"
          ],
          "screenName": [
            ".PCD_user_info .screen_name",
            ".Profile_header .screen_name",
            ".UserInfo_screenName"
          ]
        },
        "fallbackToUid": true
      },
      "expectedOutput": ["username"],
      "forceOperation": "UsernameExtractionOperation"
    },
    {
      "id": "navigate-to-profile",
      "name": "导航到个人主页",
      "abstractCategory": "page-navigation",
      "description": "导航到微博用户个人主页",
      "config": {
        "url": "${profileUrl}",
        "waitForSelector": ".WB_cardwrap, .Profile_header, .PCD_user_info",
        "timeout": 30000,
        "screenshot": false
      },
      "expectedOutput": ["page"],
      "forceOperation": "PageNavigationOperation"
    },
    {
      "id": "wait-for-profile-load",
      "name": "等待个人主页加载",
      "abstractCategory": "wait-operation",
      "description": "等待个人主页内容完全加载",
      "config": {
        "waitForSelector": ".WB_cardwrap, .Profile_header",
        "timeout": 15000,
        "waitForState": "networkidle"
      },
      "expectedOutput": ["profileLoaded"],
      "forceOperation": "WaitOperation"
    },
    {
      "id": "extract-user-info",
      "name": "提取用户基本信息",
      "abstractCategory": "profile-extraction",
      "description": "提取用户个人主页的基本信息",
      "config": {
        "source": "page",
        "selectors": {
          "username": [".PCD_user_info .username", ".Profile_header .name", ".UserInfo_name"],
          "bio": [".PCD_user_info .intro", ".Profile_header .info", ".UserInfo_intro"],
          "location": [".PCD_user_info .location", ".Profile_header .place"],
          "gender": [".PCD_user_info .gender", ".Profile_header .gender"],
          "birthday": [".PCD_user_info .birthday", ".Profile_header .birth"],
          "registrationDate": [".PCD_user_info .reg_time", ".Profile_header .reg_date"],
          "verified": [".PCD_user_info .verified", ".Profile_header .verify"],
          "avatar": [".PCD_user_info .avatar img", ".Profile_header .avatar img"]
        },
        "stats": {
          "followers": [".PCD_user_info .followers_count", ".Profile_header .followers"],
          "following": [".PCD_user_info .friends_count", ".Profile_header .friends"],
          "posts": [".PCD_user_info .weibo_count", ".Profile_header .weibo"],
          "lists": [".PCD_user_info .lists_count", ".Profile_header .lists"]
        }
      },
      "expectedOutput": ["userInfo"],
      "forceOperation": "UserInfoExtractionOperation"
    },
    {
      "id": "extract-user-timeline",
      "name": "提取用户时间线",
      "abstractCategory": "timeline-extraction",
      "description": "提取用户主页的时间线帖子",
      "config": {
        "source": "page",
        "maxPages": "${maxPages:10}",
        "postsPerPage": 20,
        "contentSelector": ".WB_feed .WB_detail, .Feed_body_3R0rO, .card-wrap",
        "includeFields": ["id", "content", "time", "stats", "images", "links", "source"],
        "pagination": {
          "enabled": true,
          "nextPageSelector": ".page_next, .next, .Page_next",
          "scrollToLoad": true
        },
        "imageFiltering": {
          "enabled": true,
          "filterRules": {
            "avatars": ["avatar", "head", "profile"],
            "logos": ["logo", "icon", "vip", "svvip"],
            "system": ["s.weibo.com/upload", "s.weibo.com/default", "weibo.com/img"],
            "thumbnails": ["thumb", "orj", "crop", "square", "small", "mini"],
            "emojis": ["expression", "emoji", "sinajs.cn/t4/appstyle", "face.t.sinajs.cn"],
            "sizes": ["20x20", "24x24", "32x32", "64x64"]
          }
        }
      },
      "expectedOutput": ["timelinePosts"],
      "forceOperation": "TimelineExtractionOperation"
    },
    {
      "id": "extract-user-media",
      "name": "提取用户媒体内容",
      "abstractCategory": "media-extraction",
      "description": "提取用户的图片和视频内容",
      "config": {
        "source": "timelinePosts",
        "extractImages": true,
        "extractVideos": true,
        "mediaQuality": "original",
        "downloadMedia": false
      },
      "expectedOutput": ["mediaContent"],
      "forceOperation": "MediaExtractionOperation"
    },
    {
      "id": "extract-user-interactions",
      "name": "提取用户互动数据",
      "abstractCategory": "interaction-extraction",
      "description": "提取用户的点赞、评论、转发等互动数据",
      "config": {
        "source": "timelinePosts",
        "includeLikes": true,
        "includeComments": true,
        "includeReposts": true,
        "maxCommentsPerPost": 50
      },
      "expectedOutput": ["interactionsData"],
      "forceOperation": "InteractionExtractionOperation"
    },
    {
      "id": "process-and-filter-images",
      "name": "处理和过滤图片",
      "abstractCategory": "image-processing",
      "description": "过滤并处理帖子中的图片，移除logo、头像、缩略图等",
      "config": {
        "data": "${timelinePosts}",
        "processingRules": {
          "removeThumbnails": true,
          "removeAvatars": true,
          "removeLogos": true,
          "removeEmojis": true,
          "minImageWidth": 50,
          "allowedDomains": ["wx1.sinaimg.cn", "wx2.sinaimg.cn", "wx3.sinaimg.cn", "wx4.sinaimg.cn", "tvax1.sinaimg.cn", "tvax2.sinaimg.cn", "tvax3.sinaimg.cn", "tvax4.sinaimg.cn"]
        }
      },
      "expectedOutput": ["filteredPosts"],
      "forceOperation": "ImageProcessingOperation"
    },
    {
      "id": "scan-existing-data",
      "name": "扫描现有数据",
      "abstractCategory": "data-scanning",
      "description": "扫描已存在的数据以进行去重",
      "config": {
        "basePath": "${save.rootDir}",
        "keyword": "${username}",
        "subDirectory": "",
        "checkExistingFiles": true
      },
      "expectedOutput": ["existingData"],
      "forceOperation": "DataScanningOperation"
    },
    {
      "id": "deduplicate-content",
      "name": "内容去重",
      "abstractCategory": "data-deduplication",
      "description": "基于帖子ID和内容进行去重处理",
      "config": {
        "newContent": "${filteredPosts}",
        "existingData": "${existingData}",
        "deduplicationFields": ["id", "content"],
        "strategy": "merge-and-skip"
      },
      "expectedOutput": ["deduplicatedPosts"],
      "forceOperation": "DataDeduplicationOperation"
    },
    {
      "id": "compile-user-data",
      "name": "编译用户数据",
      "abstractCategory": "data-compilation",
      "description": "编译完整的用户个人资料数据",
      "config": {
        "userInfo": "${userInfo}",
        "timelinePosts": "${deduplicatedPosts}",
        "mediaContent": "${mediaContent}",
        "interactionsData": "${interactionsData}",
        "extractionTime": "${timestamp}",
        "extractionConfig": {
          "maxPages": "${maxPages}",
          "includeImages": true,
          "includeMedia": true,
          "includeInteractions": true
        }
      },
      "expectedOutput": ["completeUserData"],
      "forceOperation": "DataCompilationOperation"
    },
    {
      "id": "save-user-profile",
      "name": "保存用户个人资料",
      "abstractCategory": "file-save",
      "description": "保存用户个人资料到结构化目录",
      "config": {
        "content": "${completeUserData}",
        "keyword": "${username}",
        "basePath": "${save.rootDir}",
        "includeCSV": true,
        "includeIndividualFiles": true,
        "includeImages": true,
        "createReadme": true,
        "filePrefix": "user-profile",
        "deduplication": true,
        "skipExistingImages": true,
        "incrementalMode": true,
        "directoryStructure": {
          "profile": {
            "info": "用户基本信息",
            "timeline": "用户时间线",
            "media": "媒体内容",
            "interactions": "互动数据"
          }
        }
      },
      "expectedOutput": ["saveResult"],
      "forceOperation": "FileSaveOperation"
    },
    {
      "id": "download-user-media",
      "name": "下载用户媒体内容",
      "abstractCategory": "media-download",
      "description": "下载用户发布的图片和视频内容",
      "config": {
        "saveResult": "${saveResult}",
        "mediaContent": "${mediaContent}",
        "skipExistingFiles": true,
        "downloadTimeout": 30000,
        "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"
      },
      "expectedOutput": ["downloadResults"],
      "forceOperation": "MediaDownloadOperation"
    },
    {
      "id": "generate-user-report",
      "name": "生成用户报告",
      "abstractCategory": "report-generation",
      "description": "生成用户个人资料统计报告",
      "config": {
        "userId": "${userId}",
        "userInfo": "${userInfo}",
        "saveResult": "${saveResult}",
        "downloadResults": "${downloadResults}",
        "executionTime": "${executionTime}",
        "includeStatistics": true,
        "includeSummary": true,
        "includeActivityChart": true
      },
      "expectedOutput": ["userReport"],
      "forceOperation": "UserReportGenerationOperation"
    }
  ],
  "output": {
    "success": {
      "message": "微博个人主页内容捕获完成",
      "data": {
        "userId": "${userId}",
        "username": "${userInfo.username}",
        "postsCount": "${deduplicatedPosts.length}",
        "savePath": "${saveResult.basePath}",
        "totalFiles": "${saveResult.totalFiles}",
        "newItemsCount": "${saveResult.newItemsCount}",
        "existingItemsCount": "${saveResult.existingItemCount}",
        "executionTime": "${executionTime}"
      },
      "userInfo": {
        "username": "${userInfo.username}",
        "bio": "${userInfo.bio}",
        "location": "${userInfo.location}",
        "followers": "${userInfo.stats.followers}",
        "following": "${userInfo.stats.following}",
        "posts": "${userInfo.stats.posts}",
        "verified": "${userInfo.verified}"
      },
      "files": {
        "basePath": "${saveResult.basePath}",
        "metadata": "${saveResult.basePath}/metadata.json",
        "summary": "${saveResult.basePath}/all-items.json",
        "csv": "${saveResult.basePath}/all-items.csv",
        "readme": "${saveResult.basePath}/README.md",
        "userInfo": "${saveResult.basePath}/user-info.json"
      },
      "statistics": {
        "totalPosts": "${deduplicatedPosts.length}",
        "postsWithImages": "${saveResult.postsWithImages}",
        "postsWithVideos": "${saveResult.postsWithVideos}",
        "totalImages": "${saveResult.totalImages}",
        "totalVideos": "${saveResult.totalVideos}",
        "downloadedMedia": "${downloadResults.successCount}",
        "skippedMedia": "${downloadResults.skippedCount}",
        "extractionTime": "${timestamp}",
        "userId": "${userId}"
      }
    },
    "error": {
      "message": "微博个人主页内容捕获失败",
      "retry": true,
      "maxRetries": 3,
      "errorHandling": {
        "browserError": "restart-browser",
        "networkError": "retry-with-delay",
        "contentError": "log-and-continue",
        "profileNotFound": "return-error"
      }
    }
  },
  "parameters": {
    "profileUrl": {
      "type": "string",
      "required": true,
      "description": "微博个人主页链接（支持用户名或数字ID）",
      "example": "https://weibo.com/央视新闻 或 https://weibo.com/1671109627"
    },
    "maxPages": {
      "type": "number",
      "required": false,
      "default": 10,
      "min": 1,
      "max": 50,
      "description": "要抓取的最大页面数"
    },
    "postsPerPage": {
      "type": "number",
      "required": false,
      "default": 20,
      "min": 10,
      "max": 50,
      "description": "每页抓取的帖子数量"
    },
    "includeMedia": {
      "type": "boolean",
      "required": false,
      "default": true,
      "description": "是否包含媒体内容（图片/视频）"
    },
    "includeInteractions": {
      "type": "boolean",
      "required": false,
      "default": true,
      "description": "是否包含互动数据（点赞/评论/转发）"
    },
    "enableImageFiltering": {
      "type": "boolean",
      "required": false,
      "default": true,
      "description": "是否启用图片过滤"
    },
    "saveDir": {
      "type": "string",
      "required": false,
      "default": "~/.webauto/weibo/user-profiles",
      "description": "保存根目录（实际保存目录为 username文件夹）"
    }
  },
  "examples": {
    "央视新闻主页": {
      "profileUrl": "https://weibo.com/央视新闻",
      "maxPages": 5,
      "includeMedia": true,
      "includeInteractions": true,
      "enableImageFiltering": true
    },
    "胡锡进主页": {
      "profileUrl": "https://weibo.com/胡锡进",
      "maxPages": 3,
      "includeMedia": true,
      "includeInteractions": false,
      "enableImageFiltering": true
    },
    "数字ID主页": {
      "profileUrl": "https://weibo.com/1671109627",
      "maxPages": 10,
      "includeMedia": true,
      "includeInteractions": true,
      "enableImageFiltering": true
    }
  },
  "performance": {
    "estimatedTime": "5-15分钟",
    "successRate": "80-90%",
    "memoryUsage": "medium",
    "networkUsage": "high"
  },
  "dependencies": {
    "required": [
      "BrowserInitializationOperation",
      "PageNavigationOperation",
      "UserInfoExtractionOperation",
      "TimelineExtractionOperation",
      "FileSaveOperation"
    ],
    "optional": [
      "MediaExtractionOperation",
      "InteractionExtractionOperation",
      "MediaDownloadOperation",
      "UserReportGenerationOperation"
    ]
  },
  "notes": [
    "此工作流适用于抓取微博用户个人主页内容",
    "支持通过用户名链接或数字ID链接进行抓取",
    "对于数字ID链接，会自动从页面内容提取用户名",
    "包含用户基本信息、时间线帖子、媒体内容和互动数据",
    "具有完善的图片过滤和去重功能",
    "支持分页抓取大量内容"
  ]
}