{
  "name": "weibo-homepage-workflow",
  "description": "微博主页（发现页）内容捕获工作流",
  "version": "1.0.0",
  "author": "WebAuto Team",
  "created": "2025-09-15",
  "category": "weibo-homepage",
  "tags": ["weibo", "homepage", "discovery", "trending", "feed"],
  "settings": {
    "maxRetries": 3,
    "timeout": 300000,
    "parallelExecution": false,
    "continueOnError": false,
    "saveResults": true,
    "resultFormat": "structured",
    "enableImageFiltering": true,
    "enableDeduplication": true,
    "maxScrolls": 20
  },
  "context": {
    "container": {
      "type": "weibo-homepage",
      "platform": "weibo",
      "language": "zh",
      "url": "https://weibo.com"
    },
    "browser": {
      "headless": false,
      "autoInjectCookies": true,
      "waitForLogin": true,
      "targetDomain": "weibo.com",
      "defaultTimeout": 15000,
      "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"
    },
    "save": {
      "rootDir": "~/.webauto/weibo/homepage",
      "format": "structured",
      "includeImages": true,
      "includeMetadata": true,
      "createReadme": true,
      "includeCSV": true,
      "enableDeduplication": true
    },
    "homepage": {
      "includeTrendingTopics": true,
      "includeHotSearch": true,
      "includeFeedContent": true,
      "includeRecommendations": true,
      "includeCategories": true
    },
    "imageFiltering": {
      "enabled": true,
      "filterAvatars": true,
      "filterLogos": true,
      "filterSystemImages": true,
      "filterThumbnails": true,
      "filterEmojis": true,
      "minImageSize": 50
    }
  },
  "steps": [
    {
      "id": "initialize-browser",
      "name": "初始化浏览器环境",
      "abstractCategory": "browser-initialization",
      "description": "启动浏览器并设置微博Cookie",
      "config": {
        "url": "https://weibo.com",
        "waitForSelector": ".WB_global_nav, .gn_header",
        "timeout": 30000,
        "loadCookies": true,
        "cookieDomain": "weibo.com",
        "cookiePath": "~/.webauto/cookies"
      },
      "expectedOutput": ["browserContext", "page"],
      "forceOperation": "BrowserInitializationOperation"
    },
    {
      "id": "navigate-to-homepage",
      "name": "导航到微博主页",
      "abstractCategory": "page-navigation",
      "description": "导航到微博主页（发现页）",
      "config": {
        "url": "https://weibo.com",
        "waitForSelector": ".WB_global_nav, .gn_header, .WB_feed",
        "timeout": 30000,
        "screenshot": false
      },
      "expectedOutput": ["page"],
      "forceOperation": "PageNavigationOperation"
    },
    {
      "id": "wait-for-homepage-load",
      "name": "等待主页内容加载",
      "abstractCategory": "wait-operation",
      "description": "等待微博主页内容完全加载",
      "config": {
        "waitForSelector": ".WB_feed, .Feed_body_3R0rO, .gn_nav_list",
        "timeout": 15000,
        "waitForState": "networkidle"
      },
      "expectedOutput": ["homepageLoaded"],
      "forceOperation": "WaitOperation"
    },
    {
      "id": "extract-trending-topics",
      "name": "提取热门话题",
      "abstractCategory": "trending-extraction",
      "description": "提取微博主页的热门话题榜单",
      "config": {
        "source": "page",
        "selectors": {
          "hotSearch": [".hot_search", ".gn_nav_list .hot", ".trending_topics"],
          "superTopic": [".super_topic", ".gn_nav_list .super"],
          "topicList": [".topic_list", ".WB_topiclist", ".feed_topics"]
        },
        "maxTopics": 50,
        "includeStats": true,
        "includeRank": true
      },
      "expectedOutput": ["trendingTopics"],
      "forceOperation": "TrendingTopicsExtractionOperation"
    },
    {
      "id": "extract-feed-content",
      "name": "提取信息流内容",
      "abstractCategory": "feed-extraction",
      "description": "提取微博主页信息流中的帖子内容",
      "config": {
        "source": "page",
        "maxScrolls": "${maxScrolls:20}",
        "scrollDelay": 2000,
        "contentSelector": ".WB_feed .WB_detail, .Feed_body_3R0rO, .card-wrap",
        "includeFields": ["id", "username", "content", "time", "stats", "images", "links", "source", "category"],
        "loadMoreTrigger": {
          "enabled": true,
          "scrollToLoad": true,
          "loadMoreSelector": ".load_more, .next_loading, .WB_more"
        },
        "imageFiltering": {
          "enabled": true,
          "filterRules": {
            "avatars": ["avatar", "head", "profile"],
            "logos": ["logo", "icon", "vip", "svvip"],
            "system": ["s.weibo.com/upload", "s.weibo.com/default", "weibo.com/img"],
            "thumbnails": ["thumb", "orj", "crop", "square", "small", "mini"],
            "emojis": ["expression", "emoji", "sinajs.cn/t4/appstyle", "face.t.sinajs.cn"],
            "sizes": ["20x20", "24x24", "32x32", "64x64"]
          }
        }
      },
      "expectedOutput": ["feedPosts"],
      "forceOperation": "FeedExtractionOperation"
    },
    {
      "id": "extract-recommendations",
      "name": "提取推荐内容",
      "abstractCategory": "recommendation-extraction",
      "description": "提取微博主页的推荐用户和推荐内容",
      "config": {
        "source": "page",
        "selectors": {
          "recommendedUsers": [".recommended_users", ".WB_follow_rec", ".gn_recommend"],
          "recommendedTopics": [".recommended_topics", ".WB_topic_rec"],
          "recommendedFeeds": [".recommended_feeds", ".WB_feed_rec"]
        },
        "maxRecommendations": 20,
        "includeReason": true
      },
      "expectedOutput": ["recommendations"],
      "forceOperation": "RecommendationExtractionOperation"
    },
    {
      "id": "extract-categories",
      "name": "提取分类内容",
      "abstractCategory": "category-extraction",
      "description": "提取微博主页各分类板块的内容",
      "config": {
        "source": "page",
        "categories": {
          "news": ["新闻", "时事", "热点"],
          "entertainment": ["娱乐", "明星", "综艺"],
          "sports": ["体育", "足球", "篮球"],
          "technology": ["科技", "互联网", "数码"],
          "finance": ["财经", "股票", "基金"],
          "lifestyle": ["生活", "美食", "旅游"]
        },
        "categorySelectors": {
          "news": [".news_section", ".gn_nav_news"],
          "entertainment": [".ent_section", ".gn_nav_ent"],
          "sports": [".sports_section", ".gn_nav_sports"]
        }
      },
      "expectedOutput": ["categories"],
      "forceOperation": "CategoryExtractionOperation"
    },
    {
      "id": "extract-homepage-stats",
      "name": "提取主页统计数据",
      "abstractCategory": "stats-extraction",
      "description": "提取微博主页的统计数据",
      "config": {
        "source": "page",
        "stats": {
          "onlineUsers": [".online_count", ".WB_online"],
          "newPosts": [".new_posts_count", ".WB_new"],
          "hotTopicsCount": [".hot_topics_count", ".WB_hot_count"],
          "activeUsers": [".active_users_count", ".WB_active"]
        }
      },
      "expectedOutput": ["homepageStats"],
      "forceOperation": "StatsExtractionOperation"
    },
    {
      "id": "process-and-filter-images",
      "name": "处理和过滤图片",
      "abstractCategory": "image-processing",
      "description": "过滤并处理帖子中的图片，移除logo、头像、缩略图等",
      "config": {
        "data": "${feedPosts}",
        "processingRules": {
          "removeThumbnails": true,
          "removeAvatars": true,
          "removeLogos": true,
          "removeEmojis": true,
          "minImageWidth": 50,
          "allowedDomains": ["wx1.sinaimg.cn", "wx2.sinaimg.cn", "wx3.sinaimg.cn", "wx4.sinaimg.cn", "tvax1.sinaimg.cn", "tvax2.sinaimg.cn", "tvax3.sinaimg.cn", "tvax4.sinaimg.cn"]
        }
      },
      "expectedOutput": ["filteredPosts"],
      "forceOperation": "ImageProcessingOperation"
    },
    {
      "id": "scan-existing-data",
      "name": "扫描现有数据",
      "abstractCategory": "data-scanning",
      "description": "扫描已存在的数据以进行去重",
      "config": {
        "basePath": "${save.rootDir}",
        "keyword": "homepage",
        "subDirectory": "homepage-feed",
        "checkExistingFiles": true
      },
      "expectedOutput": ["existingData"],
      "forceOperation": "DataScanningOperation"
    },
    {
      "id": "deduplicate-content",
      "name": "内容去重",
      "abstractCategory": "data-deduplication",
      "description": "基于帖子ID和内容进行去重处理",
      "config": {
        "newContent": "${filteredPosts}",
        "existingData": "${existingData}",
        "deduplicationFields": ["id", "content"],
        "strategy": "merge-and-skip"
      },
      "expectedOutput": ["deduplicatedPosts"],
      "forceOperation": "DataDeduplicationOperation"
    },
    {
      "id": "compile-homepage-data",
      "name": "编译主页数据",
      "abstractCategory": "data-compilation",
      "description": "编译完整的微博主页数据",
      "config": {
        "trendingTopics": "${trendingTopics}",
        "feedPosts": "${deduplicatedPosts}",
        "recommendations": "${recommendations}",
        "categories": "${categories}",
        "homepageStats": "${homepageStats}",
        "extractionTime": "${timestamp}",
        "extractionConfig": {
          "maxScrolls": "${maxScrolls}",
          "includeTrending": true,
          "includeFeed": true,
          "includeRecommendations": true,
          "includeCategories": true
        }
      },
      "expectedOutput": ["completeHomepageData"],
      "forceOperation": "DataCompilationOperation"
    },
    {
      "id": "save-homepage-data",
      "name": "保存主页数据",
      "abstractCategory": "file-save",
      "description": "保存微博主页数据到结构化目录",
      "config": {
        "content": "${completeHomepageData}",
        "keyword": "homepage",
        "basePath": "${save.rootDir}/homepage-feed",
        "includeCSV": true,
        "includeIndividualFiles": true,
        "includeImages": true,
        "createReadme": true,
        "filePrefix": "homepage",
        "deduplication": true,
        "skipExistingImages": true,
        "incrementalMode": true,
        "directoryStructure": {
          "homepage": {
            "trending": "热门话题",
            "feed": "信息流",
            "recommendations": "推荐内容",
            "categories": "分类内容",
            "stats": "统计数据"
          }
        }
      },
      "expectedOutput": ["saveResult"],
      "forceOperation": "FileSaveOperation"
    },
    {
      "id": "download-homepage-media",
      "name": "下载主页媒体内容",
      "abstractCategory": "media-download",
      "description": "下载主页帖子中的图片内容",
      "config": {
        "saveResult": "${saveResult}",
        "skipExistingFiles": true,
        "downloadTimeout": 30000,
        "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"
      },
      "expectedOutput": ["downloadResults"],
      "forceOperation": "MediaDownloadOperation"
    },
    {
      "id": "generate-homepage-report",
      "name": "生成主页报告",
      "abstractCategory": "report-generation",
      "description": "生成微博主页统计报告",
      "config": {
        "saveResult": "${saveResult}",
        "trendingTopics": "${trendingTopics}",
        "homepageStats": "${homepageStats}",
        "downloadResults": "${downloadResults}",
        "executionTime": "${executionTime}",
        "includeStatistics": true,
        "includeSummary": true,
        "includeTrendingAnalysis": true
      },
      "expectedOutput": ["homepageReport"],
      "forceOperation": "HomepageReportGenerationOperation"
    }
  ],
  "output": {
    "success": {
      "message": "微博主页内容捕获完成",
      "data": {
        "extractionTime": "${timestamp}",
        "postsCount": "${deduplicatedPosts.length}",
        "trendingTopicsCount": "${trendingTopics.length}",
        "savePath": "${saveResult.basePath}",
        "totalFiles": "${saveResult.totalFiles}",
        "newItemsCount": "${saveResult.newItemsCount}",
        "existingItemsCount": "${saveResult.existingItemCount}",
        "executionTime": "${executionTime}"
      },
      "trendingTopics": {
        "count": "${trendingTopics.length}",
        "topTopic": "${trendingTopics[0]}",
        "categories": "${trendingTopics.map(t => t.category)}"
      },
      "feedStats": {
        "totalPosts": "${deduplicatedPosts.length}",
        "postsWithImages": "${saveResult.postsWithImages}",
        "uniqueUsers": "${deduplicatedPosts.map(p => p.username).filter((v, i, a) => a.indexOf(v) === i).length}",
        "timeRange": {
          "earliest": "${Math.min(...deduplicatedPosts.map(p => new Date(p.time)))}",
          "latest": "${Math.max(...deduplicatedPosts.map(p => new Date(p.time)))}"
        }
      },
      "files": {
        "basePath": "${saveResult.basePath}",
        "metadata": "${saveResult.basePath}/metadata.json",
        "summary": "${saveResult.basePath}/all-items.json",
        "csv": "${saveResult.basePath}/all-items.csv",
        "readme": "${saveResult.basePath}/README.md",
        "trendingData": "${saveResult.basePath}/trending-topics.json"
      },
      "statistics": {
        "totalPosts": "${deduplicatedPosts.length}",
        "trendingTopics": "${trendingTopics.length}",
        "recommendations": "${recommendations.length}",
        "categories": "${categories.length}",
        "totalImages": "${saveResult.totalImages}",
        "downloadedImages": "${downloadResults.successCount}",
        "skippedImages": "${downloadResults.skippedCount}",
        "extractionTime": "${timestamp}",
        "onlineUsers": "${homepageStats.onlineUsers}"
      }
    },
    "error": {
      "message": "微博主页内容捕获失败",
      "retry": true,
      "maxRetries": 3,
      "errorHandling": {
        "browserError": "restart-browser",
        "networkError": "retry-with-delay",
        "contentError": "log-and-continue",
        "authenticationError": "relogin-and-retry"
      }
    }
  },
  "parameters": {
    "maxScrolls": {
      "type": "number",
      "required": false,
      "default": 20,
      "min": 5,
      "max": 100,
      "description": "最大滚动加载次数"
    },
    "scrollDelay": {
      "type": "number",
      "required": false,
      "default": 2000,
      "min": 1000,
      "max": 5000,
      "description": "滚动延迟时间（毫秒）"
    },
    "includeTrending": {
      "type": "boolean",
      "required": false,
      "default": true,
      "description": "是否包含热门话题"
    },
    "includeFeed": {
      "type": "boolean",
      "required": false,
      "default": true,
      "description": "是否包含信息流内容"
    },
    "includeRecommendations": {
      "type": "boolean",
      "required": false,
      "default": true,
      "description": "是否包含推荐内容"
    },
    "includeCategories": {
      "type": "boolean",
      "required": false,
      "default": true,
      "description": "是否包含分类内容"
    },
    "enableImageFiltering": {
      "type": "boolean",
      "required": false,
      "default": true,
      "description": "是否启用图片过滤"
    },
    "saveDir": {
      "type": "string",
      "required": false,
      "default": "~/.webauto/weibo/homepage-feed",
      "description": "保存目录"
    }
  },
  "examples": {
    "完整主页抓取": {
      "maxScrolls": 30,
      "includeTrending": true,
      "includeFeed": true,
      "includeRecommendations": true,
      "includeCategories": true,
      "enableImageFiltering": true
    },
    "仅信息流抓取": {
      "maxScrolls": 15,
      "includeTrending": false,
      "includeFeed": true,
      "includeRecommendations": false,
      "includeCategories": false,
      "enableImageFiltering": true
    },
    "仅热门话题": {
      "maxScrolls": 5,
      "includeTrending": true,
      "includeFeed": false,
      "includeRecommendations": false,
      "includeCategories": false,
      "enableImageFiltering": false
    }
  },
  "performance": {
    "estimatedTime": "10-30分钟",
    "successRate": "85-95%",
    "memoryUsage": "high",
    "networkUsage": "very-high"
  },
  "dependencies": {
    "required": [
      "BrowserInitializationOperation",
      "PageNavigationOperation",
      "FeedExtractionOperation",
      "FileSaveOperation"
    ],
    "optional": [
      "TrendingTopicsExtractionOperation",
      "RecommendationExtractionOperation",
      "CategoryExtractionOperation",
      "MediaDownloadOperation",
      "HomepageReportGenerationOperation"
    ]
  },
  "notes": [
    "此工作流适用于抓取微博主页（发现页）内容",
    "支持滚动加载更多内容",
    "包含热门话题、信息流、推荐内容、分类内容等",
    "具有完善的图片过滤和去重功能",
    "适合获取微博平台的整体趋势和热门内容"
  ],
  "bestPractices": [
    "建议在用户活跃时段运行以获取更多内容",
    "可以设置较大的maxScrolls值以获取更多帖子",
    "启用图片过滤可以节省存储空间",
    "定期运行以跟踪微博平台的趋势变化"
  ]
}