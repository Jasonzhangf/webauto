# äº¤äº’å¼ DOM æ„å»ºå™¨å·¥ä½œæµç¨‹è¯¦è§£

## æ¦‚è¿°

äº¤äº’å¼ DOM æ„å»ºå™¨é€šè¿‡ **å‘½ä»¤è¡Œäº¤äº’** + **AI è¾…åŠ©åˆ†æ** + **æµè§ˆå™¨å®æ—¶é«˜äº®** çš„æ–¹å¼ï¼Œå¸®åŠ©ç”¨æˆ·æ„å»ºå®¹å™¨å®šä¹‰ã€‚

## å·¥ä½œåŸç†

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ï¼ˆå‘½ä»¤è¡Œäº¤äº’ï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 1. è¾“å…¥æè¿°ï¼ˆ"å¾®åšFeedåˆ—è¡¨å®¹å™¨"ï¼‰
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           InteractiveDOMBuilderï¼ˆä¸»æ§åˆ¶å™¨ï¼‰                  â”‚
â”‚  - ç®¡ç†äº¤äº’æµç¨‹                                               â”‚
â”‚  - æ”¶é›†ç”¨æˆ·è¾“å…¥                                               â”‚
â”‚  - è°ƒç”¨ AI å’Œæµè§ˆå™¨æœåŠ¡                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                        â”‚
           â”‚ 2. è·å–é¡µé¢HTML         â”‚ 3. è°ƒç”¨AIåˆ†æ
           â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Unified API        â”‚  â”‚      AI Provider                 â”‚
â”‚  (Browser Service)   â”‚  â”‚  (æœ¬åœ° http://127.0.0.1:5555)    â”‚
â”‚                      â”‚  â”‚                                  â”‚
â”‚  - è·å–é¡µé¢HTML       â”‚  â”‚  - åˆ†æHTMLç»“æ„                   â”‚
â”‚  - é«˜äº®å…ƒç´           â”‚  â”‚  - ç”ŸæˆCSSé€‰æ‹©å™¨                  â”‚
â”‚  - æ‰§è¡Œè„šæœ¬          â”‚  â”‚  - è¿”å›ç½®ä¿¡åº¦å’Œå¤‡é€‰æ–¹æ¡ˆ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                        â”‚
           â”‚ 4. HTMLå†…å®¹            â”‚ 5. é€‰æ‹©å™¨å»ºè®®
           â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           InteractiveDOMBuilderï¼ˆç»“æœå¤„ç†ï¼‰                  â”‚
â”‚  - é«˜äº®AIå»ºè®®çš„å…ƒç´                                            â”‚
â”‚  - è¯¢é—®ç”¨æˆ·ç¡®è®¤                                               â”‚
â”‚  - ä¿å­˜å®¹å™¨å®šä¹‰                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 6. ä¿å­˜åˆ°æ–‡ä»¶
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          container-library/                                 â”‚
â”‚          weibo_main_page_feed_list.json                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## è¯¦ç»†æ‰§è¡Œæµç¨‹

### Phase 1: åˆå§‹åŒ–å’Œå‡†å¤‡

```bash
# ç”¨æˆ·æ‰§è¡Œå‘½ä»¤
node scripts/build-container.mjs weibo_fresh https://weibo.com
```

**å†…éƒ¨æ‰§è¡Œ:**
```typescript
const builder = new InteractiveDOMBuilder({
  provider: {
    baseUrl: 'http://127.0.0.1:5555',  // æœ¬åœ°AIæœåŠ¡
    model: 'gpt-4'
  },
  profile: 'weibo_fresh',              // æµè§ˆå™¨profile
  url: 'https://weibo.com'             // ç›®æ ‡é¡µé¢
});

await builder.build();
```

### Phase 2: æ­¥éª¤ 1 - åˆ†æä¸»å®¹å™¨

#### 2.1 ç”¨æˆ·è¾“å…¥æè¿°
```
ğŸ’¡ å¼€å§‹åˆ†æä¸»å®¹å™¨...
å®¹å™¨æè¿°: å¾®åšé¦–é¡µçš„Feedåˆ—è¡¨å®¹å™¨
```

#### 2.2 è·å–é¡µé¢ HTML
```typescript
// é€šè¿‡ Unified API æ‰§è¡Œæµè§ˆå™¨è„šæœ¬
const response = await fetch('http://127.0.0.1:7701/v1/controller/action', {
  method: 'POST',
  body: JSON.stringify({
    action: 'browser:execute',
    payload: {
      profile: 'weibo_fresh',
      script: 'document.documentElement.outerHTML'
    }
  })
});

const html = response.data; // æ•´ä¸ªé¡µé¢çš„HTML
```

**å®é™…è·å–çš„HTMLç¤ºä¾‹:**
```html
<!DOCTYPE html>
<html>
<head>...</head>
<body>
  <div id="app">
    <div class="Frame_wrap_3g67Q">
      <main class="Main_wrap_2Kj9X">
        <div class="Home_feed_5L3kP">
          <article class="Feed_wrap_8H3kL">...</article>
          <article class="Feed_wrap_8H3kL">...</article>
          ...
        </div>
      </main>
    </div>
  </div>
</body>
</html>
```

#### 2.3 è°ƒç”¨ AI åˆ†æ

**å‘é€ç»™ AI çš„è¯·æ±‚:**
```typescript
const aiRequest = {
  model: 'gpt-4',
  messages: [
    {
      role: 'system',
      content: `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ Web è‡ªåŠ¨åŒ–å·¥ç¨‹å¸ˆ...
      
      è¯·ä»¥ JSON æ ¼å¼è¿”å›:
      {
        "selector": "CSSé€‰æ‹©å™¨",
        "confidence": 0.0-1.0,
        "explanation": "ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªé€‰æ‹©å™¨",
        "alternatives": [...]
      }`
    },
    {
      role: 'user',
      content: `ç›®æ ‡æè¿°ï¼šå¾®åšé¦–é¡µçš„Feedåˆ—è¡¨å®¹å™¨
      
      HTML ç‰‡æ®µï¼š
      <html>...</html>
      
      ç¤ºä¾‹ï¼š
      - ä½¿ç”¨ [class*='xxx'] æ¥åŒ¹é…åŠ¨æ€ class å
      - ä¼˜å…ˆä½¿ç”¨ç»“æ„ç¨³å®šçš„é€‰æ‹©å™¨`
    }
  ]
};

const aiResponse = await fetch('http://127.0.0.1:5555/v1/chat/completions', {
  method: 'POST',
  body: JSON.stringify(aiRequest)
});
```

**AI è¿”å›çš„å“åº”:**
```json
{
  "selector": "main[class*='Main_wrap_'] div[class*='Home_feed_']",
  "confidence": 0.95,
  "explanation": "è¿™ä¸ªé€‰æ‹©å™¨åŒ¹é…å¾®åšé¦–é¡µçš„ä¸»Feedå®¹å™¨ã€‚ä½¿ç”¨å±æ€§é€‰æ‹©å™¨[class*='xxx']å¯ä»¥é€‚åº”åŠ¨æ€classåå˜åŒ–ã€‚ç»“æ„ç¨³å®šï¼Œä¸ä¾èµ–å…·ä½“çš„hashå€¼ã€‚",
  "alternatives": [
    {
      "selector": "div[class*='Home_feed_']",
      "confidence": 0.85,
      "explanation": "æ›´ç®€æ´çš„é€‰æ‹©å™¨ï¼Œä½†å¯èƒ½åœ¨å…¶ä»–é¡µé¢ä¹Ÿå­˜åœ¨ç±»ä¼¼å…ƒç´ "
    },
    {
      "selector": "#app main div:nth-child(1)",
      "confidence": 0.70,
      "explanation": "åŸºäºç»“æ„çš„é€‰æ‹©å™¨ï¼Œä½†ä¸å¤Ÿè¯­ä¹‰åŒ–ï¼Œå®¹æ˜“å¤±æ•ˆ"
    }
  ]
}
```

#### 2.4 é«˜äº®å…ƒç´ éªŒè¯

```typescript
// åœ¨æµè§ˆå™¨ä¸­é«˜äº® AI å»ºè®®çš„å…ƒç´ 
await fetch('http://127.0.0.1:7701/v1/controller/action', {
  method: 'POST',
  body: JSON.stringify({
    action: 'browser:highlight',
    payload: {
      profile: 'weibo_fresh',
      selector: "main[class*='Main_wrap_'] div[class*='Home_feed_']",
      options: {
        style: '3px solid #fbbc05',
        duration: 5000,
        sticky: false,
        label: 'ä¸»å®¹å™¨'
      }
    }
  })
});
```

**æµè§ˆå™¨ä¸­çš„æ•ˆæœ:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¾®åš                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸŸ¨ ä¸»å®¹å™¨ (é»„è‰²é«˜äº®æ¡†)             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚  â”‚  â”‚ å¸–å­1                 â”‚       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚  â”‚  â”‚ å¸–å­2                 â”‚       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.5 ç”¨æˆ·ç¡®è®¤

```
âœ… AI å»ºè®®çš„é€‰æ‹©å™¨: main[class*='Main_wrap_'] div[class*='Home_feed_']
ğŸ’¡ ç½®ä¿¡åº¦: 0.95
ğŸ’¡ è¯´æ˜: è¿™ä¸ªé€‰æ‹©å™¨åŒ¹é…å¾®åšé¦–é¡µçš„ä¸»Feedå®¹å™¨...

æ˜¯å¦æ»¡æ„è¿™ä¸ªé€‰æ‹©å™¨ï¼Ÿ(y/n): y
```

**å¦‚æœç”¨æˆ·é€‰æ‹© 'n':**
```
ğŸ’¡ å¤‡é€‰æ–¹æ¡ˆ:
  1. div[class*='Home_feed_'] (ç½®ä¿¡åº¦: 0.85)
     æ›´ç®€æ´çš„é€‰æ‹©å™¨ï¼Œä½†å¯èƒ½åœ¨å…¶ä»–é¡µé¢ä¹Ÿå­˜åœ¨ç±»ä¼¼å…ƒç´ 
  
  2. #app main div:nth-child(1) (ç½®ä¿¡åº¦: 0.70)
     åŸºäºç»“æ„çš„é€‰æ‹©å™¨ï¼Œä½†ä¸å¤Ÿè¯­ä¹‰åŒ–ï¼Œå®¹æ˜“å¤±æ•ˆ

é€‰æ‹©å¤‡é€‰æ–¹æ¡ˆåºå·ï¼Œæˆ–è¾“å…¥è‡ªå®šä¹‰é€‰æ‹©å™¨: 1
```

### Phase 3: æ­¥éª¤ 2 - åˆ†æå­å®¹å™¨ï¼ˆå¯é€‰ï¼‰

```
æ˜¯å¦éœ€è¦åˆ†æå­å®¹å™¨ï¼Ÿ(y/n): y
å­å®¹å™¨æè¿°ï¼ˆä¾‹å¦‚ï¼šå•ä¸ªå¸–å­å®¹å™¨ï¼‰: å•ä¸ªå¾®åšå¸–å­
```

#### 3.1 è·å–çˆ¶å®¹å™¨çš„ HTML

```typescript
// åªè·å–çˆ¶å®¹å™¨å†…çš„HTMLï¼Œå‡å°‘AIåˆ†æçš„æ•°æ®é‡
const elementHTML = await fetch('http://127.0.0.1:7701/v1/controller/action', {
  method: 'POST',
  body: JSON.stringify({
    action: 'browser:execute',
    payload: {
      profile: 'weibo_fresh',
      script: `
        const el = document.querySelector('main[class*="Main_wrap_"] div[class*="Home_feed_"]');
        el ? el.outerHTML : '';
      `
    }
  })
});
```

**è·å–çš„HTML:**
```html
<div class="Home_feed_5L3kP">
  <article class="Feed_wrap_8H3kL">
    <header>...</header>
    <div class="detail_wbtext_2V7oN">å†…å®¹...</div>
    <time>2å°æ—¶å‰</time>
  </article>
  <article class="Feed_wrap_8H3kL">...</article>
  ...
</div>
```

#### 3.2 AI åˆ†æå­å®¹å™¨

**AI è¿”å›:**
```json
{
  "selector": "article[class*='Feed_wrap_']",
  "confidence": 0.92,
  "explanation": "è¿™ä¸ªé€‰æ‹©å™¨åŒ¹é…Feedå®¹å™¨å†…çš„æ¯ä¸ªå¸–å­ã€‚ä½¿ç”¨articleæ ‡ç­¾é…åˆåŠ¨æ€classåŒ¹é…ã€‚"
}
```

#### 3.3 é«˜äº®å­å®¹å™¨

```typescript
// ç»„åˆå®Œæ•´é€‰æ‹©å™¨: çˆ¶é€‰æ‹©å™¨ + å­é€‰æ‹©å™¨
const fullSelector = "main[class*='Main_wrap_'] div[class*='Home_feed_'] article[class*='Feed_wrap_']";

await highlight(fullSelector, 'å­å®¹å™¨');
```

**æµè§ˆå™¨æ•ˆæœ:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¾®åš                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸŸ¨ ä¸»å®¹å™¨                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚  â”‚  â”‚ ğŸŸ¦ å¸–å­1 (è“è‰²æ¡†)      â”‚       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚  â”‚  â”‚ ğŸŸ¦ å¸–å­2 (è“è‰²æ¡†)      â”‚       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 4: æ­¥éª¤ 3 - åˆ†æå­—æ®µ

```
ğŸ’¡ è¯·å®šä¹‰éœ€è¦æå–çš„å­—æ®µï¼ˆè¾“å…¥ç©ºè¡Œç»“æŸï¼‰:

å­—æ®µåï¼ˆå¦‚ authorï¼‰: author
author çš„æè¿°: å‘å¸–äººçš„ç”¨æˆ·åé“¾æ¥

å­—æ®µåï¼ˆå¦‚ authorï¼‰: content  
content çš„æè¿°: å¸–å­çš„æ–‡æœ¬å†…å®¹

å­—æ®µåï¼ˆå¦‚ authorï¼‰: timestamp
timestamp çš„æè¿°: å‘å¸–æ—¶é—´

å­—æ®µåï¼ˆå¦‚ authorï¼‰: [å›è½¦ç»“æŸ]
```

#### 4.1 è·å–å•ä¸ªå®¹å™¨çš„ HTML

```typescript
// è·å–ç¬¬ä¸€ä¸ªå¸–å­çš„HTMLä½œä¸ºåˆ†ææ ·æœ¬
const containerHTML = await fetch('http://127.0.0.1:7701/v1/controller/action', {
  method: 'POST',
  body: JSON.stringify({
    action: 'browser:execute',
    payload: {
      profile: 'weibo_fresh',
      script: `
        const container = document.querySelector('article[class*="Feed_wrap_"]');
        container ? container.outerHTML : '';
      `
    }
  })
});
```

**è·å–çš„HTML:**
```html
<article class="Feed_wrap_8H3kL">
  <header>
    <a href="https://weibo.com/u/1234567890" class="UserName_link_3H5kL">å¼ ä¸‰</a>
  </header>
  <div class="detail_wbtext_2V7oN">
    è¿™æ˜¯ä¸€æ¡å¾®åšå†…å®¹...
  </div>
  <time datetime="2024-01-01T12:00:00">2å°æ—¶å‰</time>
  <div class="toolbar">...</div>
</article>
```

#### 4.2 AI åˆ†æå­—æ®µ

**å‘é€ç»™ AI:**
```typescript
const request = {
  html: containerHTML,
  containerSelector: "article[class*='Feed_wrap_']",
  fieldDescriptions: {
    author: "å‘å¸–äººçš„ç”¨æˆ·åé“¾æ¥",
    content: "å¸–å­çš„æ–‡æœ¬å†…å®¹",
    timestamp: "å‘å¸–æ—¶é—´"
  }
};
```

**AI è¿”å›:**
```json
{
  "fields": {
    "author": {
      "selector": "header a[href*='weibo.com']",
      "confidence": 0.95,
      "explanation": "åŒ¹é…headerå†…æŒ‡å‘weibo.comçš„ç”¨æˆ·é“¾æ¥"
    },
    "content": {
      "selector": "div[class*='detail_wbtext']",
      "confidence": 0.92,
      "explanation": "åŒ¹é…åŒ…å«wbtextçš„divï¼Œè¿™æ˜¯å¾®åšå†…å®¹çš„æ ‡å‡†å®¹å™¨"
    },
    "timestamp": {
      "selector": "time",
      "confidence": 0.98,
      "explanation": "HTML5çš„timeæ ‡ç­¾ï¼Œè¯­ä¹‰åŒ–å¼ºä¸”ç¨³å®š"
    }
  }
}
```

**è¾“å‡ºæ˜¾ç¤º:**
```
âœ… å­—æ®µåˆ†æç»“æœ:
  author: header a[href*='weibo.com']
    ç½®ä¿¡åº¦: 0.95
    è¯´æ˜: åŒ¹é…headerå†…æŒ‡å‘weibo.comçš„ç”¨æˆ·é“¾æ¥
  
  content: div[class*='detail_wbtext']
    ç½®ä¿¡åº¦: 0.92
    è¯´æ˜: åŒ¹é…åŒ…å«wbtextçš„divï¼Œè¿™æ˜¯å¾®åšå†…å®¹çš„æ ‡å‡†å®¹å™¨
  
  timestamp: time
    ç½®ä¿¡åº¦: 0.98
    è¯´æ˜: HTML5çš„timeæ ‡ç­¾ï¼Œè¯­ä¹‰åŒ–å¼ºä¸”ç¨³å®š
```

### Phase 5: æ­¥éª¤ 4 - ä¿å­˜å®¹å™¨å®šä¹‰

```
å®¹å™¨ IDï¼ˆå¦‚ weibo_main_page.feed_listï¼‰: weibo_main_page.feed_post
å®¹å™¨ç±»å‹ï¼ˆpage/collection/contentï¼‰: content
```

**ç”Ÿæˆçš„å®¹å™¨å®šä¹‰:**
```json
{
  "id": "weibo_main_page.feed_post",
  "name": "è‡ªåŠ¨ç”Ÿæˆçš„å®¹å™¨ - weibo_main_page.feed_post",
  "type": "content",
  "capabilities": ["highlight", "extract"],
  "selectors": [
    {
      "css": "article[class*='Feed_wrap_']",
      "variant": "primary",
      "score": 1.0
    }
  ],
  "operations": [
    {
      "type": "extract",
      "config": {
        "fields": {
          "author": "header a[href*='weibo.com']",
          "content": "div[class*='detail_wbtext']",
          "timestamp": "time"
        }
      }
    }
  ]
}
```

```
âœ… ç”Ÿæˆçš„å®¹å™¨å®šä¹‰:
{...}

æ˜¯å¦ä¿å­˜åˆ°æ–‡ä»¶ï¼Ÿ(y/n): y
âœ… å·²ä¿å­˜åˆ°: container-library/weibo_main_page_feed_post.json
âœ… æ„å»ºå®Œæˆï¼
```

## æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. readline äº¤äº’
```typescript
import * as readline from 'node:readline';

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

// å¼‚æ­¥è¯¢é—®
async ask(question: string): Promise<string> {
  return new Promise((resolve) => {
    rl.question(question, (answer) => {
      resolve(answer.trim());
    });
  });
}
```

### 2. AI è°ƒç”¨
```typescript
async callAI(messages) {
  const response = await fetch('http://127.0.0.1:5555/v1/chat/completions', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      model: 'gpt-4',
      messages,
      temperature: 0.1,  // ä½æ¸©åº¦ä¿è¯ç¨³å®šè¾“å‡º
      max_tokens: 2000
    })
  });
  
  const data = await response.json();
  return data.choices[0].message.content;
}
```

### 3. æµè§ˆå™¨æ§åˆ¶
```typescript
// é€šè¿‡ Unified API ç»Ÿä¸€è°ƒç”¨
async executeAction(action, payload) {
  const response = await fetch('http://127.0.0.1:7701/v1/controller/action', {
    method: 'POST',
    body: JSON.stringify({ action, payload })
  });
  return response.json();
}
```

## ä¼˜åŠ¿

1. **AI è¾…åŠ©** - è‡ªåŠ¨ç”Ÿæˆé€‰æ‹©å™¨ï¼Œå‡å°‘äººå·¥åˆ†ææ—¶é—´
2. **å®æ—¶éªŒè¯** - æµè§ˆå™¨å®æ—¶é«˜äº®ï¼Œç«‹å³çœ‹åˆ°æ•ˆæœ
3. **äº¤äº’å¼ç¡®è®¤** - ç”¨æˆ·å¯ä»¥ä¿®æ”¹å’Œè°ƒæ•´
4. **å¤‡é€‰æ–¹æ¡ˆ** - AI æä¾›å¤šä¸ªé€‰æ‹©å™¨é€‰é¡¹
5. **ç»“æ„åŒ–è¾“å‡º** - è‡ªåŠ¨ç”Ÿæˆæ ‡å‡†å®¹å™¨å®šä¹‰JSON

## å±€é™æ€§

1. **ä¾èµ– AI æœåŠ¡** - éœ€è¦æœ¬åœ°æˆ–è¿œç¨‹ AI æœåŠ¡
2. **HTML å¤§å°é™åˆ¶** - å¤§å‹é¡µé¢éœ€è¦æˆªå–éƒ¨åˆ†HTML
3. **åŠ¨æ€å†…å®¹** - æŸäº›JSæ¸²æŸ“çš„å†…å®¹å¯èƒ½éœ€è¦é¢å¤–å¤„ç†
4. **å‡†ç¡®æ€§** - AI å»ºè®®éœ€è¦äººå·¥ç¡®è®¤

## æ€»ç»“

äº¤äº’å¼ DOM æ„å»ºå™¨é€šè¿‡ç»“åˆ **AI æ™ºèƒ½åˆ†æ** å’Œ **äººå·¥äº¤äº’ç¡®è®¤**ï¼Œå®ç°äº†åŠè‡ªåŠ¨åŒ–çš„å®¹å™¨å®šä¹‰æ„å»ºæµç¨‹ï¼Œå¤§å¤§æé«˜äº†æ•ˆç‡ã€‚
